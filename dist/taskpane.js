/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={418:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleApiError=void 0;const r=n(86638),o=n(12111),a=n(38194);t.handleApiError=async(e,t,n)=>{if(e instanceof Error&&"ResponseError"===e.name){const a=e,c=await(0,r.extractMessage)(a),s=a.response.status,i=t?await t(s,c):c;return(0,o.mapHttpStatusError)({status:a.response.status,url:a.response.url||n,message:i})}if(e instanceof a.PineconeConnectionError)return e;{const t=e;return new a.PineconeConnectionError(t)}}},3104:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatStream=void 0;const r=n(57798);class o{constructor(e){this.stream=e}async*[Symbol.asyncIterator](){let e="";for await(const t of this.stream){let n;for(e+=t.toString();-1!==(n=e.indexOf("\n"));){const t=e.slice(0,n).trim();if(e=e.slice(n+1),t&&t.startsWith("data:")){const e=t.slice(5).trim();try{const t=JSON.parse(e),n=(0,r.convertKeysToCamelCase)(t);yield n}catch(e){console.debug(`Skipping malformed JSON:${t}`);continue}}}}if(e.trim())try{const t=JSON.parse(e),n=(0,r.convertKeysToCamelCase)(t);yield n}catch(t){console.debug(`Skipping malformed JSON:${e}`)}}}t.ChatStream=o},12111:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapHttpStatusError=t.PineconeUnmappedHttpError=t.PineconeNotImplementedError=t.PineconeUnavailableError=t.PineconeMaxRetriesExceededError=t.PineconeInternalServerError=t.PineconeConflictError=t.PineconeNotFoundError=t.PineconeAuthorizationError=t.PineconeBadRequestError=void 0;const r=n(41102),o="You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io";class a extends r.BasePineconeError{constructor(e){const{message:t}=e;super(t),this.name="PineconeBadRequestError"}}t.PineconeBadRequestError=a;class c extends r.BasePineconeError{constructor(e){const{url:t}=e;super(t?`The API key you provided was rejected while calling ${t}. Please check your configuration values and try again. ${o}`:`The API key you provided was rejected. Please check your configuration values and try again. ${o}`),this.name="PineconeAuthorizationError"}}t.PineconeAuthorizationError=c;class s extends r.BasePineconeError{constructor(e){const{url:t}=e;super(t?`A call to ${t} returned HTTP status 404.`:"The requested resource could not be found."),this.name="PineconeNotFoundError"}}t.PineconeNotFoundError=s;class i extends r.BasePineconeError{constructor(e){const{url:t,message:n}=e;super(t?`A call to ${t} returned HTTP status 409. ${n||""}`:"The resource you are attempting to create already exists."),this.name="PineconeConflictError"}}t.PineconeConflictError=i;class l extends r.BasePineconeError{constructor(e){const{url:t,body:n,status:r}=e;super([t?`An internal server error occurred while calling the ${t} endpoint.`:"",r?`Status Code: ${r}.`:"","To see overall service health and learn whether this seems like a large-scale problem or one specific to your request, please go to https://status.pinecone.io/ to view our status page. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client",n?`Body: ${n}`:""].join(" ").trim()),this.name="PineconeInternalServerError"}}t.PineconeInternalServerError=l;class u extends r.BasePineconeError{constructor(e){super([`You have exceeded the max configured retries (${e}). `,"Increase the maxRetries field in the RetryOptions object to retry more times. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client"].join(" ").trim()),this.name="PineconeMaxRetriesExceededError"}}t.PineconeMaxRetriesExceededError=u;class f extends r.BasePineconeError{constructor(e){const{url:t,body:n,status:r}=e;super([t?`The Pinecone service (${t}) is temporarily unavailable.`:"",r?`Status Code: ${r}.`:"","To see overall service health and learn whether this seems like a large-scale problem or one specific to your request, please go to https://status.pinecone.io/ to view our status page. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client",n?`Body: ${n}`:""].join(" ").trim()),this.name="PineconeUnavailableError"}}t.PineconeUnavailableError=f;class p extends r.BasePineconeError{constructor(e){const{url:t,message:n}=e;t?super(`A call to ${t} returned HTTP status 501. ${n||""}`):super(),this.name="PineconeNotImplementedError"}}t.PineconeNotImplementedError=p;class d extends r.BasePineconeError{constructor(e){const{url:t,status:n,body:r,message:o}=e;super([t?`An unexpected error occured while calling the ${t} endpoint. `:"",o,n?`Status: ${n}. `:"",r?`Body: ${r}`:""].join(" ").trim()),this.name="PineconeUnmappedHttpError"}}t.PineconeUnmappedHttpError=d,t.mapHttpStatusError=e=>{switch(e.status){case 400:case 403:return new a(e);case 401:return new c(e);case 404:return new s(e);case 409:return new i(e);case 500:return new l(e);case 501:return new p(e);case 503:return new f(e);default:throw new d(e)}}},13165:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFetch=void 0;const r=n(50899);t.getFetch=e=>{if(e.fetchApi)return e.fetchApi;if(n.g.fetch)return n.g.fetch;throw new r.PineconeConfigurationError("No global or user-provided fetch implementations found. Please supply a fetch implementation.")}},16797:function(e,t,n){"use strict";n(41990),n(32793),n(92218),n(88654),n(13165),n(19751),n(3104),n(57798)},19751:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryOnServerFailure=void 0;const r=n(50899);t.RetryOnServerFailure=class{constructor(e,t){if(this.calculateRetryDelay=(e,t=200,n=2e4,r=.25)=>{let o=t*2**e;return o+=o*r*(Math.random()-.5),Math.min(n,Math.max(0,o))},this.maxRetries=t||3,this.maxRetries>10)throw new Error("Max retries cannot exceed 10");this.asyncFn=e}async execute(...e){if(this.maxRetries<1)return this.asyncFn(...e);for(let t=0;t<this.maxRetries;t++)try{const t=await this.asyncFn(...e);if(!this.isRetryError(t))return t;throw t}catch(e){const n=this.mapErrorIfNeeded(e);if(this.shouldStopRetrying(n))throw n;if(t===this.maxRetries-1)throw new r.PineconeMaxRetriesExceededError(this.maxRetries);await this.delay(t+1)}throw new r.PineconeMaxRetriesExceededError(this.maxRetries)}isRetryError(e){if(!e)return!1;if(e){if(e.name&&["PineconeUnavailableError","PineconeInternalServerError"].includes(e.name))return!0;if(e.status&&e.status>=500)return!0}return!1}async delay(e){const t=this.calculateRetryDelay(e);return new Promise((e=>setTimeout(e,t)))}mapErrorIfNeeded(e){return e?.status?(0,r.mapHttpStatusError)(e):e}shouldStopRetrying(e){return e.status?e.status<500:!e.name||"PineconeUnavailableError"!==e.name&&"PineconeInternalServerError"!==e.name}}},23184:function(e){var t,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,i=[],l=!1,u=-1;function f(){l&&s&&(l=!1,s.length?i=s.concat(i):u=-1,i.length&&p())}function p(){if(!l){var e=c(f);l=!0;for(var t=i.length;t;){for(s=i,i=[];++u<t;)s&&s[u].run();u=-1,t=i.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function h(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.push(new d(e,t)),1!==i.length||l||c(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=h,r.addListener=h,r.once=h,r.off=h,r.removeListener=h,r.removeAllListeners=h,r.emit=h,r.prependListener=h,r.prependOnceListener=h,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},30233:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeUnableToResolveHostError=t.PineconeEnvironmentVarsNotSupportedError=t.PineconeUnexpectedResponseError=t.PineconeConfigurationError=void 0;const r=n(41102);class o extends r.BasePineconeError{constructor(e){super(`${e} You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io.`),this.name="PineconeConfigurationError"}}t.PineconeConfigurationError=o;class a extends r.BasePineconeError{constructor(e,t,n,r){super(`Unexpected response while calling ${e}. ${r?r+" ":""}Status: ${t}. Body: ${n}`),this.name="PineconeUnexpectedResponseError"}}t.PineconeUnexpectedResponseError=a;class c extends r.BasePineconeError{constructor(e){super(e),this.name="PineconeEnvironmentVarsNotSupportedError"}}t.PineconeEnvironmentVarsNotSupportedError=c;class s extends r.BasePineconeError{constructor(e){super(e),this.name="PineconeUnableToResolveHostError"}}t.PineconeUnableToResolveHostError=s},32516:function(e){"use strict";e.exports=JSON.parse('{"name":"@pinecone-database/pinecone","version":"4.1.0"}')},32793:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeUrl=void 0,t.normalizeUrl=function(e){if(e&&0!==e.trim().length)return e.startsWith("http://")||e.startsWith("https://")?e:"https://"+e}},38194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeRequestError=t.PineconeConnectionError=void 0;const r=n(41102);class o extends r.BasePineconeError{constructor(e,t){let n="";t&&(n=` while calling ${t}`),super(`Request failed to reach Pinecone${n}. This can occur for reasons such as network problems that prevent the request from being completed, or a Pinecone API outage. Check your network connection, and visit https://status.pinecone.io/ to see whether any outages are ongoing.`,e),this.name="PineconeConnectionError"}}t.PineconeConnectionError=o;class a extends r.BasePineconeError{constructor(e){e.response?super(`Request failed during a call to ${e.init.method} ${e.url} with status ${e.response.status}`,e.error):super(`Request failed during a call to ${e.init.method} ${e.url}`,e.error)}}t.PineconeRequestError=a},41102:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BasePineconeError=void 0;class n extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,new.target),this.name=this.constructor.name,this.cause=t}}t.BasePineconeError=n},41990:function(e,t,n){"use strict";var r=n(23184);Object.defineProperty(t,"__esModule",{value:!0}),t.debugLog=void 0,t.debugLog=e=>{void 0!==r&&r&&{}.PINECONE_DEBUG&&console.log(e)}},45208:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isEdge=void 0,t.isEdge=()=>"string"==typeof EdgeRuntime,t.isBrowser=()=>"undefined"!=typeof window},50899:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.handleApiError=t.extractMessage=t.PineconeArgumentError=t.BasePineconeError=t.PineconeRequestError=t.PineconeConnectionError=t.PineconeUnableToResolveHostError=t.PineconeEnvironmentVarsNotSupportedError=t.PineconeUnexpectedResponseError=t.PineconeConfigurationError=void 0;var a=n(30233);Object.defineProperty(t,"PineconeConfigurationError",{enumerable:!0,get:function(){return a.PineconeConfigurationError}}),Object.defineProperty(t,"PineconeUnexpectedResponseError",{enumerable:!0,get:function(){return a.PineconeUnexpectedResponseError}}),Object.defineProperty(t,"PineconeEnvironmentVarsNotSupportedError",{enumerable:!0,get:function(){return a.PineconeEnvironmentVarsNotSupportedError}}),Object.defineProperty(t,"PineconeUnableToResolveHostError",{enumerable:!0,get:function(){return a.PineconeUnableToResolveHostError}}),o(n(12111),t);var c=n(38194);Object.defineProperty(t,"PineconeConnectionError",{enumerable:!0,get:function(){return c.PineconeConnectionError}}),Object.defineProperty(t,"PineconeRequestError",{enumerable:!0,get:function(){return c.PineconeRequestError}});var s=n(41102);Object.defineProperty(t,"BasePineconeError",{enumerable:!0,get:function(){return s.BasePineconeError}});var i=n(92376);Object.defineProperty(t,"PineconeArgumentError",{enumerable:!0,get:function(){return i.PineconeArgumentError}});var l=n(86638);Object.defineProperty(t,"extractMessage",{enumerable:!0,get:function(){return l.extractMessage}});var u=n(418);Object.defineProperty(t,"handleApiError",{enumerable:!0,get:function(){return u.handleApiError}})},57798:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertKeysToCamelCase=void 0,t.convertKeysToCamelCase=e=>Array.isArray(e)?e.map((e=>(0,t.convertKeysToCamelCase)(e))):null!==e&&"object"==typeof e?Object.entries(e).reduce(((e,[r,o])=>(e[n(r)]=(0,t.convertKeysToCamelCase)(o),e)),{}):e;const n=e=>e.replace(/_([a-z])/g,((e,t)=>t.toUpperCase()))},58394:function(e,t,n){"use strict";e.exports=n.p+"ff4bdaf7d14d167150a7.css"},60947:function(e,t,n){"use strict";e.exports=n.p+"fbc7e2227585765cc2bc.js"},75180:function(){},86638:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractMessage=void 0,t.extractMessage=async e=>{let t=await e.response.text();try{const e=JSON.parse(t);e.message&&(t=e.message)}catch(e){}return t}},88654:function(e,t,n){"use strict";var r=n(23184),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.buildUserAgent=void 0;const s=n(45208),i=c(n(32516));t.buildUserAgent=e=>{const t=[`${i.name} v${i.version}`,"lang=typescript"];return(0,s.isEdge)()&&t.push("Edge Runtime"),void 0!==r&&r&&r.version&&t.push(`node ${r.version}`),e.sourceTag&&t.push(`source_tag=${l(e.sourceTag)}`),t.join("; ")};const l=e=>{if(e)return e.toLowerCase().replace(/[^a-z0-9_ :]/g,"").trim().replace(/[ ]+/g,"_")}},92218:function(e,t){"use strict";function n(e,t=""){return Object.keys(e).map((n=>r(n,e[n],t))).filter((e=>e.length>0)).join("&")}function r(e,t,o=""){const a=o+(o.length?`[${e}]`:e);if(Array.isArray(t)){const e=t.map((e=>encodeURIComponent(String(e)))).join(`&${encodeURIComponent(a)}=`);return`${encodeURIComponent(a)}=${e}`}return t instanceof Set?r(e,Array.from(t),o):t instanceof Date?`${encodeURIComponent(a)}=${encodeURIComponent(t.toISOString())}`:t instanceof Object?n(t,a):`${encodeURIComponent(a)}=${encodeURIComponent(String(t))}`}Object.defineProperty(t,"__esModule",{value:!0}),t.queryParamsStringify=void 0,t.queryParamsStringify=n},92376:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeArgumentError=void 0;const r=n(41102);class o extends r.BasePineconeError{constructor(e){super(`${e}`),this.name="PineconeArgumentError"}}t.PineconeArgumentError=o}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){t=function(){return r};var n,r={},o=Object.prototype,a=o.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(n){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new N(r||[]);return c(a,"_invoke",{value:C(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=p;var h="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function b(){}function x(){}function w(){}var E={};f(E,i,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(T([])));P&&P!==o&&a.call(P,i)&&(E=P);var I=w.prototype=b.prototype=Object.create(E);function A(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function S(t,n){function r(o,c,s,i){var l=d(t[o],t,c);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==e(f)&&a.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,s,i)}),(function(e){r("throw",e,s,i)})):n.resolve(f).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,i)}))}i(l.arg)}var o;c(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(a,a):a()}})}function C(e,t,r){var o=h;return function(a,c){if(o===m)throw Error("Generator is already running");if(o===y){if("throw"===a)throw c;return{value:n,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=O(s,r);if(i){if(i===v)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var l=d(e,t,r);if("normal"===l.type){if(o=r.done?y:g,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=y,r.method="throw",r.arg=l.arg)}}}function O(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=d(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var c=a.arg;return c?c.done?(t[e.resultName]=c.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):c:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function e(){for(;++o<t.length;)if(a.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=n,e.done=!0,e};return c.next=c}}throw new TypeError(e(t)+" is not iterable")}return x.prototype=w,c(I,"constructor",{value:w,configurable:!0}),c(w,"constructor",{value:x,configurable:!0}),x.displayName=f(w,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},r.awrap=function(e){return{__await:e}},A(S.prototype),f(S.prototype,l,(function(){return this})),r.AsyncIterator=S,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var c=new S(p(e,t,n,o),a);return r.isGeneratorFunction(t)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},A(I),f(I,u,"Generator"),f(I,i,(function(){return this})),f(I,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=T,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],s=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var i=a.call(c,"catchLoc"),l=a.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}},r}function r(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,c=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw c}}}}function a(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){s(a,r,o,c,i,"next",e)}function i(e){s(a,r,o,c,i,"throw",e)}c(void 0)}))}}function l(e){return u.apply(this,arguments)}function u(){return(u=i(t().mark((function e(n){var a,c,s,i,l,u,f,p,d,h,g,m,y,v,b,x,w,E,k,P,I,A,S,C,O,R,_,N,T,j,L,F,B,D,M,K,q;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],c=new Set,s=new Set,i=new Set,n=n.map((function(e){var t=e.match(/<[^>]+>/);return t?t[0]:e})),console.log("CleanedInput Code Strings:",n),l=new Set,u=new Set,f=new Set,p=new Set,d=new Set,h=new Set,g=new Set,e.prev=13,e.next=16,fetch("../prompts/Codes.txt");case 16:if((m=e.sent).ok){e.next=19;break}throw new Error("Failed to load Codes.txt file");case 19:return e.next=21,m.text();case 21:y=e.sent,g=new Set(y.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))),e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(13),a.push("Error reading Codes.txt file: ".concat(e.t0.message)),e.abrupt("return",a);case 29:v=o(n),e.prev=30,v.s();case 32:if((b=v.n()).done){e.next=45;break}if((x=b.value).startsWith("<")&&x.endsWith(">")){e.next=37;break}return a.push("Invalid code string format: ".concat(x)),e.abrupt("continue",43);case 37:if(!x.startsWith("<BR>")){e.next=39;break}return e.abrupt("continue",43);case 39:(w=x.match(/row\d+\s*=\s*"([^"]*)"/g))&&w.forEach((function(e){var t=e.match(/row\d+\s*=\s*"([^"]*)"/)[1].split("|");t.length>0&&t.forEach((function(e){var t=e.trim();if(t.startsWith("*")){var n=t.substring(1).trim();n&&s.add(n)}else t&&s.add(t)}))})),(E=x.match(/<([^;]+);/))&&(k=E[1].trim(),i.add(k),k.endsWith("-VV")&&l.add(k),k.endsWith("-VR")&&u.add(k),k.endsWith("-RR")&&f.add(k),k.endsWith("-RV")&&p.add(k),k.endsWith("-EV")&&d.add(k),k.endsWith("-ER")&&h.add(k));case 43:e.next=32;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(30),v.e(e.t1);case 50:return e.prev=50,v.f(),e.finish(50);case 53:for(P=0,I=[].concat(r(l),r(u));P<I.length;P++)A=I[P],0===d.size&&0===p.size&&a.push("Code ".concat(A," requires another code with suffix -EV or -RV. Fix by adding another code with the correct suffix or by change to the EV/ER version of the same code."));for(S=0,C=[].concat(r(f),r(p));S<C.length;S++)O=C[S],0===h.size&&0===u.size&&a.push("Code ".concat(O," requires another code with suffix -ER or -VR"));R=o(n),e.prev=56,R.s();case 58:if((_=R.n()).done){e.next=82;break}if("<BR>"!==(N=_.value)){e.next=62;break}return e.abrupt("continue",80);case 62:if(T=N.match(/<([^;]+);/)){e.next=66;break}return a.push("Cannot extract code type from: ".concat(N)),e.abrupt("continue",80);case 66:if(j=T[1].trim(),g.has(j)||a.push('Invalid code type: "'.concat(j,'" not found in valid codes list')),"TAB"!==j){e.next=78;break}if(L=N.match(/label\d+="([^"]*)"/)){e.next=73;break}return a.push("TAB code missing label parameter"),e.abrupt("continue",80);case 73:(F=L[1]).length>30&&a.push('Tab label too long (max 30 chars): "'.concat(F,'"')),/[&,":;]/.test(F)&&a.push('Tab label contains illegal characters (&,":;): "'.concat(F,'"')),c.has(F)&&a.push('Duplicate tab label: "'.concat(F,'"')),c.add(F);case 78:(B=N.match(/row\d+="([^"]*)"/g))&&B.forEach((function(e){var t=e.match(/row\d+="([^"]*)"/)[1];t.split("|").length<2&&a.push('Invalid row format (missing required fields): "'.concat(t,'"'))}));case 80:e.next=58;break;case 82:e.next=87;break;case 84:e.prev=84,e.t2=e.catch(56),R.e(e.t2);case 87:return e.prev=87,R.f(),e.finish(87);case 90:D=o(n);try{for(D.s();!(M=D.n()).done;)K=M.value,(q=K.match(/driver\d+\s*=\s*"([^"]*)"/g))&&q.forEach((function(e){var t=e.match(/driver\d+\s*=\s*"([^"]*)"/)[1].trim();s.has(t)||a.push('Driver value "'.concat(t,'" not found in any row'))}))}catch(e){D.e(e)}finally{D.f()}return e.abrupt("return",a.join("\n"));case 93:case"end":return e.stop()}}),e,null,[[13,25],[30,47,50,53],[56,84,87,90]])})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=i(t().mark((function e(n){var a,c,s,i,l,u,f,p,d,h,g,m,y,v,b,x,w,E,k,P,I,A,S,C,O,R,_,N,T,j,L,F,B,D,M,K,q;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],c=new Set,s=new Set,i=new Set,n=n.map((function(e){var t=e.match(/<[^>]+>/);return t?t[0]:e})),console.log("[ValidateForRun] CleanedInput Code Strings:",n),l=new Set,u=new Set,f=new Set,p=new Set,d=new Set,h=new Set,g=new Set,e.prev=13,e.next=16,fetch("../prompts/Codes.txt");case 16:if((m=e.sent).ok){e.next=19;break}throw new Error("Failed to load Codes.txt file");case 19:return e.next=21,m.text();case 21:y=e.sent,g=new Set(y.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))),e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(13),a.push("Error reading Codes.txt file: ".concat(e.t0.message)),e.abrupt("return",a);case 29:v=o(n),e.prev=30,v.s();case 32:if((b=v.n()).done){e.next=45;break}if((x=b.value).startsWith("<")&&x.endsWith(">")){e.next=37;break}return a.push("Invalid code string format: ".concat(x)),e.abrupt("continue",43);case 37:if(!x.startsWith("<BR>")){e.next=39;break}return e.abrupt("continue",43);case 39:(w=x.match(/row\d+\s*=\s*"([^"]*)"/g))&&w.forEach((function(e){var t=e.match(/row\d+\s*=\s*"([^"]*)"/)[1].split("|");t.length>0&&t.forEach((function(e){var t=e.trim();if(t.startsWith("*")){var n=t.substring(1).trim();n&&s.add(n)}else t&&s.add(t)}))})),(E=x.match(/<([^;]+);/))&&(k=E[1].trim(),i.add(k),k.endsWith("-VV")&&l.add(k),k.endsWith("-VR")&&u.add(k),k.endsWith("-RR")&&f.add(k),k.endsWith("-RV")&&p.add(k),k.endsWith("-EV")&&d.add(k),k.endsWith("-ER")&&h.add(k));case 43:e.next=32;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(30),v.e(e.t1);case 50:return e.prev=50,v.f(),e.finish(50);case 53:for(P=0,I=[].concat(r(l),r(u));P<I.length;P++)A=I[P],0===d.size&&0===p.size&&a.push("Code ".concat(A," requires another code with suffix -EV or -RV. Fix by adding another code with the correct suffix or by change to the EV/ER version of the same code."));for(S=0,C=[].concat(r(f),r(p));S<C.length;S++)O=C[S],0===h.size&&0===u.size&&a.push("Code ".concat(O," requires another code with suffix -ER or -VR"));R=o(n),e.prev=56,R.s();case 58:if((_=R.n()).done){e.next=82;break}if("<BR>"!==(N=_.value)){e.next=62;break}return e.abrupt("continue",80);case 62:if(T=N.match(/<([^;]+);/)){e.next=66;break}return a.push("Cannot extract code type from: ".concat(N)),e.abrupt("continue",80);case 66:if(j=T[1].trim(),g.has(j)||a.push('Invalid code type: "'.concat(j,'" not found in valid codes list')),"TAB"!==j){e.next=78;break}if(L=N.match(/label\d+="([^"]*)"/)){e.next=73;break}return a.push("TAB code missing label parameter"),e.abrupt("continue",80);case 73:(F=L[1]).length>30&&a.push('Tab label too long (max 30 chars): "'.concat(F,'"')),/[&,":;]/.test(F)&&a.push('Tab label contains illegal characters (&,":;): "'.concat(F,'"')),c.has(F)&&a.push('Duplicate tab label: "'.concat(F,'"')),c.add(F);case 78:(B=N.match(/row\d+="([^"]*)"/g))&&B.forEach((function(e){var t=e.match(/row\d+="([^"]*)"/)[1];t.split("|").length<2&&a.push('Invalid row format (missing required fields): "'.concat(t,'"'))}));case 80:e.next=58;break;case 82:e.next=87;break;case 84:e.prev=84,e.t2=e.catch(56),R.e(e.t2);case 87:return e.prev=87,R.f(),e.finish(87);case 90:D=o(n);try{for(D.s();!(M=D.n()).done;)K=M.value,(q=K.match(/driver\d+\s*=\s*"([^"]*)"/g))&&q.forEach((function(e){var t=e.match(/driver\d+\s*=\s*"([^"]*)"/)[1].trim();s.has(t)||a.push('Driver value "'.concat(t,'" not found in any row'))}))}catch(e){D.e(e)}finally{D.f()}return e.abrupt("return",a);case 93:case"end":return e.stop()}}),e,null,[[13,25],[30,47,50,53],[56,84,87,90]])})))).apply(this,arguments)}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(){g=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,c=Object.create(a.prototype),s=new N(r||[]);return o(c,"_invoke",{value:C(e,n,s)}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",h="suspendedYield",m="executing",y="completed",v={};function b(){}function x(){}function w(){}var E={};l(E,c,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(T([])));P&&P!==n&&r.call(P,c)&&(E=P);var I=w.prototype=b.prototype=Object.create(E);function A(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(o,a,c,s){var i=f(e[o],e,a);if("throw"!==i.type){var l=i.arg,u=l.value;return u&&"object"==d(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):t.resolve(u).then((function(e){l.value=e,c(l)}),(function(e){return n("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function C(t,n,r){var o=p;return function(a,c){if(o===m)throw Error("Generator is already running");if(o===y){if("throw"===a)throw c;return{value:e,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=O(s,r);if(i){if(i===v)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var l=f(t,n,r);if("normal"===l.type){if(o=r.done?y:h,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=y,r.method="throw",r.arg=l.arg)}}}function O(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,O(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=f(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var c=a.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function T(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(d(t)+" is not iterable")}return x.prototype=w,o(I,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:x,configurable:!0}),x.displayName=l(w,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,i,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},A(S.prototype),l(S.prototype,s,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var c=new S(u(e,n,r,o),a);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},A(I),l(I,i,"Generator"),l(I,c,(function(){return this})),l(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=T,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=r.call(c,"catchLoc"),l=r.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:T(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return(t=function(e){var t=function(e){if("object"!=d(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==d(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){b(a,r,o,c,s,"next",e)}function s(e){b(a,r,o,c,s,"throw",e)}c(void 0)}))}}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,s=[],i=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return s}}(e,t)||k(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function k(e,t){if(e){if("string"==typeof e)return P(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function I(e){try{console.log("Processing input text for code collection");var t,n=[],r=E(e.split("\n"));try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.trim()){var a=o.match(/<([^;>]+);(.*?)>/);if(a){var c,s=a[1].trim(),i=a[2].trim(),l={},u=E(i.matchAll(/row(\d+)\s*=\s*"([^"]*)"/g));try{for(u.s();!(c=u.n()).done;){var f=c.value,p=f[1],d=f[2];l["row".concat(p)]=d}}catch(e){u.e(e)}finally{u.f()}var h,g=E(i.matchAll(/(\w+)\s*=\s*"([^"]*)"/g));try{for(g.s();!(h=g.n()).done;){var m=h.value,y=m[1].trim(),v=m[2].trim();y.startsWith("row")||(l[y]=v)}}catch(e){g.e(e)}finally{g.f()}n.push({type:s,params:l})}}}}catch(e){r.e(e)}finally{r.f()}return console.log("Processed ".concat(n.length," codes")),n}catch(e){throw console.error("Error in populateCodeCollection:",e),e}}function A(e){return S.apply(this,arguments)}function S(){return S=x(g().mark((function e(t){var n,r,o,a,c,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Running code collection processing"),t&&Array.isArray(t)){e.next=4;break}throw new Error("Invalid code collection");case 4:n={processedCodes:0,createdTabs:[],errors:[]},r=null,o=[],a=g().mark((function e(a){var c,s,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t[a],s=c.type,e.prev=2,"MODEL"!==s){e.next=6;break}return console.log("MODEL code type encountered - skipping for now"),e.abrupt("return",0);case 6:if("TAB"!==s){e.next=11;break}return i=c.params.label1||c.params.Label1||"Tab_".concat(a),e.next=10,Excel.run(function(){var e=x(g().mark((function e(t){var a,c,s,l,u,f,p,d,h,m,y,v,b,x,w,E,k,P,I,A;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a=t.workbook.worksheets).load("items/name"),console.log("sheets",a),e.next=6,t.sync();case 6:return c=a.items.find((function(e){return e.name===i})),console.log("existingSheet",c),(s=t.workbook.worksheets.getItem("Financials")).load("position"),e.next=12,t.sync();case 12:if(console.log("Financials sheet is at position ".concat(s.position)),c){e.next=73;break}return e.prev=14,f=t.workbook.worksheets.getItem("Calcs"),e.next=18,t.sync();case 18:console.log("Using Calcs worksheet as template."),l=f.copy(),u="Calcs",e.next=57;break;case 23:return e.prev=23,e.t0=e.catch(14),console.warn("Calcs worksheet not found. Using Financials as template."),l=s.copy(),u="Financials",e.next=30,t.sync();case 30:return l.load("name"),e.next=33,t.sync();case 33:return console.log("Clearing contents and formats from row 10 down in new sheet ".concat(l.name," copied from ").concat(u)),l.getRange("10:10000").clear(Excel.ClearApplyTo.all),console.log("Linking header rows (1-8) in ".concat(l.name," back to Financials")),(p=l.getUsedRange(!0)).load(["columnCount","rowCount"]),e.next=41,t.sync();case 41:return d=p.columnCount>0?p.columnCount-1:0,h=$(d),m="A1:".concat(h,"8"),console.log("Processing header link range: ".concat(m)),(y=l.getRange(m)).load("values"),e.next=49,t.sync();case 49:for(v=y.values,b=0;b<v.length;b++)for(x=b+1,w=0;w<v[b].length;w++)null!==(E=v[b][w])&&""!==E&&(k=$(w),P="".concat(k).concat(x),I="=Financials!".concat(P),l.getRange(P).formulas=[[I]]);console.log("Setting font color for rows 2-8 in ".concat(l.name)),A="A2:".concat(h,"8"),l.getRange(A).format.font.color="#008000",console.log("Setting tab color for ".concat(l.name)),l.tabColor="#4472C4";case 57:if("Calcs"!==u){e.next=60;break}return e.next=60,t.sync();case 60:return console.log("newSheet created by copying ".concat(u," worksheet")),l.name=i,console.log("newSheet renamed to",i),l.position=s.position+1,console.log("Set position of ".concat(i," to ").concat(l.position)),o.push({name:i,worksheet:l}),r=i,e.next=69,t.sync();case 69:n.createdTabs.push(i),console.log("Tab created successfully:",i),e.next=76;break;case 73:console.log("Worksheet already exists:",i),o.push({name:i,worksheet:c}),r=i;case 76:e.next=82;break;case 78:throw e.prev=78,e.t1=e.catch(0),console.error("Detailed error in TAB processing:",e.t1),e.t1;case 82:case"end":return e.stop()}}),e,null,[[0,78],[14,23]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error processing TAB code: ".concat(e.message)),n.errors.push({codeIndex:a,codeType:s,error:e.message})}));case 10:return e.abrupt("return",0);case 11:if("TAB"===s){e.next=14;break}return e.next=14,Excel.run(function(){var e=x(g().mark((function e(t){var o,i,l,u,f,p,d,h,m,y,v;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.workbook.worksheets.getItem("Codes"),console.log("Got Codes worksheet"),(i=o.getUsedRange()).load("rowCount"),i.load("columnCount"),e.next=8,t.sync();case 8:return console.log("Used range: ".concat(i.rowCount," rows x ").concat(i.columnCount," columns")),l=t.workbook.worksheets.getItem(r),console.log("Got current worksheet:",r),(u=l.getUsedRange().getLastRow()).load("rowIndex"),e.next=15,t.sync();case 15:return f=u.rowIndex+2,console.log("Paste row:",f),p=-1,d=-1,(h=o.getRange("D1:D".concat(i.rowCount))).load("values"),e.next=23,t.sync();case 23:if(console.log("Loaded column D values"),h.values){e.next=27;break}throw console.error("columnD.values is null or undefined"),new Error("Failed to load values from column D in Codes worksheet");case 27:for(console.log("columnD.values length: ".concat(h.values.length)),console.log("First 10 values in column D:"),m=0;m<Math.min(10,h.values.length);m++)console.log("Row ".concat(m+1,": ").concat(h.values[m][0]));for(y=0;y<h.values.length;y++)h.values[y][0]===s&&(-1===p&&(p=y+1),d=y+1);if(-1!==p&&-1!==d){e.next=38;break}console.warn("Code type ".concat(s," not found in Codes worksheet. Skipping this code.")),n.errors.push({codeIndex:a,codeType:s,error:"Code type ".concat(s," not found in Codes worksheet")}),n.processedCodes++,e.next=59;break;case 38:return console.log("Found code type ".concat(s," in rows ").concat(p," to ").concat(d)),e.next=41,Excel.run(function(){var e=x(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("Codes").getRange("A".concat(p,":CX").concat(d)),t.workbook.worksheets.getItem(r).getRange("A".concat(f)).copyFrom(n,Excel.RangeCopyType.all),e.next=5,t.sync();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 41:return e.next=43,t.sync();case 43:return e.prev=43,console.log("Applying driver and assumption inputs to worksheet: ".concat(r)),(v=t.workbook.worksheets.getItem(r)).load("name"),e.next=49,t.sync();case 49:return e.next=51,C(v,f,c);case 51:console.log("Successfully applied driver and assumption inputs to worksheet: ".concat(r)),e.next=58;break;case 54:e.prev=54,e.t0=e.catch(43),console.error("Error applying driver and assumption inputs: ".concat(e.t0.message)),n.errors.push({codeIndex:a,codeType:s,error:"Error applying driver and assumption inputs: ".concat(e.t0.message)});case 58:n.processedCodes++;case 59:e.next=65;break;case 61:throw e.prev=61,e.t1=e.catch(0),console.error("Error processing code ".concat(s,":"),e.t1),e.t1;case 65:case"end":return e.stop()}}),e,null,[[0,61],[43,54]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error processing code ".concat(s,": ").concat(e.message)),n.errors.push({codeIndex:a,codeType:s,error:e.message})}));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),console.error("Error processing code ".concat(a,":"),e.t0),n.errors.push({codeIndex:a,codeType:s,error:e.t0.message});case 20:case"end":return e.stop()}}),e,null,[[2,16]])})),c=0;case 9:if(!(c<t.length)){e.next=17;break}return e.delegateYield(a(c),"t0",11);case 11:if(0!==e.t0){e.next=14;break}return e.abrupt("continue",14);case 14:c++,e.next=9;break;case 17:return s=y(y({},n),{},{assumptionTabs:o.map((function(e){return e.name}))}),console.log("runCodes finished. Returning:",s),e.abrupt("return",s);case 22:throw e.prev=22,e.t1=e.catch(0),console.error("Error in runCodes:",e.t1),e.t1;case 26:case"end":return e.stop()}}),e,null,[[0,22]])}))),S.apply(this,arguments)}function C(e,t,n){return O.apply(this,arguments)}function O(){return O=x(g().mark((function e(t,n,r){var o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="unknown",e.prev=2,e.next=5,Excel.run(function(){var e=x(g().mark((function e(n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.load("name"),e.next=3,n.sync();case 3:o=t.name;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),console.error("Failed to load worksheet name before calling helper",e.t0),new Error("Cannot determine worksheet name to proceed.");case 11:return a=1e3,e.prev=12,e.next=15,Excel.run(function(){var e=x(g().mark((function e(t){var n,r,a,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem(o),r=n.getUsedRange(),(a=r.getLastRow()).load("rowIndex"),e.next=6,t.sync();case 6:return c=a.rowIndex+1,console.log("lastRow",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 15:a=e.sent,e.next=22;break;case 18:throw e.prev=18,e.t1=e.catch(12),console.error("Failed to determine last row",e.t1),new Error("Cannot determine last row to proceed.");case 22:if(!("number"!=typeof a||a<=0)){e.next=25;break}throw console.error("Last row determination failed or returned invalid value (".concat(a,"). Cannot proceed safely.")),new Error("Failed to determine a valid last row for processing.");case 25:return e.next=27,Excel.run(function(){var e=x(g().mark((function e(t){var c,s,i,l,u,f,p,d,h,m,y,v,b,x,w,E,k,P,I,A,S,C,O,R,_,N,T,j,L,F,B,D,M,K,q;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a,s=t.workbook.worksheets.getItem(o),console.log("Processing driver/assumption inputs for worksheet: ".concat(o,", Code: ").concat(r.type,", Start Row: ").concat(n,", Using Last Row: ").concat(c)),i=["A","B","C","G","H","I","K","L","M","N","O","P","R"],l=r.type,u=-1,f=null,p="",e.prev=8,console.log("Attempting to get searchRange. calcsPasteRow: ".concat(n,", determinedLastRow: ").concat(c)),!("number"!=typeof n||"number"!=typeof c||n<=0||c<n)){e.next=15;break}console.error("Invalid range parameters for searchRange: calcsPasteRow=".concat(n,", determinedLastRow=").concat(c,". Skipping search.")),u=-1,e.next=23;break;case 15:return p="D".concat(n,":D").concat(c),console.log("Creating searchRange with address: ".concat(p)),f=s.getRange(p),console.log("Loading values for searchRange: ".concat(p)),f.load("values"),e.next=22,t.sync();case 22:console.log("Successfully loaded values for searchRange: ".concat(p));case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),console.error("Error loading/syncing searchRange (".concat(p,"): ").concat(e.t0.message),e.t0),u=-1;case 29:if(!f||!f.values){e.next=43;break}console.log("SearchRange (".concat(p,") has loaded values. Searching for codeValue: ").concat(l)),d=0;case 32:if(!(d<f.values.length)){e.next=40;break}if(f.values[d][0]!==l){e.next=37;break}return u=n+d,console.log("Found codeValue '".concat(l,"' at index ").concat(d,", resulting searchRow: ").concat(u)),e.abrupt("break",40);case 37:d++,e.next=32;break;case 40:-1===u&&console.log("CodeValue '".concat(l,"' not found within the loaded values of searchRange (").concat(p,").")),e.next=44;break;case 43:-1!==u&&(console.warn("searchRange (".concat(p,") object exists but '.values' property is not available after sync. Search cannot be performed.")),u=-1);case 44:if(-1!==u){e.next=47;break}return console.warn("Code type ".concat(l," not found or could not be searched for in column D (Range: ").concat(p||"Invalid","). Skipping inputs for this code.")),e.abrupt("return");case 47:console.log("Found code ".concat(l," at search row: ").concat(u)),h=u,m=!0;case 50:if(!m){e.next=63;break}return(y=s.getRange("B".concat(h))).load("format/fill/color"),e.next=55,t.sync();case 55:if(y.format&&y.format.fill?m="#CCFFCC"===y.format.fill.color:(console.warn("Could not read fill color for cell B".concat(h,". Assuming not green.")),m=!1),!m){e.next=61;break}if(!(++h>c+50)){e.next=61;break}throw console.error("Check row exceeded expected limits. Breaking loop."),new Error("Failed to find non-green check row within reasonable bounds.");case 61:e.next=50;break;case 63:console.log("Found check row (first non-green row in B at/after search row): ".concat(h)),v=1;case 65:if(!(v<=9)){e.next=78;break}if(!((b=u+v-1)>c+20)){e.next=70;break}return console.warn("Target row ".concat(b," seems too high. Skipping write for k=").concat(v,".")),e.abrupt("continue",75);case 70:1===v&&r.params.financialsdriver&&(s.getRange("I".concat(b)).values=[[r.params.financialsdriver]],console.log("Set financialsdriver at I".concat(b,": ").concat(r.params.financialsdriver))),(x=r.params["driver".concat(v)])&&(s.getRange("F".concat(b)).values=[[x]],console.log("Set driver".concat(v," at F").concat(b,": ").concat(x))),(w=r.params["label".concat(v)])&&(s.getRange("B".concat(b)).values=[[w]],console.log("Set label".concat(v," at B").concat(b,": ").concat(w)));case 75:v++,e.next=65;break;case 78:return e.next=80,t.sync();case 80:E=h,k=1;case 82:if(!(k<=200)){e.next=128;break}if(P=r.params["row".concat(k)]){e.next=86;break}return e.abrupt("continue",125);case 86:if(console.log("Processing row".concat(k,": ").concat(P)),I=P.split("*"),A=I.length-1,S=E+k-1,console.log("Base row for row".concat(k,": ").concat(S,", numNewRows: ").concat(A)),!(A>0)){e.next=103;break}return C="".concat(S+1,":").concat(S+A),console.log("Inserting ".concat(A," rows at ").concat(C)),s.getRange(C).insert(Excel.InsertShiftDirection.down),e.next=98,t.sync();case 98:for(console.log("Copying formats/formulas sequentially for inserted rows."),O=0;O<A;O++)R=S+O,_=S+O+1,N=s.getRange("".concat(R,":").concat(R)),T=s.getRange("".concat(_,":").concat(_)),console.log("  Copying formats from row ".concat(R," to ").concat(_)),T.copyFrom(N,Excel.RangeCopyType.formats),console.log("  Copying formulas from row ".concat(R," to ").concat(_)),T.copyFrom(N,Excel.RangeCopyType.formulas);return e.next=102,t.sync();case 102:console.log("Finished sequential copy for inserted rows.");case 103:j=0;case 104:if(!(j<=A)){e.next=121;break}L=S+j,F=I[j].split("|"),console.log("Populating row ".concat(L," with items: ").concat(I[j])),B=0;case 109:if(!(B<F.length)){e.next=118;break}if(!(B>=i.length)){e.next=113;break}return console.warn("Data item index ".concat(B," exceeds columnSequence length (").concat(i.length,"). Skipping.")),e.abrupt("continue",115);case 113:(D=F[B])&&"F"!==D.toUpperCase()&&(M=i[B],K=s.getRange("".concat(M).concat(L)),q=Number(D),isNaN(q)||""===D.trim()?""!==D.trim()&&(K.values=[[D]]):K.values=[[q]]);case 115:B++,e.next=109;break;case 118:j++,e.next=104;break;case 121:return e.next=123,t.sync();case 123:E+=A,console.log("Finished processing row".concat(k,". currentCheckRowForInserts is now ").concat(E));case 125:k++,e.next=82;break;case 128:console.log("Completed processing driver and assumption inputs for code ".concat(l," in worksheet ").concat(o));case 129:case"end":return e.stop()}}),e,null,[[8,25]])})));return function(t){return e.apply(this,arguments)}}());case 27:e.next=33;break;case 29:throw e.prev=29,e.t2=e.catch(0),console.error("Error in driverAndAssumptionInputs MAIN CATCH for code '".concat(r.type,"' in worksheet '").concat((null==t?void 0:t.name)||"unknown","': ").concat(e.t2.message),e.t2),e.t2;case 33:case"end":return e.stop()}}),e,null,[[0,29],[2,7],[12,18]])}))),O.apply(this,arguments)}function R(e,t){return _.apply(this,arguments)}function _(){return(_=x(g().mark((function e(t,n){var r,o,a,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to get last used row for column ".concat(n," in sheet ").concat(t.name)),e.prev=1,r=t.getRange("".concat(n,":").concat(n)),o=r.getUsedRange(!0),(a=o.getLastCell()).load("rowIndex"),e.next=8,t.context.sync();case 8:return c=a.rowIndex+1,console.log("Last used row in column ".concat(n," is ").concat(c)),e.abrupt("return",c);case 13:if(e.prev=13,e.t0=e.catch(1),"ItemNotFound"!==e.t0.code&&"GeneralException"!==e.t0.code){e.next=18;break}return console.warn("Could not find used range or last cell in column ".concat(n," of sheet ").concat(t.name,". Assuming empty or header only (returning 0).")),e.abrupt("return",0);case 18:throw console.error("Error in getLastUsedRow for column ".concat(n," on sheet ").concat(t.name,":"),e.t0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function N(e,t){return T.apply(this,arguments)}function T(){return(T=x(g().mark((function e(t,n){var r,o,a,c,s,i,l,u,f,p,d,h,m,y,v,b,x,w,E,k,P,I,A;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=10,o="F",a="A",c="AE",console.log("Running adjustDriversJS for sheet: ".concat(t.name," from row ").concat(r," to ").concat(n)),!(n<r)){e.next=8;break}return console.warn("adjustDriversJS: lastRow (".concat(n,") is less than START_ROW (").concat(r,"). Skipping.")),e.abrupt("return");case 8:return e.prev=8,s="".concat(o).concat(r,":").concat(o).concat(n),i="".concat(a).concat(r,":").concat(a).concat(n),l=t.getRange(s),u=t.getRange(i),l.load("values"),u.load("values"),e.next=17,t.context.sync();case 17:for(f=l.values,p=u.values,d=new Map,h=0;h<p.length;h++)null!==(m=p[h][0])&&""!==m&&d.set(m,r+h);for(console.log("Built lookup map from ".concat(a).concat(r,":").concat(a).concat(n," with ").concat(d.size," entries.")),y=[],v=0,b=0,x=0;x<f.length;x++)w=f[x][0],E=r+x,null!==w&&""!==w?d.has(w)?(k=d.get(w),P="".concat(c).concat(k),y.push([P]),v++):(console.warn("adjustDriversJS: Driver code '".concat(w,"' from cell ").concat(o).concat(E," not found in range ").concat(i,".")),y.push([null]),b++):y.push([null]);y.length>0?(I="".concat(c).concat(r,":").concat(c).concat(n),A=t.getRange(I),console.log("Writing ".concat(v," results (").concat(b," not found) to ").concat(I)),A.values=y):console.log("adjustDriversJS: No values to write to ".concat(c,".")),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(8),console.error("Error in adjustDriversJS for sheet ".concat(t.name,":"),e.t0);case 32:case"end":return e.stop()}}),e,null,[[8,29]])})))).apply(this,arguments)}function j(e,t){return L.apply(this,arguments)}function L(){return(L=x(g().mark((function e(t,n){var r,o,a,c,s,i,l,u,f,p,d,h,m,y,v,b,x,k,P,I,A,S,C,O,R,_,N,T,j,L,F,B,D,M,K,q,Y,U,$,J;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=10,o="AE",console.log("Running replaceIndirectsJS for sheet: ".concat(t.name," from row ").concat(r," to ").concat(n)),!(n<r)){e.next=6;break}return console.warn("replaceIndirectsJS: lastRow (".concat(n,") is less than START_ROW (").concat(r,"). Skipping.")),e.abrupt("return");case 6:return a="".concat(o).concat(r,":").concat(o).concat(n),c=t.getRange(a),e.prev=8,c.load("formulas"),e.next=12,t.context.sync();case 12:s=c.formulas,i=new Map,l=[],console.log("Replace_Indirects: Pass 1 - Identifying INDIRECT arguments"),u=0;case 17:if(!(u<s.length)){e.next=40;break}if(f=s[u][0],l.push({originalFormula:f,index:u}),"string"!=typeof f){e.next=37;break}p=0;case 22:if(d=f.toUpperCase(),-1!==(h=d.indexOf("INDIRECT(",p))&&!d.includes("INDEX(")){e.next=27;break}return e.abrupt("break",37);case 27:if(m=h+9,-1!==(y=f.indexOf(")",m))){e.next=32;break}return console.warn("Row ".concat(r+u,": Malformed INDIRECT found in formula: ").concat(f)),e.abrupt("break",37);case 32:(v=f.substring(m,y).trim())&&/^[A-Za-z0-9_!$:'". ]+$/.test(v)&&!i.has(v)&&(console.log("  Found reference to lookup: ".concat(v)),i.set(v,{range:null,value:void 0})),p=y+1,e.next=22;break;case 37:u++,e.next=17;break;case 40:if(console.log("Replace_Indirects: Loading values for ".concat(i.size," unique references.")),!(i.size>0)){e.next=49;break}b=E(i.entries());try{for(b.s();!(x=b.n()).done;){k=w(x.value,2),P=k[0],I=k[1];try{I.range=t.getRange(P),I.range.load(["values","text"])}catch(e){console.warn('Replace_Indirects: Error getting range for reference "'.concat(P,'". It might be invalid or on another sheet.'),e.debugInfo||e.message),i.set(P,{range:null,value:"#REF!"})}}}catch(e){b.e(e)}finally{b.f()}return e.next=46,t.context.sync();case 46:A=E(i.entries());try{for(A.s();!(S=A.n()).done;)if(C=w(S.value,2),O=C[0],(R=C[1]).range)try{_=R.range.text[0][0],R.value="DELETE"===_?"0":R.range.values[0][0]}catch(e){console.warn('Replace_Indirects: Error reading value for reference "'.concat(O,'" after sync.'),e.debugInfo||e.message),R.value="#VALUE!"}}catch(e){A.e(e)}finally{A.f()}console.log("Replace_Indirects: Finished loading reference values.");case 49:console.log("Replace_Indirects: Pass 2 - Replacing INDIRECT calls."),N=[],T=0,j=l;case 52:if(!(T<j.length)){e.next=81;break}if(L=j[T],"string"!=typeof(F=L.originalFormula)){e.next=77;break}B=0,D=20;case 58:if(!(B<D)){e.next=76;break}if(M=F.toUpperCase(),-1!==(K=M.indexOf("INDIRECT("))&&!M.includes("INDEX(")){e.next=63;break}return e.abrupt("break",76);case 63:if(q=K+9,-1!==(Y=F.indexOf(")",q))){e.next=67;break}return e.abrupt("break",76);case 67:U=F.substring(K,Y+1),$=F.substring(q,Y).trim(),J="#REF!",i.has($)?J=i.get($).value:console.warn("Row ".concat(r+L.index,': INDIRECT argument "').concat($,'" not found in lookup map during replacement.')),null==J?J=0:""===J||"string"==typeof J||"boolean"==typeof J&&(J=J?"TRUE":"FALSE"),F=F.replace(U,String(J)),B++,e.next=58;break;case 76:B===D&&console.warn("Row ".concat(r+L.index,": Max replacement loops reached for formula. Result might be incomplete: ").concat(F));case 77:N.push([F]);case 78:T++,e.next=52;break;case 81:console.log("Replace_Indirects: Writing ".concat(N.length," updated formulas back to ").concat(a)),c.formulas=N,e.next=89;break;case 85:throw e.prev=85,e.t0=e.catch(8),console.error("Error in replaceIndirectsJS for sheet ".concat(t.name," range ").concat(a,":"),e.t0.debugInfo||e.t0),e.t0;case 89:case"end":return e.stop()}}),e,null,[[8,85]])})))).apply(this,arguments)}function F(e,t,n){return B.apply(this,arguments)}function B(){return(B=x(g().mark((function e(t,n,r){var o,a,c,s,i,l,u,f,p,d,m,y,v,b,x,w,E,k,P,I,A,S,C,O,_,N,T,j,L,F,B,D,M,K,q,Y,U,$,G,z,W,V,H,X,Z,Q,ee,te,ne,re,oe,ae,ce,se,ie,le,ue,fe,pe,de,he,ge,me,ye,ve,be,xe,we,Ee,ke;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Running populateFinancialsJS for sheet: ".concat(t.name," (lastRow: ").concat(n,") -> ").concat(r.name)),a="C",c="B",s="D",i="AE",l="I",u="B",f="D",p="J",d="AE",m="P",y="CX",v="#008000",b='_(* $#,##0_);_(* $(#,##0);_(* "$" -_);_(@_)',!(n<(o=10))){e.next=18;break}return console.warn("populateFinancialsJS: lastRow (".concat(n,") is less than CALCS_FIRST_ROW (").concat(o,"). Skipping.")),e.abrupt("return");case 18:return e.prev=18,console.log("populateFinancialsJS: Loading assumption data up to row ".concat(n)),(w=t.getRange("".concat(a).concat(o,":").concat(a).concat(n))).load("values"),E=r.getRange("".concat(l,":").concat(l)),(k=E.getUsedRange(!0)).load("rowCount"),P=0,e.next=28,t.context.sync();case 28:if(!(k.rowCount>0)){e.next=60;break}return e.prev=29,(I=k.getLastCell()).load("rowIndex"),e.next=34,t.context.sync();case 34:P=I.rowIndex+1,e.next=60;break;case 37:return e.prev=37,e.t0=e.catch(29),console.warn("Could not get last cell directly for Financials col ".concat(l,". Error: ").concat(e.t0.message,". Attempting fallback range loading.")),e.prev=40,(A=r.getRange("".concat(u,"1:").concat(u,"10000"))).load("values"),e.next=45,t.context.sync();case 45:S=A.values.length-1;case 46:if(!(S>=0)){e.next=53;break}if(null===A.values[S][0]||""===A.values[S][0]){e.next=50;break}return P=S+1,e.abrupt("break",53);case 50:S--,e.next=46;break;case 53:0===P&&console.warn("Fallback range load for Financials col ".concat(u," also yielded no data.")),e.next=60;break;case 56:e.prev=56,e.t1=e.catch(40),console.error("Error during fallback range loading for Financials col ".concat(u,":"),e.t1),P=0;case 60:return e.prev=60,e.next=63,R(r,u);case 63:C=e.sent,P=Math.max(P,C),e.next=70;break;case 67:e.prev=67,e.t2=e.catch(60),console.warn("Could not get last row from Col B: ".concat(e.t2.message));case 70:if(console.log("Financials last relevant row used for processing: ".concat(P)),O=new Map,!(P>0)){e.next=81;break}return(_=r.getRange("".concat(l,"1:").concat(l).concat(P))).load("values"),e.next=77,t.context.sync();case 77:for(N=0;N<_.values.length;N++)null!==(T=_.values[N][0])&&""!==T&&(O.has(T)||O.set(T,N+1));console.log("Built Financials code map with ".concat(O.size," entries.")),e.next=82;break;case 81:console.warn("Financials sheet column ".concat(l," appears empty or last row not found. No codes loaded for map."));case 82:return j=[],console.log("populateFinancialsJS: Syncing assumption codes load..."),e.next=86,t.context.sync();case 86:L=w.values,console.log("populateFinancialsJS: Processing ".concat(null!==(x=null==L?void 0:L.length)&&void 0!==x?x:0," assumption rows.")),F=0;case 89:if(!(F<(null!==(B=null==L?void 0:L.length)&&void 0!==B?B:0))){e.next=105;break}if(D=L[F][0],M=o+F,null===D||""===D){e.next=102;break}if(K="='".concat(t.name,"'!").concat(c).concat(M),q="='".concat(t.name,"'!").concat(s).concat(M),Y="='".concat(t.name,"'!").concat(i).concat(M),O.has(D)){e.next=99;break}return console.log("  Skipping Code ".concat(D," (Assumption Row ").concat(M,"): Code not found in Financials template column ").concat(l,". Cannot determine target row.")),e.abrupt("continue",102);case 99:U=O.get(D),console.log("  Task Prep: Code ".concat(D," (Assumption Row ").concat(M,") -> Target Financials Row (for insertion): ").concat(U)),j.push({targetRow:U,assumptionRow:M,code:D,addressB:K,addressD:q,addressMonths:Y});case 102:F++,e.next=89;break;case 105:if(0!==j.length){e.next=108;break}return console.log("No matching codes found. Nothing to insert or populate."),e.abrupt("return");case 108:for(j.sort((function(e,t){return t.targetRow-e.targetRow})),console.log("Sorted ".concat(j.length," tasks for insertion.")),console.log("Performing row insertions..."),$=0,G=j;$<G.length;$++)z=G[$],r.getRange("".concat(z.targetRow,":").concat(z.targetRow)).insert(Excel.InsertShiftDirection.down);return e.next=114,t.context.sync();case 114:console.log("Finished row insertions."),console.log("Calculating final adjusted rows for population/autofill..."),W=h(new Set(j.map((function(e){return e.targetRow})))).sort((function(e,t){return e-t})),V=new Map,H=0,W.forEach((function(e){var t=j.filter((function(t){return t.targetRow===e})),n=e+H;t.forEach((function(t){V.set(t.assumptionRow,n),console.log("  Mapping: Code ".concat(t.code,", Assumption Row ").concat(t.assumptionRow,", Original Target ").concat(e,", Final Adjusted Row ").concat(n)),n++})),H+=t.length})),console.log("Populating inserted rows (using adjusted rows)..."),X=0,Z=j;case 122:if(!(X<Z.length)){e.next=156;break}if(Q=Z[X],null!=(ee=V.get(Q.assumptionRow))){e.next=128;break}return console.error("Could not find adjusted row for task with Assumption Row ".concat(Q.assumptionRow,", Code ").concat(Q.code,". Skipping population.")),e.abrupt("continue",153);case 128:te=r.getRange("".concat(u).concat(ee)),ne=r.getRange("".concat(f).concat(ee)),re=r.getRange("".concat(p).concat(ee)),oe=r.getRange("".concat(d).concat(ee)),te.formulas=[[Q.addressB]],te.format.font.bold=!1,te.format.font.italic=!1,te.format.indentLevel=2,ne.formulas=[[Q.addressD]],ne.format.font.bold=!1,ne.format.font.italic=!1,ne.format.indentLevel=2,ae=String(Q.code).substring(0,2).toUpperCase(),"",ce="IS"===ae||"CF"===ae?"=SUMIF(R3,R2C,R[0])":"=SUMIF(R4,R2C,R[0])",re.formulasR1C1=[[ce]],re.format.font.bold=!1,re.format.font.italic=!1,re.format.numberFormat=b,oe.formulas=[[Q.addressMonths]],oe.format.font.bold=!1,oe.format.font.italic=!1,oe.format.font.color=v,oe.format.numberFormat=b;try{se=r.getRange("S".concat(ee,":AD").concat(ee)),ie=J("AD")-J("S")+1,le=[Array(ie).fill("=SUMIFS('Actual Data'!$B:$B,'Actual Data'!$D:$D,EOMONTH(INDIRECT(ADDRESS(2,COLUMN())),0),'Actual Data'!$E:$E,@INDIRECT(ADDRESS(ROW(),2)))")],se.formulas=le,se.format.numberFormat=b,se.format.font.bold=!1,se.format.font.italic=!1,se.format.font.color="#7030A0",console.log("  Set SUMIFS formula for S".concat(ee,":AD").concat(ee))}catch(e){console.error("Error setting SUMIFS formula for row ".concat(ee," (Code: ").concat(Q.code,"):"),e.debugInfo||e)}case 153:X++,e.next=122;break;case 156:return console.log("Finished setting values/formulas/formats for inserted rows."),e.next=159,t.context.sync();case 159:console.log("Performing autofills (using adjusted rows)..."),ue=0,fe=j;case 161:if(!(ue<fe.length)){e.next=171;break}if(pe=fe[ue],null!=(de=V.get(pe.assumptionRow))){e.next=167;break}return console.error("Could not find adjusted row for task with Assumption Row ".concat(pe.assumptionRow,", Code ").concat(pe.code,". Skipping autofill.")),e.abrupt("continue",168);case 167:try{he=r.getRange("".concat(p).concat(de)),ge=r.getRange("".concat(p).concat(de,":").concat(m).concat(de)),he.autoFill(ge,Excel.AutoFillType.fillDefault),me=r.getRange("".concat(d).concat(de)),ye=r.getRange("".concat(d).concat(de,":").concat(y).concat(de)),me.autoFill(ye,Excel.AutoFillType.fillDefault)}catch(e){console.error("Error during autofill for adjusted row ".concat(de," (Code: ").concat(pe.code,", Original Target: ").concat(pe.targetRow,"):"),e.debugInfo||e)}case 168:ue++,e.next=161;break;case 171:return console.log("Finished setting up autofills."),e.next=174,t.context.sync();case 174:return console.log("Autofills synced."),console.log("Modifying codes in ".concat(t.name," column ").concat(a," (").concat(o,":").concat(n,") by prepending '-'...")),e.prev=176,(ve=t.getRange("".concat(a).concat(o,":").concat(a).concat(n))).load("values"),e.next=181,t.context.sync();case 181:for(be=ve.values,xe=[],we=0,Ee=0;Ee<be.length;Ee++)null===(ke=be[Ee][0])||""===ke||String(ke).startsWith("-")?xe.push([ke]):(xe.push(["-"+ke]),we++);if(!(we>0)){e.next=193;break}return console.log("  Writing ".concat(we," modified codes back to ").concat(a).concat(o,":").concat(a).concat(n)),ve.values=xe,e.next=190,t.context.sync();case 190:console.log("  Synced code modifications."),e.next=194;break;case 193:console.log("  No codes needed modification.");case 194:e.next=199;break;case 196:e.prev=196,e.t3=e.catch(176),console.error("Error modifying codes in ".concat(t.name," column ").concat(a,":"),e.t3.debugInfo||e.t3);case 199:console.log("populateFinancialsJS successfully completed for ".concat(t.name," -> ").concat(r.name)),e.next=206;break;case 202:throw e.prev=202,e.t4=e.catch(18),console.error("Error in populateFinancialsJS for sheet ".concat(t.name," -> ").concat(r.name,":"),e.t4.debugInfo||e.t4),e.t4;case 206:case"end":return e.stop()}}),e,null,[[18,202],[29,37],[40,56],[60,67],[176,196]])})))).apply(this,arguments)}function D(e){return M.apply(this,arguments)}function M(){return M=x(g().mark((function e(t){var n,r,o,a,c,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Starting processing for ".concat(t.length," assumption tabs:"),t),t&&0!==t.length){e.next=4;break}return console.log("No assumption tabs provided to process."),e.abrupt("return");case 4:n="Financials",r="AE",o=10,e.prev=8,a=E(t),e.prev=10,s=g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.value,console.log("\nProcessing Assumption Tab: ".concat(t)),e.prev=2,e.next=5,Excel.run(function(){var e=x(g().mark((function e(a){var c,s,i,l,u,f,p;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.workbook.worksheets.getItem(t),s=a.workbook.worksheets.getItem(n),c.load("name"),s.load("name"),e.next=6,a.sync();case 6:return console.log("Successfully got references for ".concat(c.name," and ").concat(s.name)),e.next=9,R(c,"B");case 9:if(!((i=e.sent)<o)){e.next=13;break}return console.warn("Skipping tab ".concat(t," as last used row in Col B (").concat(i,") is before start row (").concat(o,").")),e.abrupt("return");case 13:return console.log("Last row in Col B for ".concat(t,": ").concat(i)),e.next=16,N(c,i);case 16:return e.next=18,j(c,i);case 18:if(l=i,console.log("Using last row for subsequent steps: ".concat(l)),!(l<o)){e.next=23;break}return console.warn("Skipping remaining steps for ".concat(t," as updated last row (").concat(l,") is invalid.")),e.abrupt("return");case 23:return e.next=25,F(c,l,s);case 25:return console.log("Deleting green rows in ".concat(t,"...")),e.next=28,K(c,o,l);case 28:return u=e.sent,console.log("After deleting green rows, last row is now: ".concat(u)),e.next=32,Y(c,o,u);case 32:return console.log("Set font color to white in column A from rows ".concat(o,"-").concat(u)),console.log("Autofilling ".concat(r).concat(o,":").concat(r).concat(u," to ").concat("CX"," on ").concat(t)),f=c.getRange("".concat(r).concat(o,":").concat(r).concat(u)),p=c.getRange("".concat(r).concat(o,":").concat("CX").concat(u)),f.autoFill(p,Excel.AutoFillType.fillDefault),console.log("Setting row 9 interior color to none for ".concat(t)),c.getRange("9:9").format.fill.clear(),e.next=42,a.sync();case 42:console.log("Finished processing and syncing for tab ".concat(t));case 43:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error processing tab ".concat(t,":"),e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})),a.s();case 13:if((c=a.n()).done){e.next=17;break}return e.delegateYield(s(),"t0",15);case 15:e.next=13;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),a.e(e.t1);case 22:return e.prev=22,a.f(),e.finish(22);case 25:return console.log("\nPerforming final operations on ".concat(n)),e.prev=26,e.next=29,Excel.run(function(){var e=x(g().mark((function e(t){var r,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.workbook.worksheets.getItem(n)).load("name"),e.next=4,t.sync();case 4:return e.next=6,R(r,"B");case 6:if(!((a=e.sent)<o)){e.next=10;break}return console.warn("Skipping final autofill on ".concat(n," as last row (").concat(a,") is before start row (").concat(o,").")),e.abrupt("return");case 10:return console.log("Last row in Col B for ".concat(n,": ").concat(a)),e.next=13,t.sync();case 13:console.log("Finished final operations on ".concat(n));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(26),console.error("Error during final operations on ".concat(n,":"),e.t2);case 34:console.log("Finished processing all assumption tabs."),e.next=40;break;case 37:e.prev=37,e.t3=e.catch(8),console.error("Error in processAssumptionTabs main function:",e.t3);case 40:case"end":return e.stop()}}),e,null,[[8,37],[10,19,22,25],[26,31]])}))),M.apply(this,arguments)}function K(e,t,n){return q.apply(this,arguments)}function q(){return(q=x(g().mark((function e(t,n,r){var o,a,c,s,i,l,u,f;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Deleting green rows (#CCFFCC) in ".concat(t.name," from row ").concat(n," to ").concat(r)),e.prev=1,o=[],a=n;case 4:if(!(a<=r)){e.next=20;break}return c="B".concat(a),(s=t.getRange(c)).load("format/fill/color"),e.prev=8,e.next=11,t.context.sync();case 11:s.format&&s.format.fill&&"#CCFFCC"===s.format.fill.color&&o.push(a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),console.warn("Error checking color for ".concat(c,": ").concat(e.t0.message));case 17:a++,e.next=4;break;case 20:if(o.sort((function(e,t){return t-e})),console.log("Found ".concat(o.length," green rows to delete")),!(o.length>0)){e.next=34;break}i=E(o);try{for(i.s();!(l=i.n()).done;)u=l.value,console.log("Deleting row ".concat(u)),t.getRange("".concat(u,":").concat(u)).delete(Excel.DeleteShiftDirection.up)}catch(e){i.e(e)}finally{i.f()}return e.next=27,t.context.sync();case 27:return e.next=29,R(t,"B");case 29:return f=e.sent,console.log("New last row after deletions: ".concat(f)),e.abrupt("return",f);case 34:return console.log("No green rows found to delete"),e.abrupt("return",r);case 36:e.next=42;break;case 38:return e.prev=38,e.t1=e.catch(1),console.error("Error in deleteGreenRows: ".concat(e.t1.message),e.t1),e.abrupt("return",r);case 42:case"end":return e.stop()}}),e,null,[[1,38],[8,14]])})))).apply(this,arguments)}function Y(e,t,n){return U.apply(this,arguments)}function U(){return(U=x(g().mark((function e(t,n,r){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Setting font color to white in column A for ".concat(t.name," from row ").concat(n," to ").concat(r)),e.prev=1,t.getRange("A".concat(n,":A").concat(r)).format.font.color="#FFFFFF",e.next=6,t.context.sync();case 6:console.log("Successfully set font color to white in column A for rows ".concat(n,"-").concat(r)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("Error in setColumnAFontWhite: ".concat(e.t0.message),e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function $(e){for(var t="";e>=0;)t=String.fromCharCode(e%26+"A".charCodeAt(0))+t,e=Math.floor(e/26)-1;return t}function J(e){e=e.toUpperCase();for(var t=0,n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-"A".charCodeAt(0)+1);return t-1}function G(e){return z.apply(this,arguments)}function z(){return z=x(g().mark((function e(t){var n,r,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="S",r="AD",e.prev=2,o=[].concat(h(t),["Financials"]),console.log("Attempting to hide specific rows/columns on sheets [".concat(o.join(", "),"] and navigate...")),e.next=7,Excel.run(function(){var e=x(g().mark((function e(a){var c,s,i,l,u,f,p,d,h,m,y,v,b,x,w,k,P;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c=a.workbook.worksheets).load("items/name"),e.next=4,a.sync();case 4:console.log("Found ".concat(c.items.length," worksheets. Targeting ").concat(o.length," specific sheets.")),s=!1,i=J(r),l=i>0?$(i-1):n,u=E(c.items);try{for(u.s();!(f=u.n()).done;)if(p=f.value,d=p.name,o.includes(d)){console.log("Queueing hide operations for: ".concat(d));try{p.getRange("2:8").rowHidden=!0,"Financials"===d?(console.log("  -> Hiding Columns C:I for Financials"),p.getRange("C:I").columnHidden=!0):(console.log("  -> Hiding Columns C:E for ".concat(d)),p.getRange("C:E").columnHidden=!0),"Financials"===d?(console.log("  -> Hiding Actuals range ".concat(n,":").concat(r)),p.getRange("".concat(n,":").concat(r)).columnHidden=!0):t.includes(d)&&(console.log("  -> Hiding Actuals range ".concat(n,":").concat(l)),p.getRange("".concat(n,":").concat(l)).columnHidden=!0),s=!0}catch(e){console.error("  Error queuing hide operations for ".concat(d,": ").concat(e.message),{code:e.code,debugInfo:e.debugInfo?JSON.stringify(e.debugInfo):"N/A"})}}}catch(e){u.e(e)}finally{u.f()}if(!s){e.next=23;break}return console.log("Attempting to sync hide columns/rows operations..."),e.prev=12,e.next=15,a.sync();case 15:console.log("Successfully synced hide columns/rows operations."),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),console.error("Error syncing hide columns/rows operations: ".concat(e.t0.message),{code:e.t0.code,debugInfo:e.t0.debugInfo?JSON.stringify(e.t0.debugInfo):"N/A"});case 21:e.next=24;break;case 23:console.log("No target sheets found or no hide operations were queued.");case 24:console.log("Activating and selecting A1 on assumption tabs..."),h=E(t),e.prev=26,h.s();case 28:if((m=h.n()).done){e.next=46;break}return y=m.value,e.prev=30,console.log("  Activating and selecting A1 for: ".concat(y)),(v=a.workbook.worksheets.getItem(y)).activate(),v.getRange("A1").select(),e.next=38,a.sync();case 38:console.log("  Synced A1 view reset for ".concat(y,".")),e.next=44;break;case 41:e.prev=41,e.t1=e.catch(30),console.error("  Error resetting view for ".concat(y,": ").concat(e.t1.message));case 44:e.next=28;break;case 46:e.next=51;break;case 48:e.prev=48,e.t2=e.catch(26),h.e(e.t2);case 51:return e.prev=51,h.f(),e.finish(51);case 54:console.log("Activating and selecting J9 on assumption tabs..."),b=E(t),e.prev=56,b.s();case 58:if((x=b.n()).done){e.next=76;break}return w=x.value,e.prev=60,console.log("  Activating and selecting J9 for: ".concat(w)),(k=a.workbook.worksheets.getItem(w)).activate(),k.getRange("J9").select(),e.next=68,a.sync();case 68:console.log("  Synced J9 view reset for ".concat(w,".")),e.next=74;break;case 71:e.prev=71,e.t3=e.catch(60),console.error("  Error resetting view to J9 for ".concat(w,": ").concat(e.t3.message));case 74:e.next=58;break;case 76:e.next=81;break;case 78:e.prev=78,e.t4=e.catch(56),b.e(e.t4);case 81:return e.prev=81,b.f(),e.finish(81);case 84:return e.prev=84,console.log("Navigating to Financials sheet and selecting J9..."),(P=a.workbook.worksheets.getItem("Financials")).activate(),P.getRange("J9").select(),e.next=92,a.sync();case 92:console.log("Successfully navigated to Financials!J9."),e.next=98;break;case 95:e.prev=95,e.t5=e.catch(84),console.error("Error navigating to Financials sheet J9: ".concat(e.t5.message),{code:e.t5.code,debugInfo:e.t5.debugInfo?JSON.stringify(e.t5.debugInfo):"N/A"});case 98:console.log("Finished hideColumnsAndNavigate function.");case 99:case"end":return e.stop()}}),e,null,[[12,18],[26,48,51,54],[30,41],[56,78,81,84],[60,71],[84,95]])})));return function(t){return e.apply(this,arguments)}}());case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(2),console.error("Critical error in hideColumnsAndNavigate:",e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[2,9]])}))),z.apply(this,arguments)}function W(e){return V.apply(this,arguments)}function V(){return V=x(g().mark((function e(t){var n,r=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:null,e.prev=1,t&&"string"==typeof t){e.next=4;break}throw new Error("Invalid base64 string provided");case 4:if(/^[A-Za-z0-9+/]*={0,2}$/.test(t)){e.next=6;break}throw new Error("Invalid base64 format");case 6:return e.next=8,Excel.run(function(){var e=x(g().mark((function e(r){var o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=r.workbook).insertWorksheetsFromBase64){e.next=3;break}throw new Error("This feature requires Excel API requirement set 1.13 or later");case 3:return e.prev=3,e.next=6,o.insertWorksheetsFromBase64(t,{sheetNames:n});case 6:return e.next=8,r.sync();case 8:console.log("Worksheets inserted successfully"),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),console.error("Error during worksheet insertion:",e.t0),new Error("Failed to insert worksheets: ".concat(e.t0.message));case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}());case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),console.error("Error inserting worksheets from base64:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),V.apply(this,arguments)}function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function X(){X=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof y?t:y,c=Object.create(a.prototype),s=new R(r||[]);return o(c,"_invoke",{value:A(e,n,s)}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};l(x,c,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(_([])));E&&E!==n&&r.call(E,c)&&(x=E);var k=b.prototype=y.prototype=Object.create(x);function P(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(o,a,c,s){var i=f(e[o],e,a);if("throw"!==i.type){var l=i.arg,u=l.value;return u&&"object"==H(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):t.resolve(u).then((function(e){l.value=e,c(l)}),(function(e){return n("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,n,r){var o=p;return function(a,c){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===a)throw c;return{value:e,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=S(s,r);if(i){if(i===m)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var l=f(t,n,r);if("normal"===l.type){if(o=r.done?g:d,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=g,r.method="throw",r.arg=l.arg)}}}function S(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var a=f(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var c=a.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function _(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(H(t)+" is not iterable")}return v.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},P(I.prototype),l(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var c=new I(u(e,n,r,o),a);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},P(k),l(k,i,"Generator"),l(k,c,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=_,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=r.call(c,"catchLoc"),l=r.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:_(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function Z(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function te(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){ee(a,r,o,c,s,"next",e)}function s(e){ee(a,r,o,c,s,"throw",e)}c(void 0)}))}}function ne(e,t){var n=[10,11,12,13,14,15,17],r=[];if(!e)return"";for(var o=0,a=[0,1,2,6,7,8,10,11,12,13,14,15,17];o<a.length;o++){var c=a[o],s=e.length>c&&null!==e[c]&&void 0!==e[c]?e[c]:"",i=t&&t.length>c?t[c]:null;n.includes(c)&&"string"==typeof i&&i.startsWith("=")&&(s="F");var l=String(s).replace(/"/g,'""');r.push(l)}return r.join("|")}function re(e,t,n,r,o,a){for(var c="<".concat(o,";"),s=1,i=n;i<=r;i++)if(e&&i<e.length&&t&&i<t.length){var l=ne(e[i],t[i]);c+="row".concat(s,'="').concat(l,'";'),s++}return c+">"}function oe(){return ae.apply(this,arguments)}function ae(){return ae=te(X().mark((function e(){return X().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=te(X().mark((function e(t){var n,r,o,a,c,s,i,l,u,f,p,d,h,g,m,y,v,b,x,w,E,k,P,I,A;return X().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting generateTabString (dynamic range)..."),(n=t.workbook.worksheets).load("items/name"),e.next=5,t.sync();case 5:console.log("Found ".concat(n.items.length," sheets.")),r="",o=Z(n.items),e.prev=8,o.s();case 10:if((a=o.n()).done){e.next=65;break}return c=a.value,console.log("Processing sheet: ".concat(c.name)),s="",i=0,e.prev=15,l=c.getRange("B1048576"),(u=l.getRangeEdge(Excel.KeyboardDirection.up)).load("rowIndex"),e.next=21,t.sync();case 21:if(i=u.rowIndex+1,console.log("Sheet ".concat(c.name,": Last used row in Col B found at: ").concat(i)),!(i<9)){e.next=27;break}return console.log("Sheet ".concat(c.name,": Last used row (").concat(i,") is before row 9. Skipping code generation.")),r+='<TAB; label1="'.concat(c.name,'";>\n\n'),e.abrupt("continue",63);case 27:return f="A9:R".concat(i),console.log("Sheet ".concat(c.name,": Loading dynamic range: ").concat(f)),(p=c.getRange(f)).load(["values","formulas","rowCount","rowIndex"]),e.next=33,t.sync();case 33:if(d=p.values,h=p.formulas,g=p.rowCount,9!==(m=p.rowIndex+1)&&console.warn("Sheet ".concat(c.name,": Loaded range started at ").concat(m," instead of 9.")),d&&0!==g){e.next=42;break}return console.log("Sheet ".concat(c.name,": No values loaded from range ").concat(f,". Skipping code generation.")),r+='<TAB; label1="'.concat(c.name,'";>\n\n'),e.abrupt("continue",63);case 42:y=!1,v=0;case 44:if(!(v<g)){e.next=51;break}if(!(d[v]&&d[v].length>3&&d[v][3]&&""!==String(d[v][3]).trim())){e.next=48;break}return y=!0,e.abrupt("break",51);case 48:v++,e.next=44;break;case 51:if(console.log("Sheet ".concat(c.name,": Has significant data in Column D (in loaded range)? ").concat(y)),y)for(console.log("Sheet ".concat(c.name,": Generating blocks based on Column D changes.")),E=-1,k="",P=0;P<g;P++)""!==(I=d[P]&&d[P].length>3&&d[P][3]?String(d[P][3]).trim():"")?-1===E?(E=P,k=I):I!==k&&(s&&(s+="\n"),s+=re(d,h,E,P-1,k),E=P,k=I):-1!==E&&(s&&(s+="\n"),s+=re(d,h,E,P-1,k),E=-1,k=""),P===g-1&&-1!==E&&(s&&(s+="\n"),s+=re(d,h,E,P,k));else{for(console.log("Sheet ".concat(c.name,": Generating MANUAL-ER block.")),s+="<MANUAL-ER;",b=1,x=0;x<g;x++)d[x]&&h[x]&&(w=ne(d[x],h[x]),s+="row".concat(b,'="').concat(w,'";'),b++);s+=">"}e.next=60;break;case 55:e.prev=55,e.t0=e.catch(15),console.error("Error processing sheet ".concat(c.name,": ").concat(e.t0)),e.t0 instanceof OfficeExtension.Error&&console.error("Debug info: "+JSON.stringify(e.t0.debugInfo)),s="\x3c!-- Error processing sheet data --\x3e";case 60:A='<TAB; label1="'.concat(c.name,'";>'),s&&(A+="\n"+s),r+=A+"\n\n";case 63:e.next=10;break;case 65:e.next=70;break;case 67:e.prev=67,e.t1=e.catch(8),o.e(e.t1);case 70:return e.prev=70,o.f(),e.finish(70);case 73:console.log("--- FINAL GENERATED STRING ---"),console.log(r),console.log("--- END FINAL GENERATED STRING ---");case 76:case"end":return e.stop()}}),e,null,[[8,67,70,73],[15,55]])})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error in generateTabString top level: "+e.t0),e.t0 instanceof OfficeExtension.Error&&console.error("Debug info: "+JSON.stringify(e.t0.debugInfo));case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),ae.apply(this,arguments)}function ce(){ce=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof y?t:y,c=Object.create(a.prototype),s=new R(r||[]);return o(c,"_invoke",{value:A(e,n,s)}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};l(x,c,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(_([])));E&&E!==n&&r.call(E,c)&&(x=E);var k=b.prototype=y.prototype=Object.create(x);function P(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(o,a,c,s){var i=f(e[o],e,a);if("throw"!==i.type){var l=i.arg,u=l.value;return u&&"object"==fe(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):t.resolve(u).then((function(e){l.value=e,c(l)}),(function(e){return n("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,n,r){var o=p;return function(a,c){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===a)throw c;return{value:e,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=S(s,r);if(i){if(i===m)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var l=f(t,n,r);if("normal"===l.type){if(o=r.done?g:d,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=g,r.method="throw",r.arg=l.arg)}}}function S(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var a=f(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var c=a.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function _(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(fe(t)+" is not iterable")}return v.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},P(I.prototype),l(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var c=new I(u(e,n,r,o),a);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},P(k),l(k,i,"Generator"),l(k,c,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=_,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=r.call(c,"catchLoc"),l=r.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:_(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function se(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ie(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function le(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){le(a,r,o,c,s,"next",e)}function s(e){le(a,r,o,c,s,"throw",e)}c(void 0)}))}}function fe(e){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fe(e)}n(16797),performance.now();var pe={OPENAI_API_KEY:"",PINECONE_API_KEY:""},de=["https://localhost:3002/src/prompts/Encoder_System.txt","https://localhost:3002/src/prompts/Encoder_Main.txt","https://localhost:3002/src/prompts/Followup_System.txt","https://localhost:3002/src/prompts/Structure_System.txt","https://localhost:3002/src/prompts/Validation_System.txt","https://localhost:3002/src/prompts/Validation_Main.txt"],he={codes:{name:"codes",apiEndpoint:"https://codes-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2trainingdata:{name:"call2trainingdata",apiEndpoint:"https://call2trainingdata-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2context:{name:"call2context",apiEndpoint:"https://call2context-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call1context:{name:"call1context",apiEndpoint:"https://call1context-zmg9zog.svc.aped-4627-b74a.pinecone.io"}},ge="gpt-4.1";function me(e){return ye.apply(this,arguments)}function ye(){return ye=ue(ce().mark((function e(t){var n,r,o,a,c,s=arguments;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:ge,r=s.length>2&&void 0!==s[2]?s[2]:.7,e.prev=2,console.log("Calling OpenAI API with model: ".concat(n)),pe.OPENAI_API_KEY){e.next=6;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 6:return e.next=8,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(pe.OPENAI_API_KEY)},body:JSON.stringify({model:n,messages:t,temperature:r})});case 8:if((o=e.sent).ok){e.next=15;break}return e.next=12,o.json().catch((function(){return null}));case 12:throw a=e.sent,console.error("OpenAI API error response:",a),new Error("OpenAI API error: ".concat(o.status," ").concat(o.statusText));case 15:return e.next=17,o.json();case 17:return c=e.sent,console.log("OpenAI API response received"),e.abrupt("return",c.choices[0].message.content);case 22:throw e.prev=22,e.t0=e.catch(2),console.error("Error calling OpenAI API:",e.t0),e.t0;case 26:case"end":return e.stop()}}),e,null,[[2,22]])}))),ye.apply(this,arguments)}function ve(e){return be.apply(this,arguments)}function be(){return(be=ue(ce().mark((function e(t){var n,r,o;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Creating embedding for text"),pe.OPENAI_API_KEY){e.next=4;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 4:return e.next=6,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(pe.OPENAI_API_KEY)},body:JSON.stringify({model:"text-embedding-3-large",input:t})});case 6:if((n=e.sent).ok){e.next=13;break}return e.next=10,n.json().catch((function(){return null}));case 10:throw r=e.sent,console.error("OpenAI Embeddings API error response:",r),new Error("OpenAI Embeddings API error: ".concat(n.status," ").concat(n.statusText));case 13:return e.next=15,n.json();case 15:return o=e.sent,console.log("OpenAI Embeddings API response received"),e.abrupt("return",o.data[0].embedding);case 20:throw e.prev=20,e.t0=e.catch(0),console.error("Error creating embedding:",e.t0),e.t0;case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}function xe(e){return we.apply(this,arguments)}function we(){return(we=ue(ce().mark((function e(t){var n,r,o,a,c;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=["https://localhost:3002/prompts/".concat(t,".txt")].concat(de),r=null,o=se(n),e.prev=4,o.s();case 6:if((a=o.n()).done){e.next=23;break}return c=a.value,console.log("Attempting to load prompt from: ".concat(c)),e.prev=9,e.next=12,fetch(c);case 12:if(!(r=e.sent).ok){e.next=16;break}return console.log("Successfully loaded prompt from: ".concat(c)),e.abrupt("break",23);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),console.log("Path ".concat(c," failed: ").concat(e.t0.message));case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(4),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:if(r&&r.ok){e.next=33;break}throw new Error("Failed to load prompt: ".concat(t," (Could not find file in any location)"));case 33:return e.next=35,r.text();case 35:return e.abrupt("return",e.sent);case 38:throw e.prev=38,e.t2=e.catch(0),console.error("Error loading prompt ".concat(t,":"),e.t2),e.t2;case 42:case"end":return e.stop()}}),e,null,[[0,38],[4,25,28,31],[9,18]])})))).apply(this,arguments)}function Ee(e){return ke.apply(this,arguments)}function ke(){return(ke=ue(ce().mark((function e(t){var n;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,xe(t);case 3:if(n=e.sent){e.next=6;break}throw new Error('Prompt key "'.concat(t,'" not found'));case 6:return e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error getting prompt for key ".concat(t,":"),e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Pe(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=ue(ce().mark((function e(t){var n,r,o,a,c,s,i,l,u;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userInput,r=t.systemPrompt,o=t.model,a=t.temperature,c=t.history,s=void 0===c?[]:c,console.log("API Key being used for processPrompt:",pe.OPENAI_API_KEY?"".concat(pe.OPENAI_API_KEY.substring(0,3),"..."):"None"),i=[{role:"system",content:r}],s.length>0&&s.forEach((function(e){Array.isArray(e)&&2===e.length?i.push({role:"human"===e[0]?"user":"assistant",content:e[1]}):console.warn("Skipping malformed history message:",e)})),i.push({role:"user",content:n}),e.prev=5,e.next=8,me(i,o,a);case 8:if(l=e.sent,e.prev=9,u=JSON.parse(l),!Array.isArray(u)){e.next=13;break}return e.abrupt("return",u);case 13:return console.warn("Parsed JSON response, but it was not an array:",u),e.abrupt("return",l.split("\n").filter((function(e){return e.trim()})));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return",l.split("\n").filter((function(e){return e.trim()})));case 20:e.next=26;break;case 22:throw e.prev=22,e.t1=e.catch(5),console.error("Error in processPrompt:",e.t1),e.t1;case 26:case"end":return e.stop()}}),e,null,[[5,22],[9,17]])})))).apply(this,arguments)}function Ae(e){return Se.apply(this,arguments)}function Se(){return(Se=ue(ce().mark((function e(t){var n,r,o,a,c,s,i;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Processing structured database queries:",t),e.prev=1,console.log("Getting structure system prompt"),e.next=5,Ee("Structure_System");case 5:if(n=e.sent){e.next=8;break}throw new Error("Failed to load structure system prompt");case 8:return console.log("Got system prompt, processing query strings"),e.next=11,Pe({userInput:t,systemPrompt:n,model:ge,temperature:1,history:[]});case 11:if((r=e.sent)&&Array.isArray(r)){e.next=15;break}throw console.error("Invalid query strings received:",r),new Error("Failed to get valid query strings from structuring prompt");case 15:console.log("Got query strings:",r),o=[],a=se(r),e.prev=18,a.s();case 20:if((c=a.n()).done){e.next=47;break}return s=c.value,console.log("Processing query:",s),e.prev=23,e.t0=s,e.next=27,Ce({queryPrompt:s,similarityThreshold:.2,indexName:"call2trainingdata",numResults:3});case 27:return e.t1=e.sent,e.next=30,Ce({queryPrompt:s,similarityThreshold:.2,indexName:"call2context",numResults:5});case 30:return e.t2=e.sent,e.next=33,Ce({queryPrompt:s,similarityThreshold:.2,indexName:"call1context",numResults:5});case 33:return e.t3=e.sent,e.next=36,Ce({queryPrompt:s,indexName:"codes",numResults:3,similarityThreshold:.1});case 36:e.t4=e.sent,i={query:e.t0,trainingData:e.t1,call2Context:e.t2,call1Context:e.t3,codeOptions:e.t4},o.push(i),console.log("Successfully processed query:",s),e.next=45;break;case 42:e.prev=42,e.t5=e.catch(23),console.error('Error processing query "'.concat(s,'":'),e.t5);case 45:e.next=20;break;case 47:e.next=52;break;case 49:e.prev=49,e.t6=e.catch(18),a.e(e.t6);case 52:return e.prev=52,a.f(),e.finish(52);case 55:if(!(0===o.length&&r.length>0)){e.next=60;break}throw console.warn("All structured queries failed to produce results."),new Error("No valid results were obtained from any structured queries");case 60:if(0!==r.length){e.next=63;break}throw console.warn("Structuring prompt returned no query strings."),new Error("Structuring prompt did not return any queries to process.");case 63:return e.abrupt("return",o);case 66:throw e.prev=66,e.t7=e.catch(1),console.error("Error in structureDatabasequeries:",e.t7),e.t7;case 70:case"end":return e.stop()}}),e,null,[[1,66],[18,49,52,55],[23,42]])})))).apply(this,arguments)}function Ce(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=ue(ce().mark((function e(t){var n,r,o,a,c,s,i,l,u,f,p,d,h,g,m;return ce().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.queryPrompt,r=t.indexName,o=void 0===r?"codes":r,a=t.numResults,c=void 0===a?10:a,s=t.similarityThreshold,i=void 0===s?null:s,e.prev=1,console.log("Generating embeddings for query:",n),pe.PINECONE_API_KEY){e.next=5;break}throw new Error("Pinecone API key not found. Please check your API keys.");case 5:return e.next=7,ve(n);case 7:if(l=e.sent,console.log("Embeddings generated successfully"),u=he[o]){e.next=12;break}throw new Error("Invalid index name provided: ".concat(o));case 12:return f="".concat(u.apiEndpoint,"/query"),console.log("Making Pinecone API request to:",f),e.next=16,fetch(f,{method:"POST",headers:{"api-key":pe.PINECONE_API_KEY,"Content-Type":"application/json"},body:JSON.stringify({vector:l,topK:c,includeMetadata:!0,namespace:"ns1"})});case 16:if((p=e.sent).ok){e.next=23;break}return e.next=20,p.text().catch((function(){return"Could not read error response body"}));case 20:throw d=e.sent,console.error("Pinecone API error details:",{status:p.status,statusText:p.statusText,error:d}),new Error("Pinecone API error: ".concat(p.status," ").concat(p.statusText," - ").concat(d));case 23:return e.next=25,p.json();case 25:return h=e.sent,console.log("Pinecone API response received"),g=h.matches||[],null!==i&&(g=g.filter((function(e){return e.score>=i}))),g=g.slice(0,c),m=g.map((function(e){return Re(e)})).filter((function(e){return""!==e})),console.log("Found ".concat(m.length," matches (after threshold/limit/extraction):")),m.forEach((function(e,t){return console.log("  ".concat(t+1,": ").concat(e.substring(0,100),"..."))})),e.abrupt("return",m);case 35:throw e.prev=35,e.t0=e.catch(1),console.error('Error during vector database query for index "'.concat(o,'":'),e.t0),e.t0;case 39:case"end":return e.stop()}}),e,null,[[1,35]])})))).apply(this,arguments)}function Re(e){try{var t,n="string"==typeof e?JSON.parse(e):e;if(null!=n&&null!==(t=n.metadata)&&void 0!==t&&t.text)return n.metadata.text;if("string"==typeof(null==n?void 0:n.text))return n.text;if(Array.isArray(n)){var r,o=se(n);try{for(o.s();!(r=o.n()).done;){var a,c=r.value;if(null!=c&&null!==(a=c.metadata)&&void 0!==a&&a.text)return c.metadata.text}}catch(e){o.e(e)}finally{o.f()}}return console.warn("Could not find 'text' field in metadata for match:",JSON.stringify(e).substring(0,100)),""}catch(t){return console.error("Error processing JSON for text extraction: ".concat(t.message)),console.error("Input causing error:",e),""}}var _e=n(75180);function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Te(){Te=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof y?t:y,c=Object.create(a.prototype),s=new R(r||[]);return o(c,"_invoke",{value:A(e,n,s)}),c}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};l(x,c,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(_([])));E&&E!==n&&r.call(E,c)&&(x=E);var k=b.prototype=y.prototype=Object.create(x);function P(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(o,a,c,s){var i=f(e[o],e,a);if("throw"!==i.type){var l=i.arg,u=l.value;return u&&"object"==Ne(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,c,s)}),(function(e){n("throw",e,c,s)})):t.resolve(u).then((function(e){l.value=e,c(l)}),(function(e){return n("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,n,r){var o=p;return function(a,c){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===a)throw c;return{value:e,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=S(s,r);if(i){if(i===m)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var l=f(t,n,r);if("normal"===l.type){if(o=r.done?g:d,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=g,r.method="throw",r.arg=l.arg)}}}function S(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var a=f(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var c=a.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function _(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(Ne(t)+" is not iterable")}return v.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},P(I.prototype),l(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var c=new I(u(e,n,r,o),a);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},P(k),l(k,i,"Generator"),l(k,c,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=_,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=r.call(c,"catchLoc"),l=r.call(c,"finallyLoc");if(i&&l){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:_(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e,t,n){return(t=function(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,s=[],i=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return s}}(e,t)||Me(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Me(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function Me(e,t){if(e){if("string"==typeof e)return Ke(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ke(e,t):void 0}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function qe(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function Ye(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function c(e){qe(a,r,o,c,s,"next",e)}function s(e){qe(a,r,o,c,s,"throw",e)}c(void 0)}))}}var Ue=(performance.now(),""),$e=[],Je={OPENAI_API_KEY:"",PINECONE_API_KEY:""},Ge=["https://localhost:3002/src/prompts/Encoder_System.txt","https://localhost:3002/src/prompts/Encoder_Main.txt","https://localhost:3002/src/prompts/Followup_System.txt","https://localhost:3002/src/prompts/Structure_System.txt","https://localhost:3002/src/prompts/Validation_System.txt","https://localhost:3002/src/prompts/Validation_Main.txt"];function ze(){return We.apply(this,arguments)}function We(){return(We=Ye(Te().mark((function e(){var t,n,r;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Loading code database..."),e.next=4,fetch("https://localhost:3002/assets/codestringDB.txt");case 4:if((t=e.sent).ok){e.next=7;break}throw new Error("Failed to load codestringDB.txt: ".concat(t.statusText));case 7:return e.next=9,t.text();case 9:n=e.sent,r=n.split(/[\r\n]+/).filter((function(e){return""!==e.trim()})),$e=r.map((function(e){var t=e.split("\t");return t.length>=2?{name:t[0].trim(),code:t[1].trim()}:(console.warn("Skipping malformed line in codestringDB.txt: ".concat(e)),null)})).filter((function(e){return null!==e})),console.log("Code database loaded successfully with ".concat($e.length," entries.")),$e.length>0&&console.log("First few code database entries:",$e.slice(0,5)),e.next=21;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Error loading code database:",e.t0),At("Failed to load code database. Search functionality will be unavailable."),$e=[];case 21:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function Ve(){return He.apply(this,arguments)}function He(){return(He=Ye(Te().mark((function e(){var t,n,r,o,a;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Initializing API keys from AIcalls.js..."),null!==_e.API_KEYS&&void 0!==_e.API_KEYS&&_e.API_KEYS.OPENAI_API_KEY?(Je.OPENAI_API_KEY=_e.API_KEYS.OPENAI_API_KEY,console.log("OpenAI API key loaded from config.js")):console.warn("OpenAI API key not found in config.js."),null!==_e.API_KEYS&&void 0!==_e.API_KEYS&&_e.API_KEYS.PINECONE_API_KEY?(Je.PINECONE_API_KEY=_e.API_KEYS.PINECONE_API_KEY,console.log("Pinecone API key loaded from config.js")):console.warn("Pinecone API key not found in config.js."),Je.OPENAI_API_KEY&&Je.PINECONE_API_KEY){e.next=26;break}return console.log("Attempting fallback API key loading from https://localhost:3002/config.js"),e.prev=6,e.next=9,fetch("https://localhost:3002/config.js");case 9:if(!(t=e.sent).ok){e.next=20;break}return e.next=13,t.text();case 13:n=e.sent,r=n.match(/OPENAI_API_KEY\s*=\s*["']([^"']+)["']/),o=n.match(/PINECONE_API_KEY\s*=\s*["']([^"']+)["']/),!Je.OPENAI_API_KEY&&r&&r[1]&&(Je.OPENAI_API_KEY=r[1],console.log("OpenAI API key loaded via fetch fallback.")),!Je.PINECONE_API_KEY&&o&&o[1]&&(Je.PINECONE_API_KEY=o[1],console.log("Pinecone API key loaded via fetch fallback.")),e.next=21;break;case 20:console.warn("Fallback fetch for config.js failed or returned non-OK status.");case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(6),console.warn("Could not load config.js via fetch fallback:",e.t0);case 26:return console.log("Loaded API Keys (AIcalls.js):"),console.log("  OPENAI_API_KEY:",Je.OPENAI_API_KEY?"".concat(Je.OPENAI_API_KEY.substring(0,3),"...").concat(Je.OPENAI_API_KEY.substring(Je.OPENAI_API_KEY.length-3)):"Not found"),console.log("  PINECONE_API_KEY:",Je.PINECONE_API_KEY?"".concat(Je.PINECONE_API_KEY.substring(0,3),"...").concat(Je.PINECONE_API_KEY.substring(Je.PINECONE_API_KEY.length-3)):"Not found"),a=!(!Je.OPENAI_API_KEY||!Je.PINECONE_API_KEY),console.log("API Keys Initialized:",a),e.abrupt("return",Le({},Je));case 34:return e.prev=34,e.t1=e.catch(0),console.error("Error initializing API keys:",e.t1),e.abrupt("return",{OPENAI_API_KEY:"",PINECONE_API_KEY:""});case 38:case"end":return e.stop()}}),e,null,[[0,34],[6,23]])})))).apply(this,arguments)}var Xe={codes:{name:"codes",apiEndpoint:"https://codes-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2trainingdata:{name:"call2trainingdata",apiEndpoint:"https://call2trainingdata-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2context:{name:"call2context",apiEndpoint:"https://call2context-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call1context:{name:"call1context",apiEndpoint:"https://call1context-zmg9zog.svc.aped-4627-b74a.pinecone.io"}},Ze="gpt-4.1",Qe=[];function et(e){try{localStorage.setItem("conversationHistory",JSON.stringify(e)),console.log("Conversation history saved to localStorage")}catch(e){console.error("Error saving conversation history:",e)}}function tt(e){return nt.apply(this,arguments)}function nt(){return nt=Ye(Te().mark((function e(t){var n,r,o,a,c,s=arguments;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:Ze,r=s.length>2&&void 0!==s[2]?s[2]:.7,e.prev=2,console.log("Calling OpenAI API with model: ".concat(n)),Je.OPENAI_API_KEY){e.next=6;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 6:return e.next=8,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Je.OPENAI_API_KEY)},body:JSON.stringify({model:n,messages:t,temperature:r})});case 8:if((o=e.sent).ok){e.next=15;break}return e.next=12,o.json().catch((function(){return null}));case 12:throw a=e.sent,console.error("OpenAI API error response:",a),new Error("OpenAI API error: ".concat(o.status," ").concat(o.statusText));case 15:return e.next=17,o.json();case 17:return c=e.sent,console.log("OpenAI API response received"),e.abrupt("return",c.choices[0].message.content);case 22:throw e.prev=22,e.t0=e.catch(2),console.error("Error calling OpenAI API:",e.t0),e.t0;case 26:case"end":return e.stop()}}),e,null,[[2,22]])}))),nt.apply(this,arguments)}function rt(e){return ot.apply(this,arguments)}function ot(){return(ot=Ye(Te().mark((function e(t){var n,r,o;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Creating embedding for text"),Je.OPENAI_API_KEY){e.next=4;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 4:return e.next=6,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Je.OPENAI_API_KEY)},body:JSON.stringify({model:"text-embedding-3-large",input:t})});case 6:if((n=e.sent).ok){e.next=13;break}return e.next=10,n.json().catch((function(){return null}));case 10:throw r=e.sent,console.error("OpenAI Embeddings API error response:",r),new Error("OpenAI Embeddings API error: ".concat(n.status," ").concat(n.statusText));case 13:return e.next=15,n.json();case 15:return o=e.sent,console.log("OpenAI Embeddings API response received"),e.abrupt("return",o.data[0].embedding);case 20:throw e.prev=20,e.t0=e.catch(0),console.error("Error creating embedding:",e.t0),e.t0;case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}function at(e){return ct.apply(this,arguments)}function ct(){return(ct=Ye(Te().mark((function e(t){var n,r,o,a,c;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=["https://localhost:3002/prompts/".concat(t,".txt")].concat(Ge),r=null,o=De(n),e.prev=4,o.s();case 6:if((a=o.n()).done){e.next=23;break}return c=a.value,console.log("Attempting to load prompt from: ".concat(c)),e.prev=9,e.next=12,fetch(c);case 12:if(!(r=e.sent).ok){e.next=16;break}return console.log("Successfully loaded prompt from: ".concat(c)),e.abrupt("break",23);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(9),console.log("Path ".concat(c," failed: ").concat(e.t0.message));case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(4),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:if(r&&r.ok){e.next=33;break}throw new Error("Failed to load prompt: ".concat(t," (Could not find file in any location)"));case 33:return e.next=35,r.text();case 35:return e.abrupt("return",e.sent);case 38:throw e.prev=38,e.t2=e.catch(0),console.error("Error loading prompt ".concat(t,":"),e.t2),e.t2;case 42:case"end":return e.stop()}}),e,null,[[0,38],[4,25,28,31],[9,18]])})))).apply(this,arguments)}function st(e){return it.apply(this,arguments)}function it(){return(it=Ye(Te().mark((function e(t){var n;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,at(t);case 3:if(n=e.sent){e.next=6;break}throw new Error('Prompt key "'.concat(t,'" not found'));case 6:return e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error getting prompt for key ".concat(t,":"),e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function lt(e){return ut.apply(this,arguments)}function ut(){return(ut=Ye(Te().mark((function e(t){var n,r,o,a,c,s,i,l,u;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userInput,r=t.systemPrompt,o=t.model,a=t.temperature,c=t.history,s=void 0===c?[]:c,console.log("API Key being used for processPrompt:",Je.OPENAI_API_KEY?"".concat(Je.OPENAI_API_KEY.substring(0,3),"..."):"None"),i=[{role:"system",content:r}],s.length>0&&s.forEach((function(e){Array.isArray(e)&&2===e.length?i.push({role:"human"===e[0]?"user":"assistant",content:e[1]}):console.warn("Skipping malformed history message:",e)})),i.push({role:"user",content:n}),e.prev=5,e.next=8,tt(i,o,a);case 8:if(l=e.sent,e.prev=9,u=JSON.parse(l),!Array.isArray(u)){e.next=13;break}return e.abrupt("return",u);case 13:return console.warn("Parsed JSON response, but it was not an array:",u),e.abrupt("return",l.split("\n").filter((function(e){return e.trim()})));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return",l.split("\n").filter((function(e){return e.trim()})));case 20:e.next=26;break;case 22:throw e.prev=22,e.t1=e.catch(5),console.error("Error in processPrompt:",e.t1),e.t1;case 26:case"end":return e.stop()}}),e,null,[[5,22],[9,17]])})))).apply(this,arguments)}function ft(e){return pt.apply(this,arguments)}function pt(){return(pt=Ye(Te().mark((function e(t){var n,r,o,a,c,s,i,l,u,f,p,d,h,g,m;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.queryPrompt,r=t.indexName,o=void 0===r?"codes":r,a=t.numResults,c=void 0===a?10:a,s=t.similarityThreshold,i=void 0===s?null:s,e.prev=1,console.log("Generating embeddings for query:",n),Je.PINECONE_API_KEY){e.next=5;break}throw new Error("Pinecone API key not found. Please check your API keys.");case 5:return e.next=7,rt(n);case 7:if(l=e.sent,console.log("Embeddings generated successfully"),u=Xe[o]){e.next=12;break}throw new Error("Invalid index name provided: ".concat(o));case 12:return f="".concat(u.apiEndpoint,"/query"),console.log("Making Pinecone API request to:",f),e.next=16,fetch(f,{method:"POST",headers:{"api-key":Je.PINECONE_API_KEY,"Content-Type":"application/json"},body:JSON.stringify({vector:l,topK:c,includeMetadata:!0,namespace:"ns1"})});case 16:if((p=e.sent).ok){e.next=23;break}return e.next=20,p.text().catch((function(){return"Could not read error response body"}));case 20:throw d=e.sent,console.error("Pinecone API error details:",{status:p.status,statusText:p.statusText,error:d}),new Error("Pinecone API error: ".concat(p.status," ").concat(p.statusText," - ").concat(d));case 23:return e.next=25,p.json();case 25:return h=e.sent,console.log("Pinecone API response received"),g=h.matches||[],null!==i&&(g=g.filter((function(e){return e.score>=i}))),g=g.slice(0,c),m=g.map((function(e){return dt(e)})).filter((function(e){return""!==e})),console.log("Found ".concat(m.length," matches (after threshold/limit/extraction):")),m.forEach((function(e,t){return console.log("  ".concat(t+1,": ").concat(e.substring(0,100),"..."))})),e.abrupt("return",m);case 35:throw e.prev=35,e.t0=e.catch(1),console.error('Error during vector database query for index "'.concat(o,'":'),e.t0),e.t0;case 39:case"end":return e.stop()}}),e,null,[[1,35]])})))).apply(this,arguments)}function dt(e){try{var t,n="string"==typeof e?JSON.parse(e):e;if(null!=n&&null!==(t=n.metadata)&&void 0!==t&&t.text)return n.metadata.text;if("string"==typeof(null==n?void 0:n.text))return n.text;if(Array.isArray(n)){var r,o=De(n);try{for(o.s();!(r=o.n()).done;){var a,c=r.value;if(null!=c&&null!==(a=c.metadata)&&void 0!==a&&a.text)return c.metadata.text}}catch(e){o.e(e)}finally{o.f()}}return console.warn("Could not find 'text' field in metadata for match:",JSON.stringify(e).substring(0,100)),""}catch(t){return console.error("Error processing JSON for text extraction: ".concat(t.message)),console.error("Input causing error:",e),""}}function ht(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{return t?Array.isArray(e)?e.map((function(e){var t,n="";return n=null!=e&&null!==(t=e.metadata)&&void 0!==t&&t.text?e.metadata.text.replace(/[\r\n]+/g," ").trim():JSON.stringify(e),null!=e&&e.score&&(n+="\nSimilarity Score: ".concat(e.score.toFixed(4))),n})).join("\n\n"):JSON.stringify(e,null,2):JSON.stringify(e)}catch(e){return console.error("Error in safeJsonForPrompt:",e),"[Error formatting JSON: ".concat(e.message,"]")}}function gt(e,t){return mt.apply(this,arguments)}function mt(){return(mt=Ye(Te().mark((function e(t,n){var r,o,a,c,s,i,l,u,f;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Processing follow-up question:",t),console.log("Using conversation history length:",n.length),Je.OPENAI_API_KEY&&Je.PINECONE_API_KEY){e.next=4;break}throw new Error("API keys not initialized for follow-up conversation.");case 4:return e.next=6,st("Followup_System");case 6:return r=e.sent,e.next=9,st("Encoder_Main");case 9:if(o=e.sent,r&&o){e.next=12;break}throw new Error("Failed to load required prompts for follow-up.");case 12:return e.next=14,ft({queryPrompt:t,similarityThreshold:.4,indexName:"call2trainingdata",numResults:3});case 14:return a=e.sent,e.next=17,ft({queryPrompt:t+ht(a,!1),similarityThreshold:.3,indexName:"call2context",numResults:5});case 17:return c=e.sent,e.next=20,ft({queryPrompt:t+ht(a,!1),similarityThreshold:.3,indexName:"call1context",numResults:5});case 20:return s=e.sent,e.next=23,ft({queryPrompt:t+ht(a,!1)+ht(s,!1),indexName:"codes",numResults:10,similarityThreshold:.1});case 23:return i=e.sent,l="Client request: ".concat(t,"\n")+"Main Prompt Context: ".concat(o,"\n")+"Training Data Context: ".concat(ht(a,!0),"\n")+"Code Choosing Context: ".concat(ht(s,!0),"\n")+"Code Editing Context: ".concat(ht(c,!0),"\n")+"Relevant Code Options: ".concat(ht(i,!0)),e.next=27,lt({userInput:l,systemPrompt:r,model:Ze,temperature:1,history:n});case 27:return u=e.sent,et(f=[].concat(function(e){if(Array.isArray(e))return Ke(e)}(p=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(p)||Me(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[["human",t],["assistant",u.join("\n")]])),wt(t,r,o,null,null,null,ht(c,!1),ht(s,!1),ht(a,!1),ht(i,!1),u),Et(t,u),console.log("Follow-up conversation processed. History length:",f.length),e.abrupt("return",{response:u,history:f});case 34:case"end":return e.stop()}var p}),e)})))).apply(this,arguments)}function yt(e){return vt.apply(this,arguments)}function vt(){return(vt=Ye(Te().mark((function e(t){var n,r,o,a,c;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Processing initial question:",t),Je.OPENAI_API_KEY){e.next=3;break}throw new Error("OpenAI API key not initialized for initial conversation.");case 3:return e.next=5,st("Encoder_System");case 5:return n=e.sent,e.next=8,st("Encoder_Main");case 8:if(r=e.sent,n&&r){e.next=11;break}throw new Error("Failed to load required prompts for initial conversation.");case 11:return console.log("SYSTEM PROMPT: ",n?n.substring(0,100)+"...":"Not loaded"),console.log("MAIN PROMPT: ",r?r.substring(0,100)+"...":"Not loaded"),o="Client request: ".concat(t,"\n")+"Main Prompt: ".concat(r),e.next=16,lt({userInput:o,systemPrompt:n,model:Ze,temperature:1,history:[]});case 16:return a=e.sent,et(c=[["human",t],["assistant",a.join("\n")]]),wt(t,n,r,null,null,null,"","","","",a),Et(t,a),console.log("Initial conversation processed. History length:",c.length),console.log("Initial Response:",a),e.abrupt("return",{response:a,history:c});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e,t){return xt.apply(this,arguments)}function xt(){return(xt=Ye(Te().mark((function e(t,n){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n&&n.length>0)){e.next=8;break}return e.next=5,gt(t,n);case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,yt(t);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error("Error in conversation handling:",e.t0),e.abrupt("return",{response:["Error processing your request: "+e.t0.message],history:n||[]});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function wt(e,t,n,r,o,a,c,s,i,l,u){try{var f={clientRequest:e||"",systemPrompt:t||"",mainPrompt:n||"",validationSystemPrompt:r||"",validationMainPrompt:o||"",validationResults:a||[],call2context:c||"",call1context:s||"",trainingdataCall2:i||"",codeOptions:l||"",outputArray:u||[]};localStorage.setItem("promptAnalysis",JSON.stringify(f)),console.log("Prompt analysis saved to localStorage")}catch(e){console.error("Error saving prompt analysis:",e)}}function Et(e,t){try{var n=function(e){return e?(Array.isArray(e)?JSON.stringify(e):String(e)).replace(/[\r\n\t]+/g," ").trim():""},r={prompt:n(e),response:n(t)};localStorage.setItem("trainingData",JSON.stringify(r)),console.log("Training data saved to localStorage")}catch(e){console.error("Error saving training data:",e)}}function kt(e,t,n){return Pt.apply(this,arguments)}function Pt(){return(Pt=Ye(Te().mark((function e(t,n,r){var o,a,c,s,i,l,u,f,p,d;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Je.OPENAI_API_KEY){e.next=3;break}throw new Error("OpenAI API key not initialized for validation correction.");case 3:return o=localStorage.getItem("trainingData")||'{"prompt":"","response":""}',a=JSON.parse(localStorage.getItem("promptAnalysis")||"{}"),e.next=7,st("Validation_System");case 7:return c=e.sent,e.next=10,st("Validation_Main");case 10:if(s=e.sent,c&&s){e.next=13;break}throw new Error("Failed to load validation system or main prompt");case 13:return i=Array.isArray(n)?n.join("\n"):String(n),l=Array.isArray(r)?r.join("\n"):String(r),u="Main Prompt: ".concat(s,"\n\n")+"Original User Input: ".concat(t,"\n\n")+"Initial Response (to be corrected): ".concat(i,"\n\n")+"Validation Errors Found: ".concat(l,"\n\n")+"Training Data Example: ".concat(o,"\n\n")+"Code Options Context: ".concat(a.codeOptions||"Not available","\n\n")+"Code Choosing Context: ".concat(a.call1context||"Not available","\n\n")+"Code Editing Context: ".concat(a.call2context||"Not available"),console.log("====== VALIDATION CORRECTION INPUT ======"),console.log("System Prompt:",c.substring(0,100)+"..."),console.log("User Input Prompt (truncated):",u.substring(0,500)+"..."),console.log("========================================="),e.next=19,lt({userInput:u,systemPrompt:c,model:Ze,temperature:.7,history:[]});case 19:return f=e.sent,p="C:\\Users\\joeor\\Dropbox\\B - Freelance\\C_Projectify\\VanPC\\Training Data\\Main Script Training and Context Data\\validation_correction_output.txt",d=Array.isArray(f)?f.join("\n"):f,h=p,g=d,console.log("Mock writeFileSync called with path: ".concat(h)),console.log("Content would be written to ".concat(h,":"),g.substring(0,100)+"..."),console.log("Validation correction output saved via mock fs to ".concat(p)),console.log("Corrected Response:",f),e.abrupt("return",f);case 28:return e.prev=28,e.t0=e.catch(0),console.error("Error in validation correction:",e.t0),e.abrupt("return",["Error during validation correction: "+e.t0.message]);case 32:case"end":return e.stop()}var h,g}),e,null,[[0,28]])})))).apply(this,arguments)}function It(e){var t=document.createElement("div");t.style.color="green",t.style.padding="10px",t.style.margin="10px",t.style.border="1px solid green",t.style.borderRadius="4px",t.textContent=e;var n=document.getElementById("app-body");n.insertBefore(t,n.firstChild),setTimeout((function(){t.remove()}),5e3)}function At(e){var t=document.createElement("div");t.style.color="red",t.style.padding="10px",t.style.margin="10px",t.style.border="1px solid red",t.style.borderRadius="4px",t.textContent="Error: ".concat(e);var n=document.getElementById("app-body");n.insertBefore(t,n.firstChild),setTimeout((function(){t.remove()}),5e3)}function St(e){var t=document.getElementById("send"),n=document.getElementById("loading-animation");t&&(t.disabled=e),n&&(n.style.display=e?"flex":"none")}var Ct=null,Ot=!1;function Rt(){return _t.apply(this,arguments)}function _t(){return _t=Ye(Te().mark((function e(){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ct){e.next=3;break}return At("No response to write to Excel"),e.abrupt("return");case 3:return e.prev=3,e.next=6,Excel.run(function(){var e=Ye(Te().mark((function e(t){var n,r,o,a,c;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.workbook.getSelectedRange()).load("rowIndex"),n.load("columnIndex"),e.next=5,t.sync();case 5:if(r=n.rowIndex,o=n.columnIndex,a=[],Array.isArray(Ct)?(c=Ct.join(" "),a=c.match(/<[^>]+>/g)||[]):"string"==typeof Ct&&(a=Ct.match(/<[^>]+>/g)||[]),0!==a.length){e.next=11;break}throw new Error("No valid code strings found in response");case 11:return n.worksheet.getRangeByIndexes(r,o,a.length,1).values=a.map((function(e){return[e]})),e.next=15,t.sync();case 15:console.log("Response written to Excel");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),console.error("Error writing to Excel:",e.t0),At(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[3,8]])}))),_t.apply(this,arguments)}function Nt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("chat-log"),r=document.getElementById("welcome-message");r&&(r.style.display="none");var o=document.createElement("div");o.className="chat-message ".concat(t?"user-message":"assistant-message");var a=document.createElement("p");a.className="message-content",a.textContent=e,o.appendChild(a),n.appendChild(o),n.scrollTop=n.scrollHeight}function Tt(){return jt.apply(this,arguments)}function jt(){return(jt=Ye(Te().mark((function e(){var t,n,r,o,a,c;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("user-input").value.trim()){e.next=4;break}return At("Please enter a request"),e.abrupt("return");case 4:return Ot=Qe.length>0,Nt(t,!0),document.getElementById("user-input").value="",St(!0),e.prev=8,console.log("Starting structureDatabasequeries"),e.next=12,Ae(t);case 12:if(n=e.sent,console.log("Database queries completed"),n&&Array.isArray(n)){e.next=17;break}throw console.error("Invalid database results:",n),new Error("Failed to get valid database results");case 17:return r=n.map((function(e){return e?"Query: ".concat(e.query||"No query","\n")+"Training Data:\n".concat((e.trainingData||[]).join("\n"),"\n")+"Code Options:\n".concat((e.codeOptions||[]).join("\n"),"\n")+"Code Choosing Context:\n".concat((e.call1Context||[]).join("\n"),"\n")+"Code Editing Context:\n".concat((e.call2Context||[]).join("\n"),"\n")+"---\n":"No results found"})).join("\n"),o="Client Request: ".concat(t,"\n\nDatabase Results:\n").concat(r),console.log("Enhanced prompt created"),console.log("Enhanced prompt:",o),console.log("Starting handleConversation"),e.next=24,bt(o,Ot);case 24:if(a=e.sent,console.log("Conversation completed"),console.log("Initial Response:",a),a&&Array.isArray(a)){e.next=30;break}throw console.error("Invalid response:",a),new Error("Failed to get valid response from conversation");case 30:return console.log("Starting validation"),e.next=33,l(a);case 33:if(c=e.sent,console.log("Validation completed:",c),!(c&&c.length>0)){e.next=41;break}return console.log("Starting validation correction"),e.next=39,kt(t,a,c);case 39:a=e.sent,console.log("Validation correction completed");case 41:Ct=a,Nt(a.join("\n")),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(8),console.error("Error in handleSend:",e.t0),At(e.t0.message),Nt("Error: ".concat(e.t0.message));case 50:return e.prev=50,St(!1),e.finish(50);case 53:case"end":return e.stop()}}),e,null,[[8,45,50,53]])})))).apply(this,arguments)}function Lt(){var e=document.getElementById("chat-log");e.innerHTML="";var t=document.createElement("div");t.id="welcome-message",t.className="welcome-message";var n=document.createElement("h1");n.textContent="What would you like to model?",t.appendChild(n),e.appendChild(t),et(Qe=[]),Ot=!1,Ct=null,document.getElementById("user-input").value="",console.log("Chat reset completed")}function Ft(e){if(!e)return[];for(var t,n=[],r=/(<TAB;[^>]*>)/g,o=[];null!==(t=r.exec(e));)o.push({index:t.index,tag:t[1]});if(0===o.length)return e.trim().length>0&&console.warn("Code string provided but no <TAB;...> tags found. Processing cannot proceed based on Tabs."),[];for(var a=0;a<o.length;a++){var c=o[a].index,s=o[a].tag,i=a+1<o.length?o[a+1].index:e.length,l=e.substring(c,i).trim();l&&n.push({tag:s,text:l})}return n}function Bt(){return Dt.apply(this,arguments)}function Dt(){return Dt=Ye(Te().mark((function e(){var t,n,r,o,a,c,s,i,l,u,p,d,h,g,m,y,v,b,x,w,E,k,P,S,C,O,R,_,N,T,j,L,F,B,M,K,q,Y,U,$,J,z,V,H,X;return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("codes-textarea")){e.next=4;break}return At("Could not find the code input area. Cannot run codes."),e.abrupt("return");case 4:Ue=t.value;try{localStorage.setItem("userCodeStrings",Ue),console.log("[Run Codes] Automatically saved codes from textarea to localStorage.")}catch(e){console.error("[Run Codes] Error auto-saving codes to localStorage:",e),At("Error automatically saving codes: ".concat(e.message,". Run may not reflect latest changes."))}return n=Ue,r=null,o="",a=null,e.prev=10,s=!1,e.next=14,Excel.run(function(){var e=Ye(Te().mark((function e(t){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.workbook.worksheets.getItem("Financials").load("name"),e.next=5,t.sync();case 5:s=!0,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(0),!(e.t0 instanceof OfficeExtension.Error&&e.t0.code===Excel.ErrorCodes.itemNotFound)){e.next=14;break}s=!1,e.next=15;break;case 14:throw e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}());case 14:return e.next=16,Excel.run(function(){var e=Ye(Te().mark((function e(t){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.application.calculationMode=Excel.CalculationMode.manual,e.next=3,t.sync();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 16:if(St(!0),console.log("Starting code processing..."),s){e.next=58;break}if(console.log("[Run Codes] FIRST PASS: Financials sheet not found."),!((o=n).trim().length>0)){e.next=36;break}return console.log("Validating ALL codes before initial base sheet insertion..."),e.next=25,f(o.split(/\r?\n/).filter((function(e){return""!==e.trim()})));case 25:if(!((i=e.sent)&&i.length>0)){e.next=33;break}return l="Initial validation failed. Please fix the errors before running:\n"+i.join("\n"),console.error("Code validation failed:",i),At("Code validation failed. See chat for details."),Nt(l),St(!1),e.abrupt("return");case 33:console.log("Initial code validation successful."),e.next=37;break;case 36:console.log("[Run Codes] No codes to validate on first pass.");case 37:return console.log("Inserting base sheets from Worksheets_4.3.25 v1.xlsx..."),e.next=40,fetch("https://localhost:3002/assets/Worksheets_4.3.25 v1.xlsx");case 40:if((u=e.sent).ok){e.next=43;break}throw new Error("Worksheets load failed: ".concat(u.statusText));case 43:return e.next=45,u.arrayBuffer();case 45:for(p=e.sent,console.log("Converting base file to base64 (using chunks)..."),d=new Uint8Array(p),h="",g=0;g<d.length;g+=8192)m=d.slice(g,Math.min(g+8192,d.length)),h+=String.fromCharCode.apply(null,m);return y=btoa(h),console.log("Base64 conversion complete."),e.next=55,W(y);case 55:console.log("Base sheets inserted."),e.next=125;break;case 58:console.log("[Run Codes] SUBSEQUENT PASS: Financials sheet found.");try{r=localStorage.getItem("previousRunCodeStrings")}catch(e){console.error("[Run Codes] Error loading previous codes for comparison:",e),console.warn("[Run Codes] Could not load previous codes. Processing ALL current codes as fallback."),r=null}if(null===r||r!==n){e.next=66;break}console.log("[Run Codes] No change in code strings since last run. Nothing to process.");try{localStorage.setItem("previousRunCodeStrings",n)}catch(e){console.error("Err updating prev codes:",e)}return It("No code changes to run."),St(!1),e.abrupt("return");case 66:v=Ft(n),b=Ft(r||""),x=new Map(b.map((function(e){return[e.tag,e.text]}))),w=!1,E=/<[^>]+>/g,k=De(v);try{for(k.s();!(P=k.n()).done;)if(S=P.value,C=S.tag,O=S.text,void 0===(R=x.get(C)))console.log("[Run Codes] Identified NEW tab: ".concat(C,". Adding all its codes.")),(_=O.match(E)||[]).length>0&&(o+=_.join("\n")+"\n\n",w=!0);else{N=O.match(E)||[],T=new Set((R||"").match(E)||[]),j=!1,L="",F=De(N);try{for(F.s();!(B=F.n()).done;)M=B.value,T.has(M)||(console.log("[Run Codes] Identified NEW/MODIFIED code in tab ".concat(C,": ").concat(M.substring(0,80),"...")),L+=M+"\n",w=!0,j=!0)}catch(e){F.e(e)}finally{F.f()}j&&(o+=C+"\n",o+=L+"\n")}}catch(e){k.e(e)}finally{k.f()}if(!w){e.next=120;break}if(!(o.trim().length>0)){e.next=89;break}return console.log("Validating ALL content from new/modified tabs BEFORE inserting codes.xlsx..."),e.next=78,f(o.split(/\r?\n/).filter((function(e){return""!==e.trim()})));case 78:if(!((K=e.sent)&&K.length>0)){e.next=86;break}return q="Validation failed. Please fix the errors before running:\n"+K.join("\n"),console.error("Code validation failed:",K),At("Code validation failed. See chat for details."),Nt(q),St(!1),e.abrupt("return");case 86:console.log("Code validation successful for new/modified tabs."),e.next=90;break;case 89:console.log("[Run Codes] Changes detected, but no code content found for validation in new/modified tabs.");case 90:return console.log("[Run Codes] Changes detected and validated: ".concat(v.filter((function(e){return!x.has(e.tag)||x.get(e.tag)!==e.text})).map((function(e){return e.tag})).join(", "),". Inserting base sheets from codes.xlsx...")),e.prev=91,e.next=94,fetch("https://localhost:3002/assets/codes.xlsx");case 94:if((Y=e.sent).ok){e.next=97;break}throw new Error("codes.xlsx load failed: ".concat(Y.statusText));case 97:return e.next=99,Y.arrayBuffer();case 99:for(U=e.sent,console.log("Converting codes.xlsx file to base64 (using chunks)..."),$=new Uint8Array(U),J="",z=0;z<$.length;z+=8192)V=$.slice(z,Math.min(z+8192,$.length)),J+=String.fromCharCode.apply(null,V);return H=btoa(J),console.log("codes.xlsx Base64 conversion complete."),e.next=109,W(H);case 109:console.log("codes.xlsx sheets inserted."),e.next=118;break;case 112:return e.prev=112,e.t0=e.catch(91),console.error("Failed to insert sheets from codes.xlsx:",e.t0),At("Failed to insert necessary sheets from codes.xlsx. Aborting."),St(!1),e.abrupt("return");case 118:e.next=125;break;case 120:console.log("[Run Codes] No changes identified in tabs compared to previous run. Nothing to insert or process.");try{localStorage.setItem("previousRunCodeStrings",n)}catch(e){console.error("Err updating prev codes:",e)}return It("No code changes identified to run."),St(!1),e.abrupt("return");case 125:if(!(o.trim().length>0)){e.next=142;break}if(console.log("[Run Codes] Processing collected content from new/modified tabs..."),console.log("Populating collection..."),X=I(o),console.log("Collection populated with ".concat(X.length," code(s)")),!(X.length>0)){e.next=138;break}return console.log("Running codes..."),e.next=134,A(X);case 134:a=e.sent,console.log("Codes executed:",a),e.next=140;break;case 138:console.log("[Run Codes] Collection is empty after population, skipping runCodes execution."),a||(a={assumptionTabs:[]});case 140:e.next=144;break;case 142:console.log("[Run Codes] No code content collected to process via runCodes."),a||(a={assumptionTabs:[]});case 144:if(console.log("[Run Codes] Starting post-processing steps..."),!(a&&a.assumptionTabs&&a.assumptionTabs.length>0)){e.next=151;break}return console.log("Processing assumption tabs..."),e.next=149,D(a.assumptionTabs);case 149:e.next=152;break;case 151:console.log("No assumption tabs to process.");case 152:return console.log("Hiding specific columns and navigating..."),e.next=155,G((null===(c=a)||void 0===c?void 0:c.assumptionTabs)||[]);case 155:return console.log("Deleting Codes sheet / Skipping hiding Calcs sheet..."),e.next=158,Excel.run(function(){var e=Ye(Te().mark((function e(t){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t.workbook.worksheets.getItem("Codes").delete(),console.log("Codes sheet deleted.")}catch(e){e instanceof OfficeExtension.Error&&e.code===Excel.ErrorCodes.itemNotFound?console.warn("Codes sheet not found, skipping deletion."):console.error("Error deleting Codes sheet:",e)}return e.next=3,t.sync();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error during sheet cleanup:",e)}));case 158:try{localStorage.setItem("previousRunCodeStrings",n),console.log("[Run Codes] Updated previous run state with full current codes.")}catch(e){console.error("[Run Codes] Failed to update previous run state:",e)}It("Code processing finished successfully!"),e.next=166;break;case 162:e.prev=162,e.t1=e.catch(10),console.error("An error occurred during the build process:",e.t1),At("Operation failed: ".concat(e.t1.message||e.t1.toString()));case 166:return e.prev=166,e.prev=167,e.next=170,Excel.run(function(){var e=Ye(Te().mark((function e(t){return Te().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.application.calculationMode=Excel.CalculationMode.automatic,e.next=3,t.sync();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 170:e.next=175;break;case 172:e.prev=172,e.t2=e.catch(167),console.error("Error setting calculation mode to automatic:",e.t2);case 175:return St(!1),e.finish(166);case 177:case"end":return e.stop()}}),e,null,[[10,162,166,177],[91,112],[167,172]])}))),Dt.apply(this,arguments)}Office.onReady((function(e){if(e.host===Office.HostType.Excel){var t=document.getElementById("insert-and-run");t?t.onclick=Bt:console.error("Could not find button with id='insert-and-run'");var n=document.getElementById("send");n&&(n.onclick=Tt);var r=document.getElementById("write-to-excel");r&&(r.onclick=Rt);var o=document.getElementById("reset-chat");o&&(o.onclick=Lt);var a=document.getElementById("generate-tab-string-button");a?a.onclick=oe:console.error("Could not find button with id='generate-tab-string-button'");var c=document.getElementById("codes-textarea"),s=document.getElementById("edit-code-params-button"),i=document.getElementById("code-params-modal"),l=document.getElementById("code-params-modal-form"),u=i.querySelector(".close-button"),f=document.getElementById("apply-code-params-button"),p=document.getElementById("cancel-code-params-button"),d=document.getElementById("modal-find-input"),h=document.getElementById("modal-replace-input"),g=document.getElementById("modal-replace-all-button"),m=document.getElementById("modal-search-status"),y=null,v="",b=[],x=function(){b=Array.from(l.querySelectorAll("input[data-param-key], textarea[data-param-key]")),m&&(m.textContent=""),console.log("Modal search state reset.")},w=function(e){m&&(m.textContent=e)},E=function(){i&&(i.style.display="none",l.innerHTML="",y=null,v="",x())};s&&c&&i&&(s.onclick=function(){var e=function(e,t){var n=e.substring(0,t),r=e.substring(t),o=n.lastIndexOf("<");if(o>n.lastIndexOf(">")){var a=r.indexOf(">");if(-1!==a){var c=o,s=t+a+1,i=e.substring(c,s);return console.log("Found code string: ".concat(i," at range [").concat(c,", ").concat(s,")")),{codeString:i,start:c,end:s}}}return console.log("Cursor not inside a <...> block."),null}(c.value,c.selectionStart);if(e){var t=function(e){var t=e.split(";");if(t.length<1)return{type:"",params:{}};for(var n=t[0].trim(),r={},o=/\s*([^=\s]+)\s*=\s*(?:"([^"]*)"|([^;]*))/g,a=1;a<t.length;a++){var c=t[a].trim();if(c){o.lastIndex=0;var s=o.exec(c);if(s){var i=s[1],l=void 0!==s[2]?s[2]:s[3];i&&(r[i]=l.trim())}else console.warn("Could not parse parameter part: '".concat(c,"'"))}}return console.log("Parsed type: ".concat(n,", params:"),r),{type:n,params:r}}(e.codeString.substring(1,e.codeString.length-1)),n=t.type,r=t.params;n?(y={start:e.start,end:e.end},function(e,t){l.innerHTML="",v=e,Object.entries(t).forEach((function(e){var t=Be(e,2),n=t[0],r=t[1],o=document.createElement("div");o.className="param-entry";var a,c=document.createElement("label");c.htmlFor="param-".concat(n),c.textContent=n;var s=n.toLowerCase().includes("row")||r.length>60,i=/LI\d+\|/.test(r.trim());if(s||i?(a=document.createElement("textarea")).rows=i?2:3:(a=document.createElement("input")).type="text",a.id="param-".concat(n),a.value=r,a.dataset.paramKey=n,i&&(a.dataset.isOriginalLi="true"),o.appendChild(c),i){var u=document.createElement("div");u.className="li-parameter-container",u.dataset.originalLiKey=n,u.appendChild(a);var f=document.createElement("button");f.type="button",f.textContent="+",f.className="ms-Button ms-Button--icon add-li-button",f.title="Add another LI item based on this one",f.dataset.targetLiKey=n,f.onclick=function(e){var t=document.getElementById("param-".concat(n));if(t){var r=document.createElement("div");r.className="added-li-item";var o=t.cloneNode(!0);o.id="",o.dataset.isAddedLi="true",delete o.dataset.isOriginalLi,o.dataset.originalLiKey=n,o.value=t.value;var a=document.createElement("button");a.type="button",a.textContent="-",a.className="ms-Button ms-Button--icon remove-li-button",a.title="Remove this added LI item",a.onclick=function(){r.remove()},r.appendChild(o),r.appendChild(a),e.target.parentNode.appendChild(r)}},u.appendChild(f),o.appendChild(u)}else o.appendChild(a);l.appendChild(o)})),x()}(n,r),i&&(i.style.display="block",x())):At("Could not parse the code string structure.")}else At("Place cursor inside a <...> code block to edit parameters.")}),u&&(u.onclick=E),p&&(p.onclick=E),f&&c&&(f.onclick=function(){if(y&&v){var e={};l.querySelectorAll("input[data-param-key], textarea[data-param-key]").forEach((function(t){var n=t.dataset.paramKey,r="true"===t.dataset.isOriginalLi,o="true"===t.dataset.isAddedLi,a=t.value;r?e[n]||(e[n]=a):o||n&&!o&&(e[n]||(e[n]=a))})),l.querySelectorAll('textarea[data-is-added-li="true"]').forEach((function(t){var n=t.dataset.originalLiKey;n&&e[n]&&(e[n]+=" *".concat(t.value))}));var t=Object.entries(e).map((function(e){var t=Be(e,2),n=t[0],r=t[1];return"".concat(n,'="').concat(r,'"')})),n="".concat(v,"; ").concat(t.join("; ")),r="<".concat(n,">"),o=c.value,a=o.substring(0,y.start),s=o.substring(y.end);c.value=a+r+s,console.log("Updated code string at [".concat(y.start,", ").concat(y.start+r.length,")")),console.log("New string:",r);var i=y.start+r.length;c.focus(),c.setSelectionRange(i,i),E()}}),g&&(g.onclick=function(){var e=d.value,t=h.value;if(e){b=Array.from(l.querySelectorAll("input[data-param-key], textarea[data-param-key]"));var n=0;b.forEach((function(r,o){var a=r.value,c=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=a.replace(new RegExp(c,"g"),(function(){return n++,t}));a!==s&&(r.value=s,console.log("Modal Replace All: Made replacements in element ".concat(o)))})),w(n>0?"Replaced ".concat(n," occurrence(s)."):'"'.concat(e,'" not found.'))}else w("Enter search term.")}),u&&(u.onclick=E),Promise.all([Ve(),ze()]).then((function(e){var t=Be(e,1)[0];t?function(e){e&&"object"===fe(e)&&(e.OPENAI_API_KEY&&(pe.OPENAI_API_KEY=e.OPENAI_API_KEY,console.log("AIcalls.js: OpenAI API key set externally")),e.PINECONE_API_KEY&&(pe.PINECONE_API_KEY=e.PINECONE_API_KEY,console.log("AIcalls.js: Pinecone API key set externally")))}(t):At("Failed to load API keys. Please check configuration."),Qe=function(){try{var e=localStorage.getItem("conversationHistory");if(e){console.log("Loaded conversation history from localStorage");var t=JSON.parse(e);return Array.isArray(t)?t:(console.error("Invalid history format, expected array"),[])}return console.log("No conversation history found in localStorage"),[]}catch(e){return console.error("Error loading conversation history:",e),[]}}();try{var n=localStorage.getItem("userCodeStrings");null!==n?(Ue=n,c&&(c.value=Ue),console.log("Code strings loaded from localStorage into global variable.")):(console.log("No code strings found in localStorage, initializing global variable as empty."),Ue=""),localStorage.getItem("previousRunCodeStrings")&&console.log("Previous run code strings loaded from localStorage.")}catch(e){console.error("Error loading code strings from localStorage:",e),At("Error loading codes from storage: ".concat(e.message)),Ue=""}})).catch((function(e){console.error("Error during initialization:",e),At("Error during initialization: "+e.message)})),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="block";var k=document.getElementById("dynamic-suggestions-container");if(!k){(k=document.createElement("div")).id="dynamic-suggestions-container",k.className="code-suggestions",k.style.display="none",k.style.position="absolute",k.style.border="1px solid #ccc",k.style.backgroundColor="white",k.style.maxHeight="150px",k.style.overflowY="auto",k.style.zIndex="1000",c&&c.parentNode?c.parentNode.insertBefore(k,c.nextSibling):document.body.appendChild(k);var P=function(){if("block"===k.style.display&&c){var e=c.getBoundingClientRect();k.style.width=c.offsetWidth+"px",k.style.top=e.bottom+window.scrollY+"px",k.style.left=e.left+window.scrollX+"px"}};window.addEventListener("resize",P),window.addEventListener("scroll",P,!0)}var I=-1,A=[],S=function(e){if(k){var t=k.querySelectorAll(".code-suggestion-item");I>=0&&I<t.length&&t[I].classList.remove("suggestion-highlight"),e>=0&&e<t.length&&(t[e].classList.add("suggestion-highlight"),t[e].scrollIntoView({block:"nearest"})),I=e}};c&&k&&(c.oninput=function(e){if(e.isTrusted&&k){var t=c.selectionStart,n=c.value,r=n.substring(0,t),o=!1;if(r.lastIndexOf("<")>r.lastIndexOf(">")&&-1!==n.substring(t).indexOf(">")&&(o=!0),o)console.log("[Textarea Input] Cursor inside <>, hiding suggestions."),k.style.display="none",I=-1,A=[];else{for(var a=t-1;a>=0;){var s=r[a];if(/\s|\n|>|<|;|\|/.test(s)){a++;break}a--}a<0&&(a=0),console.log("[Textarea Input Debug] cursorPosition: ".concat(t,", calculated searchStart: ").concat(a,", char at searchStart: '").concat(a<n.length?r[a]:"EOF","'"));var i=r.substring(a,t),l=i.trim();0!==l.length&&/^[a-zA-Z]/.test(l)?(console.log("[Textarea Input] Cursor outside <>, potential search term: '".concat(i,"'")),function(e){if(k&&c){if(e=e.toLowerCase().trim(),console.log("[showSuggestionsForTerm] Search Term: '".concat(e,"'")),k.innerHTML="",I=-1,A=[],e.length<2)return console.log("[showSuggestionsForTerm] Search term too short, hiding suggestions."),void(k.style.display="none");console.log("[showSuggestionsForTerm] Filtering code database...");var t=$e.filter((function(t){return t&&"string"==typeof t.name&&t.name.toLowerCase().includes(e)})).slice(0,10);if(A=t,console.log("[showSuggestionsForTerm] Found ".concat(A.length," suggestions:"),A),A.length>0){console.log("[showSuggestionsForTerm] Populating suggestions container..."),A.forEach((function(e,t){var n=document.createElement("div");n.className="code-suggestion-item",n.textContent=e.name,n.dataset.index=t,n.onclick=function(){console.log("Suggestion clicked: '".concat(e.name,"'"));var t=c.value,n=c.selectionStart,r=e.code,o=n,a=!1,s=t.substring(0,n);if(s.lastIndexOf("<")>s.lastIndexOf(">")){var i=t.substring(n).indexOf(">");-1!==i&&(o=n+i+1,a=!0,console.log("Cursor inside <>, adjusting insertion point to after > at ".concat(o)))}var l=Le({},function(e){var t,n={},r=/row\d+\s*=\s*"([A-Z]+)(\d*)\|/g;for(console.log("Scanning text for drivers:",e.substring(0,200)+"...");null!==(t=r.exec(e));){var o=t[1],a=t[2],c=a?parseInt(a,10):0;console.log("Found driver match: prefix='".concat(o,"', numberStr='").concat(a,"', number=").concat(c)),isNaN(c)?console.warn("Parsed NaN for number from '".concat(a,"' for prefix '").concat(o,"'. Skipping.")):(!n[o]||c>n[o])&&(n[o]=c,console.log("Updated max for '".concat(o,"' to ").concat(c)))}return 0===Object.keys(n).length&&console.log("No existing drivers found matching the pattern."),console.log("Final max existing driver numbers:",n),n}(t));r=r.replace(/(row\d+\s*=\s*")([A-Z]+)(\d*)(\|)/g,(function(e,t,n,r,o){l[n]=(l[n]||0)+1;var a=l[n],c="".concat(t).concat(n).concat(a).concat(o);return console.log("Replacing driver: '".concat(n).concat(r||"","|' with '").concat(n).concat(a,"|'")),c})),console.log("Modified code to add:",r);var u=t.substring(o),f="",p=o;if(a)f=t.substring(0,o),p=o;else{t.substring(0,o);for(var d=n-1;d>=0;){var h=s[d];if(/\s|\n|>|<|;|\|/.test(h)){d++;break}d--}d<0&&(d=0),p=d;var g=s.substring(p,n);console.log("Attempting to replace term: '".concat(g,"' starting at index ").concat(p)),f=t.substring(0,p)}var m=u.indexOf("\n"),y="",v="";-1===m?y=u:(y=u.substring(0,m),v=u.substring(m));var b=f+r+(y.length>0?"\n":"")+y+v;c.value=b;var x=(f+r).length;c.focus(),c.setSelectionRange(x,x),k.innerHTML="",k.style.display="none",I=-1,A=[]},n.onmouseover=function(){S(t)},k.appendChild(n)})),console.log("[showSuggestionsForTerm] Setting suggestions display to 'block'");var n=c.getBoundingClientRect();k.style.width=c.offsetWidth+"px",k.style.top=n.bottom+window.scrollY+"px",k.style.left=n.left+window.scrollX+"px",k.style.display="block"}else console.log("[showSuggestionsForTerm] No suggestions found, hiding container."),k.style.display="none"}}(i)):(0===l.length?console.log("[Textarea Input] Hiding suggestions (empty term detected immediately after delimiter)"):console.log("[Textarea Input] Hiding suggestions (term does not start with letter: '".concat(i,"')")),k.style.display="none",I=-1,A=[])}}},c.onkeydown=function(e){if(k&&"block"===k.style.display&&0!==A.length){var t=k.querySelectorAll(".code-suggestion-item"),n=I;switch(e.key){case"ArrowDown":case"ArrowUp":e.preventDefault(),n="ArrowDown"===e.key?(I+1)%A.length:(I-1+A.length)%A.length,S(n);break;case"Enter":case"Tab":e.preventDefault(),I>=0&&I<t.length?t[I].click():A.length>0&&t.length>0&&t[0].click();break;case"Escape":e.preventDefault(),k.style.display="none",I=-1,A=[];break;default:e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||S(-1)}}},c.addEventListener("blur",(function(){k&&setTimeout((function(){k.contains(document.activeElement)||(k.style.display="none",I=-1)}),150)})))}}))}(),function(){"use strict";new URL(n(58394),n.b),new URL(n(60947),n.b)}()}();
//# sourceMappingURL=taskpane.js.map