/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={418:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleApiError=void 0;const n=r(86638),o=r(12111),a=r(38194);t.handleApiError=async(e,t,r)=>{if(e instanceof Error&&"ResponseError"===e.name){const a=e,c=await(0,n.extractMessage)(a),s=a.response.status,i=t?await t(s,c):c;return(0,o.mapHttpStatusError)({status:a.response.status,url:a.response.url||r,message:i})}if(e instanceof a.PineconeConnectionError)return e;{const t=e;return new a.PineconeConnectionError(t)}}},3104:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatStream=void 0;const n=r(57798);class o{constructor(e){this.stream=e}async*[Symbol.asyncIterator](){let e="";for await(const t of this.stream){let r;for(e+=t.toString();-1!==(r=e.indexOf("\n"));){const t=e.slice(0,r).trim();if(e=e.slice(r+1),t&&t.startsWith("data:")){const e=t.slice(5).trim();try{const t=JSON.parse(e),r=(0,n.convertKeysToCamelCase)(t);yield r}catch(e){console.debug(`Skipping malformed JSON:${t}`);continue}}}}if(e.trim())try{const t=JSON.parse(e),r=(0,n.convertKeysToCamelCase)(t);yield r}catch(t){console.debug(`Skipping malformed JSON:${e}`)}}}t.ChatStream=o},12111:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapHttpStatusError=t.PineconeUnmappedHttpError=t.PineconeNotImplementedError=t.PineconeUnavailableError=t.PineconeMaxRetriesExceededError=t.PineconeInternalServerError=t.PineconeConflictError=t.PineconeNotFoundError=t.PineconeAuthorizationError=t.PineconeBadRequestError=void 0;const n=r(41102),o="You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io";class a extends n.BasePineconeError{constructor(e){const{message:t}=e;super(t),this.name="PineconeBadRequestError"}}t.PineconeBadRequestError=a;class c extends n.BasePineconeError{constructor(e){const{url:t}=e;super(t?`The API key you provided was rejected while calling ${t}. Please check your configuration values and try again. ${o}`:`The API key you provided was rejected. Please check your configuration values and try again. ${o}`),this.name="PineconeAuthorizationError"}}t.PineconeAuthorizationError=c;class s extends n.BasePineconeError{constructor(e){const{url:t}=e;super(t?`A call to ${t} returned HTTP status 404.`:"The requested resource could not be found."),this.name="PineconeNotFoundError"}}t.PineconeNotFoundError=s;class i extends n.BasePineconeError{constructor(e){const{url:t,message:r}=e;super(t?`A call to ${t} returned HTTP status 409. ${r||""}`:"The resource you are attempting to create already exists."),this.name="PineconeConflictError"}}t.PineconeConflictError=i;class u extends n.BasePineconeError{constructor(e){const{url:t,body:r,status:n}=e;super([t?`An internal server error occurred while calling the ${t} endpoint.`:"",n?`Status Code: ${n}.`:"","To see overall service health and learn whether this seems like a large-scale problem or one specific to your request, please go to https://status.pinecone.io/ to view our status page. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client",r?`Body: ${r}`:""].join(" ").trim()),this.name="PineconeInternalServerError"}}t.PineconeInternalServerError=u;class l extends n.BasePineconeError{constructor(e){super([`You have exceeded the max configured retries (${e}). `,"Increase the maxRetries field in the RetryOptions object to retry more times. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client"].join(" ").trim()),this.name="PineconeMaxRetriesExceededError"}}t.PineconeMaxRetriesExceededError=l;class p extends n.BasePineconeError{constructor(e){const{url:t,body:r,status:n}=e;super([t?`The Pinecone service (${t}) is temporarily unavailable.`:"",n?`Status Code: ${n}.`:"","To see overall service health and learn whether this seems like a large-scale problem or one specific to your request, please go to https://status.pinecone.io/ to view our status page. If you believe the error reflects a problem with this client, please file a bug report in the github issue tracker at https://github.com/pinecone-io/pinecone-ts-client",r?`Body: ${r}`:""].join(" ").trim()),this.name="PineconeUnavailableError"}}t.PineconeUnavailableError=p;class f extends n.BasePineconeError{constructor(e){const{url:t,message:r}=e;t?super(`A call to ${t} returned HTTP status 501. ${r||""}`):super(),this.name="PineconeNotImplementedError"}}t.PineconeNotImplementedError=f;class h extends n.BasePineconeError{constructor(e){const{url:t,status:r,body:n,message:o}=e;super([t?`An unexpected error occured while calling the ${t} endpoint. `:"",o,r?`Status: ${r}. `:"",n?`Body: ${n}`:""].join(" ").trim()),this.name="PineconeUnmappedHttpError"}}t.PineconeUnmappedHttpError=h,t.mapHttpStatusError=e=>{switch(e.status){case 400:case 403:return new a(e);case 401:return new c(e);case 404:return new s(e);case 409:return new i(e);case 500:return new u(e);case 501:return new f(e);case 503:return new p(e);default:throw new h(e)}}},13165:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFetch=void 0;const n=r(50899);t.getFetch=e=>{if(e.fetchApi)return e.fetchApi;if(r.g.fetch)return r.g.fetch;throw new n.PineconeConfigurationError("No global or user-provided fetch implementations found. Please supply a fetch implementation.")}},16797:function(e,t,r){"use strict";r(41990),r(32793),r(92218),r(88654),r(13165),r(19751),r(3104),r(57798)},19751:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryOnServerFailure=void 0;const n=r(50899);t.RetryOnServerFailure=class{constructor(e,t){if(this.calculateRetryDelay=(e,t=200,r=2e4,n=.25)=>{let o=t*2**e;return o+=o*n*(Math.random()-.5),Math.min(r,Math.max(0,o))},this.maxRetries=t||3,this.maxRetries>10)throw new Error("Max retries cannot exceed 10");this.asyncFn=e}async execute(...e){if(this.maxRetries<1)return this.asyncFn(...e);for(let t=0;t<this.maxRetries;t++)try{const t=await this.asyncFn(...e);if(!this.isRetryError(t))return t;throw t}catch(e){const r=this.mapErrorIfNeeded(e);if(this.shouldStopRetrying(r))throw r;if(t===this.maxRetries-1)throw new n.PineconeMaxRetriesExceededError(this.maxRetries);await this.delay(t+1)}throw new n.PineconeMaxRetriesExceededError(this.maxRetries)}isRetryError(e){if(!e)return!1;if(e){if(e.name&&["PineconeUnavailableError","PineconeInternalServerError"].includes(e.name))return!0;if(e.status&&e.status>=500)return!0}return!1}async delay(e){const t=this.calculateRetryDelay(e);return new Promise((e=>setTimeout(e,t)))}mapErrorIfNeeded(e){return e?.status?(0,n.mapHttpStatusError)(e):e}shouldStopRetrying(e){return e.status?e.status<500:!e.name||"PineconeUnavailableError"!==e.name&&"PineconeInternalServerError"!==e.name}}},20282:function(e,t,r){"use strict";e.exports=r.p+"assets/ChatGPT Image Apr 2, 2025, 10_34_50 PM.png"},23184:function(e){var t,r,n=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var s,i=[],u=!1,l=-1;function p(){u&&s&&(u=!1,s.length?i=s.concat(i):l=-1,i.length&&f())}function f(){if(!u){var e=c(p);u=!0;for(var t=i.length;t;){for(s=i,i=[];++l<t;)s&&s[l].run();l=-1,t=i.length}s=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function d(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new h(e,t)),1!==i.length||u||c(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},30233:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeUnableToResolveHostError=t.PineconeEnvironmentVarsNotSupportedError=t.PineconeUnexpectedResponseError=t.PineconeConfigurationError=void 0;const n=r(41102);class o extends n.BasePineconeError{constructor(e){super(`${e} You can find the configuration values for your project in the Pinecone developer console at https://app.pinecone.io.`),this.name="PineconeConfigurationError"}}t.PineconeConfigurationError=o;class a extends n.BasePineconeError{constructor(e,t,r,n){super(`Unexpected response while calling ${e}. ${n?n+" ":""}Status: ${t}. Body: ${r}`),this.name="PineconeUnexpectedResponseError"}}t.PineconeUnexpectedResponseError=a;class c extends n.BasePineconeError{constructor(e){super(e),this.name="PineconeEnvironmentVarsNotSupportedError"}}t.PineconeEnvironmentVarsNotSupportedError=c;class s extends n.BasePineconeError{constructor(e){super(e),this.name="PineconeUnableToResolveHostError"}}t.PineconeUnableToResolveHostError=s},32516:function(e){"use strict";e.exports=JSON.parse('{"name":"@pinecone-database/pinecone","version":"4.1.0"}')},32793:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeUrl=void 0,t.normalizeUrl=function(e){if(e&&0!==e.trim().length)return e.startsWith("http://")||e.startsWith("https://")?e:"https://"+e}},38194:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeRequestError=t.PineconeConnectionError=void 0;const n=r(41102);class o extends n.BasePineconeError{constructor(e,t){let r="";t&&(r=` while calling ${t}`),super(`Request failed to reach Pinecone${r}. This can occur for reasons such as network problems that prevent the request from being completed, or a Pinecone API outage. Check your network connection, and visit https://status.pinecone.io/ to see whether any outages are ongoing.`,e),this.name="PineconeConnectionError"}}t.PineconeConnectionError=o;class a extends n.BasePineconeError{constructor(e){e.response?super(`Request failed during a call to ${e.init.method} ${e.url} with status ${e.response.status}`,e.error):super(`Request failed during a call to ${e.init.method} ${e.url}`,e.error)}}t.PineconeRequestError=a},41102:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BasePineconeError=void 0;class r extends Error{constructor(e,t){super(e),Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,new.target),this.name=this.constructor.name,this.cause=t}}t.BasePineconeError=r},41990:function(e,t,r){"use strict";var n=r(23184);Object.defineProperty(t,"__esModule",{value:!0}),t.debugLog=void 0,t.debugLog=e=>{void 0!==n&&n&&{}.PINECONE_DEBUG&&console.log(e)}},45208:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isEdge=void 0,t.isEdge=()=>"string"==typeof EdgeRuntime,t.isBrowser=()=>"undefined"!=typeof window},50899:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.handleApiError=t.extractMessage=t.PineconeArgumentError=t.BasePineconeError=t.PineconeRequestError=t.PineconeConnectionError=t.PineconeUnableToResolveHostError=t.PineconeEnvironmentVarsNotSupportedError=t.PineconeUnexpectedResponseError=t.PineconeConfigurationError=void 0;var a=r(30233);Object.defineProperty(t,"PineconeConfigurationError",{enumerable:!0,get:function(){return a.PineconeConfigurationError}}),Object.defineProperty(t,"PineconeUnexpectedResponseError",{enumerable:!0,get:function(){return a.PineconeUnexpectedResponseError}}),Object.defineProperty(t,"PineconeEnvironmentVarsNotSupportedError",{enumerable:!0,get:function(){return a.PineconeEnvironmentVarsNotSupportedError}}),Object.defineProperty(t,"PineconeUnableToResolveHostError",{enumerable:!0,get:function(){return a.PineconeUnableToResolveHostError}}),o(r(12111),t);var c=r(38194);Object.defineProperty(t,"PineconeConnectionError",{enumerable:!0,get:function(){return c.PineconeConnectionError}}),Object.defineProperty(t,"PineconeRequestError",{enumerable:!0,get:function(){return c.PineconeRequestError}});var s=r(41102);Object.defineProperty(t,"BasePineconeError",{enumerable:!0,get:function(){return s.BasePineconeError}});var i=r(92376);Object.defineProperty(t,"PineconeArgumentError",{enumerable:!0,get:function(){return i.PineconeArgumentError}});var u=r(86638);Object.defineProperty(t,"extractMessage",{enumerable:!0,get:function(){return u.extractMessage}});var l=r(418);Object.defineProperty(t,"handleApiError",{enumerable:!0,get:function(){return l.handleApiError}})},57798:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertKeysToCamelCase=void 0,t.convertKeysToCamelCase=e=>Array.isArray(e)?e.map((e=>(0,t.convertKeysToCamelCase)(e))):null!==e&&"object"==typeof e?Object.entries(e).reduce(((e,[n,o])=>(e[r(n)]=(0,t.convertKeysToCamelCase)(o),e)),{}):e;const r=e=>e.replace(/_([a-z])/g,((e,t)=>t.toUpperCase()))},58394:function(e,t,r){"use strict";e.exports=r.p+"d175118c279e1c0ebbbb.css"},86638:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractMessage=void 0,t.extractMessage=async e=>{let t=await e.response.text();try{const e=JSON.parse(t);e.message&&(t=e.message)}catch(e){}return t}},88654:function(e,t,r){"use strict";var n=r(23184),o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.buildUserAgent=void 0;const s=r(45208),i=c(r(32516));t.buildUserAgent=e=>{const t=[`${i.name} v${i.version}`,"lang=typescript"];return(0,s.isEdge)()&&t.push("Edge Runtime"),void 0!==n&&n&&n.version&&t.push(`node ${n.version}`),e.sourceTag&&t.push(`source_tag=${u(e.sourceTag)}`),t.join("; ")};const u=e=>{if(e)return e.toLowerCase().replace(/[^a-z0-9_ :]/g,"").trim().replace(/[ ]+/g,"_")}},92218:function(e,t){"use strict";function r(e,t=""){return Object.keys(e).map((r=>n(r,e[r],t))).filter((e=>e.length>0)).join("&")}function n(e,t,o=""){const a=o+(o.length?`[${e}]`:e);if(Array.isArray(t)){const e=t.map((e=>encodeURIComponent(String(e)))).join(`&${encodeURIComponent(a)}=`);return`${encodeURIComponent(a)}=${e}`}return t instanceof Set?n(e,Array.from(t),o):t instanceof Date?`${encodeURIComponent(a)}=${encodeURIComponent(t.toISOString())}`:t instanceof Object?r(t,a):`${encodeURIComponent(a)}=${encodeURIComponent(String(t))}`}Object.defineProperty(t,"__esModule",{value:!0}),t.queryParamsStringify=void 0,t.queryParamsStringify=r},92376:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PineconeArgumentError=void 0;const n=r(41102);class o extends n.BasePineconeError{constructor(e){super(`${e}`),this.name="PineconeArgumentError"}}t.PineconeArgumentError=o}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e}(),r.b=document.baseURI||self.location.href,function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){t=function(){return n};var r,n={},o=Object.prototype,a=o.hasOwnProperty,c=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(r){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof w?t:w,a=Object.create(o.prototype),s=new _(n||[]);return c(a,"_invoke",{value:R(e,r,s)}),a}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var d="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function w(){}function b(){}function x(){}var E={};p(E,i,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(T([])));P&&P!==o&&a.call(P,i)&&(E=P);var I=x.prototype=w.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function C(t,r){function n(o,c,s,i){var u=h(t[o],t,c);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==e(p)&&a.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,s,i)}),(function(e){n("throw",e,s,i)})):r.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,i)}))}i(u.arg)}var o;c(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(a,a):a()}})}function R(e,t,n){var o=d;return function(a,c){if(o===m)throw Error("Generator is already running");if(o===y){if("throw"===a)throw c;return{value:r,done:!0}}for(n.method=a,n.arg=c;;){var s=n.delegate;if(s){var i=A(s,n);if(i){if(i===v)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=h(e,t,n);if("normal"===u.type){if(o=n.done?y:g,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function A(e,t){var n=t.method,o=e.iterator[n];if(o===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=r,A(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=h(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var c=a.arg;return c?c.done?(t[e.resultName]=c.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):c:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function e(){for(;++o<t.length;)if(a.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=r,e.done=!0,e};return c.next=c}}throw new TypeError(e(t)+" is not iterable")}return b.prototype=x,c(I,"constructor",{value:x,configurable:!0}),c(x,"constructor",{value:b,configurable:!0}),b.displayName=p(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,p(e,l,"GeneratorFunction")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},S(C.prototype),p(C.prototype,u,(function(){return this})),n.AsyncIterator=C,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var c=new C(f(e,t,r,o),a);return n.isGeneratorFunction(t)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},S(I),p(I,l,"Generator"),p(I,i,(function(){return this})),p(I,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=T,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(F),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],s=c.completion;if("root"===c.tryLoc)return n("end");if(c.tryLoc<=this.prev){var i=a.call(c,"catchLoc"),u=a.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return n(c.catchLoc,!0);if(this.prev<c.finallyLoc)return n(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return n(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return n(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}},n}function n(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){i=!0,c=e},f:function(){try{s||null==r.return||r.return()}finally{if(i)throw c}}}}function a(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,o)}function i(e){return u.apply(this,arguments)}function u(){return(e=t().mark((function e(r){var a,c,s,i,u,l,p,f,h,d,g,m,y,v,w,b,x,E,k,P,I,S,C,R,A,O,F,_,T,j,L,N,B,D,M,U,q;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],c=new Set,s=new Set,i=new Set,r=r.map((function(e){var t=e.match(/<[^>]+>/);return t?t[0]:e})),console.log("CleanedInput Code Strings:",r),u=new Set,l=new Set,p=new Set,f=new Set,h=new Set,d=new Set,g=new Set,e.prev=13,e.next=16,fetch("../prompts/Codes.txt");case 16:if((m=e.sent).ok){e.next=19;break}throw new Error("Failed to load Codes.txt file");case 19:return e.next=21,m.text();case 21:y=e.sent,g=new Set(y.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))),e.next=29;break;case 25:return e.prev=25,e.t0=e.catch(13),a.push("Error reading Codes.txt file: ".concat(e.t0.message)),e.abrupt("return",a);case 29:v=o(r),e.prev=30,v.s();case 32:if((w=v.n()).done){e.next=45;break}if((b=w.value).startsWith("<")&&b.endsWith(">")){e.next=37;break}return a.push("Invalid code string format: ".concat(b)),e.abrupt("continue",43);case 37:if(!b.startsWith("<BR>")){e.next=39;break}return e.abrupt("continue",43);case 39:(x=b.match(/row\d+\s*=\s*"([^"]*)"/g))&&x.forEach((function(e){var t=e.match(/row\d+\s*=\s*"([^"]*)"/)[1].split("|");t.length>0&&t.forEach((function(e){var t=e.trim();if(t.startsWith("*")){var r=t.substring(1).trim();r&&s.add(r)}else t&&s.add(t)}))})),(E=b.match(/<([^;]+);/))&&(k=E[1].trim(),i.add(k),k.endsWith("-VV")&&u.add(k),k.endsWith("-VR")&&l.add(k),k.endsWith("-RR")&&p.add(k),k.endsWith("-RV")&&f.add(k),k.endsWith("-EV")&&h.add(k),k.endsWith("-ER")&&d.add(k));case 43:e.next=32;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(30),v.e(e.t1);case 50:return e.prev=50,v.f(),e.finish(50);case 53:for(P=0,I=[].concat(n(u),n(l));P<I.length;P++)S=I[P],0===h.size&&0===f.size&&a.push("Code ".concat(S," requires another code with suffix -EV or -RV. Fix by adding another code with the correct suffix or by change to the EV/ER version of the same code."));for(C=0,R=[].concat(n(p),n(f));C<R.length;C++)A=R[C],0===d.size&&0===l.size&&a.push("Code ".concat(A," requires another code with suffix -ER or -VR"));O=o(r),e.prev=56,O.s();case 58:if((F=O.n()).done){e.next=82;break}if("<BR>"!==(_=F.value)){e.next=62;break}return e.abrupt("continue",80);case 62:if(T=_.match(/<([^;]+);/)){e.next=66;break}return a.push("Cannot extract code type from: ".concat(_)),e.abrupt("continue",80);case 66:if(j=T[1].trim(),g.has(j)||a.push('Invalid code type: "'.concat(j,'" not found in valid codes list')),"TAB"!==j){e.next=78;break}if(L=_.match(/label\d+="([^"]*)"/)){e.next=73;break}return a.push("TAB code missing label parameter"),e.abrupt("continue",80);case 73:(N=L[1]).length>30&&a.push('Tab label too long (max 30 chars): "'.concat(N,'"')),/[&,":;]/.test(N)&&a.push('Tab label contains illegal characters (&,":;): "'.concat(N,'"')),c.has(N)&&a.push('Duplicate tab label: "'.concat(N,'"')),c.add(N);case 78:(B=_.match(/row\d+="([^"]*)"/g))&&B.forEach((function(e){var t=e.match(/row\d+="([^"]*)"/)[1];t.split("|").length<2&&a.push('Invalid row format (missing required fields): "'.concat(t,'"'))}));case 80:e.next=58;break;case 82:e.next=87;break;case 84:e.prev=84,e.t2=e.catch(56),O.e(e.t2);case 87:return e.prev=87,O.f(),e.finish(87);case 90:D=o(r);try{for(D.s();!(M=D.n()).done;)U=M.value,(q=U.match(/driver\d+\s*=\s*"([^"]*)"/g))&&q.forEach((function(e){var t=e.match(/driver\d+\s*=\s*"([^"]*)"/)[1].trim();s.has(t)||a.push('Driver value "'.concat(t,'" not found in any row'))}))}catch(e){D.e(e)}finally{D.f()}return e.abrupt("return",a.join("\n"));case 93:case"end":return e.stop()}}),e,null,[[13,25],[30,47,50,53],[56,84,87,90]])})),u=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){s(a,n,o,c,i,"next",e)}function i(e){s(a,n,o,c,i,"throw",e)}c(void 0)}))}).apply(this,arguments);var e}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function p(){p=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var a=t&&t.prototype instanceof w?t:w,c=Object.create(a.prototype),s=new _(n||[]);return o(c,"_invoke",{value:R(e,r,s)}),c}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var d="suspendedStart",g="suspendedYield",m="executing",y="completed",v={};function w(){}function b(){}function x(){}var E={};u(E,c,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(T([])));P&&P!==r&&n.call(P,c)&&(E=P);var I=x.prototype=w.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,a,c,s){var i=h(e[o],e,a);if("throw"!==i.type){var u=i.arg,p=u.value;return p&&"object"==l(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(p).then((function(e){u.value=e,c(u)}),(function(e){return r("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function R(t,r,n){var o=d;return function(a,c){if(o===m)throw Error("Generator is already running");if(o===y){if("throw"===a)throw c;return{value:e,done:!0}}for(n.method=a,n.arg=c;;){var s=n.delegate;if(s){var i=A(s,n);if(i){if(i===v)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=h(t,r,n);if("normal"===u.type){if(o=n.done?y:g,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=h(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var c=a.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(l(t)+" is not iterable")}return b.prototype=x,o(I,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:b,configurable:!0}),b.displayName=u(x,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,i,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},S(C.prototype),u(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var c=new C(f(e,r,n,o),a);return t.isGeneratorFunction(r)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},S(I),u(I,i,"Generator"),u(I,c,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=n.call(c,"catchLoc"),u=n.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function f(e,t,r,n,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,o)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){f(a,n,o,c,s,"next",e)}function s(e){f(a,n,o,c,s,"throw",e)}c(void 0)}))}}function d(e){return g.apply(this,arguments)}function g(){return g=h(p().mark((function e(t){var r,n=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:null,e.prev=1,t&&"string"==typeof t){e.next=4;break}throw new Error("Invalid base64 string provided");case 4:if(/^[A-Za-z0-9+/]*={0,2}$/.test(t)){e.next=6;break}throw new Error("Invalid base64 format");case 6:return e.next=8,Excel.run(function(){var e=h(p().mark((function e(n){var o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=n.workbook).insertWorksheetsFromBase64){e.next=3;break}throw new Error("This feature requires Excel API requirement set 1.13 or later");case 3:return e.prev=3,e.next=6,o.insertWorksheetsFromBase64(t,{sheetNames:r});case 6:return e.next=8,n.sync();case 8:console.log("Worksheets inserted successfully"),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),console.error("Error during worksheet insertion:",e.t0),new Error("Failed to insert worksheets: ".concat(e.t0.message));case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}());case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(1),console.error("Error inserting worksheets from base64:",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),g.apply(this,arguments)}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t,r){return(t=function(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(){b=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,c=Object.create(a.prototype),s=new _(n||[]);return o(c,"_invoke",{value:R(e,r,s)}),c}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",g="completed",y={};function v(){}function w(){}function x(){}var E={};u(E,c,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(T([])));P&&P!==r&&n.call(P,c)&&(E=P);var I=x.prototype=v.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,a,c,s){var i=p(e[o],e,a);if("throw"!==i.type){var u=i.arg,l=u.value;return l&&"object"==m(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){u.value=e,c(u)}),(function(e){return r("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function R(t,r,n){var o=f;return function(a,c){if(o===d)throw Error("Generator is already running");if(o===g){if("throw"===a)throw c;return{value:e,done:!0}}for(n.method=a,n.arg=c;;){var s=n.delegate;if(s){var i=A(s,n);if(i){if(i===y)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?g:h,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var c=a.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function F(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(m(t)+" is not iterable")}return w.prototype=x,o(I,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=u(x,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u(e,i,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},S(C.prototype),u(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var c=new C(l(e,r,n,o),a);return t.isGeneratorFunction(r)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},S(I),u(I,i,"Generator"),u(I,c,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=T,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=n.call(c,"catchLoc"),u=n.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),F(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function x(e,t,r,n,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,o)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){x(a,n,o,c,s,"next",e)}function s(e){x(a,n,o,c,s,"throw",e)}c(void 0)}))}}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,c,s=[],i=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(u)throw o}}return s}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=I(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function I(e,t){if(e){if("string"==typeof e)return S(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function C(e){try{console.log("Processing input text for code collection");var t,r=[],n=P(e.split("\n"));try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.trim()){var a=o.match(/<([^;>]+);(.*?)>/);if(a){var c,s=a[1].trim(),i=a[2].trim(),u={},l=P(i.matchAll(/row(\d+)\s*=\s*"([^"]*)"/g));try{for(l.s();!(c=l.n()).done;){var p=c.value,f=p[1],h=p[2];u["row".concat(f)]=h}}catch(e){l.e(e)}finally{l.f()}var d,g=P(i.matchAll(/(\w+)\s*=\s*"([^"]*)"/g));try{for(g.s();!(d=g.n()).done;){var m=d.value,y=m[1].trim(),v=m[2].trim();y.startsWith("row")||(u[y]=v)}}catch(e){g.e(e)}finally{g.f()}r.push({type:s,params:u})}}}}catch(e){n.e(e)}finally{n.f()}return console.log("Processed ".concat(r.length," codes")),r}catch(e){throw console.error("Error in populateCodeCollection:",e),e}}function R(e){return A.apply(this,arguments)}function A(){return A=E(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=E(b().mark((function e(r){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=r.workbook.application).calculationMode=t?Excel.CalculationMode.manual:Excel.CalculationMode.automatic,console.log("Calculation mode set to: ".concat(n.calculationMode)),e.next=5,r.sync();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error toggling calculation mode: ".concat(e.t0));case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),A.apply(this,arguments)}function O(e){return F.apply(this,arguments)}function F(){return F=E(b().mark((function e(t){var r,n,o,a,c,s;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Running code collection processing"),e.next=4,R(!0);case 4:if(t&&Array.isArray(t)){e.next=6;break}throw new Error("Invalid code collection");case 6:r={processedCodes:0,createdTabs:[],errors:[]},n=null,o=[],a=b().mark((function e(a){var c,s,i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t[a],s=c.type,e.prev=2,"MODEL"!==s){e.next=6;break}return console.log("MODEL code type encountered - skipping for now"),e.abrupt("return",0);case 6:if("TAB"!==s){e.next=11;break}return i=c.params.label1||c.params.Label1||"Tab_".concat(a),e.next=10,Excel.run(function(){var e=E(b().mark((function e(t){var a,c,s,u,l,p;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a=t.workbook.worksheets).load("items/name"),console.log("sheets",a),e.next=6,t.sync();case 6:if(c=a.items.find((function(e){return e.name===i})),console.log("existingSheet",c),!c){e.next=12;break}return c.delete(),e.next=12,t.sync();case 12:return console.log("existingSheet deleted"),s=t.workbook.worksheets.getItem("Calcs"),console.log("sourceCalcsWS",s),u=s.copy(),console.log("newSheet created by copying Calcs worksheet"),u.name=i,console.log("newSheet renamed to",i),l=9,console.log("firstRow",l),(p=u.getUsedRange()).load("rowCount"),e.next=25,t.sync();case 25:return p.rowCount>=l&&(u.getRange("".concat(l,":").concat(p.rowCount)).clear(),console.log("Cleared all cells from row ".concat(l," to ").concat(p.rowCount))),o.push({name:i,worksheet:u}),n=i,e.next=30,t.sync();case 30:r.createdTabs.push(i),console.log("Tab created successfully:",i),e.next=38;break;case 34:throw e.prev=34,e.t0=e.catch(0),console.error("Detailed error in TAB processing:",e.t0),e.t0;case 38:case"end":return e.stop()}}),e,null,[[0,34]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error processing TAB code: ".concat(e.message)),r.errors.push({codeIndex:a,codeType:s,error:e.message})}));case 10:return e.abrupt("return",0);case 11:if("TAB"===s){e.next=14;break}return e.next=14,Excel.run(function(){var e=E(b().mark((function e(t){var o,i,u,l,p,f,h,d,g,m,y;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.workbook.worksheets.getItem("Codes"),console.log("Got Codes worksheet"),(i=o.getUsedRange()).load("rowCount"),i.load("columnCount"),e.next=8,t.sync();case 8:return console.log("Used range: ".concat(i.rowCount," rows x ").concat(i.columnCount," columns")),u=t.workbook.worksheets.getItem(n),console.log("Got current worksheet:",n),(l=u.getUsedRange().getLastRow()).load("rowIndex"),e.next=15,t.sync();case 15:return p=l.rowIndex+2,console.log("Paste row:",p),f=-1,h=-1,(d=o.getRange("D1:D".concat(i.rowCount))).load("values"),e.next=23,t.sync();case 23:if(console.log("Loaded column D values"),d.values){e.next=27;break}throw console.error("columnD.values is null or undefined"),new Error("Failed to load values from column D in Codes worksheet");case 27:for(console.log("columnD.values length: ".concat(d.values.length)),console.log("First 10 values in column D:"),g=0;g<Math.min(10,d.values.length);g++)console.log("Row ".concat(g+1,": ").concat(d.values[g][0]));for(m=0;m<d.values.length;m++)d.values[m][0]===s&&(-1===f&&(f=m+1),h=m+1);if(-1!==f&&-1!==h){e.next=38;break}console.warn("Code type ".concat(s," not found in Codes worksheet. Skipping this code.")),r.errors.push({codeIndex:a,codeType:s,error:"Code type ".concat(s," not found in Codes worksheet")}),r.processedCodes++,e.next=59;break;case 38:return console.log("Found code type ".concat(s," in rows ").concat(f," to ").concat(h)),e.next=41,Excel.run(function(){var e=E(b().mark((function e(t){var r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.workbook.worksheets.getItem("Codes").getRange("A".concat(f,":CX").concat(h)),t.workbook.worksheets.getItem(n).getRange("A".concat(p)).copyFrom(r,Excel.RangeCopyType.all),e.next=5,t.sync();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 41:return e.next=43,t.sync();case 43:return e.prev=43,console.log("Applying driver and assumption inputs to worksheet: ".concat(n)),(y=t.workbook.worksheets.getItem(n)).load("name"),e.next=49,t.sync();case 49:return e.next=51,j(y,p,c);case 51:console.log("Successfully applied driver and assumption inputs to worksheet: ".concat(n)),e.next=58;break;case 54:e.prev=54,e.t0=e.catch(43),console.error("Error applying driver and assumption inputs: ".concat(e.t0.message)),r.errors.push({codeIndex:a,codeType:s,error:"Error applying driver and assumption inputs: ".concat(e.t0.message)});case 58:r.processedCodes++;case 59:e.next=65;break;case 61:throw e.prev=61,e.t1=e.catch(0),console.error("Error processing code ".concat(s,":"),e.t1),e.t1;case 65:case"end":return e.stop()}}),e,null,[[0,61],[43,54]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error processing code ".concat(s,": ").concat(e.message)),r.errors.push({codeIndex:a,codeType:s,error:e.message})}));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),console.error("Error processing code ".concat(a,":"),e.t0),r.errors.push({codeIndex:a,codeType:s,error:e.t0.message});case 20:case"end":return e.stop()}}),e,null,[[2,16]])})),c=0;case 11:if(!(c<t.length)){e.next=19;break}return e.delegateYield(a(c),"t0",13);case 13:if(0!==e.t0){e.next=16;break}return e.abrupt("continue",16);case 16:c++,e.next=11;break;case 19:return e.next=21,R(!1);case 21:return s=v(v({},r),{},{assumptionTabs:o.map((function(e){return e.name}))}),console.log("runCodes finished. Returning:",s),e.abrupt("return",s);case 26:throw e.prev=26,e.t1=e.catch(0),console.error("Error in runCodes:",e.t1),e.t1;case 30:case"end":return e.stop()}}),e,null,[[0,26]])}))),F.apply(this,arguments)}function _(){return T.apply(this,arguments)}function T(){return T=E(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Testing if cell B2 is green (#CCFFCC)"),e.next=4,Excel.run(function(){var e=E(b().mark((function e(t){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.workbook.worksheets.getActiveWorksheet().getRange("B2")).load(["format/fill/color","address"]),e.next=4,t.sync();case 4:return n="#CCFFCC"===r.format.fill.color,console.log("Cell B2 address: ".concat(r.address,", color: ").concat(r.format.fill.color,", Is green: ").concat(n)),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error in isActiveCellGreen:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),T.apply(this,arguments)}function j(e,t,r){return L.apply(this,arguments)}function L(){return L=E(b().mark((function e(t,r,n){var o,a;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="unknown",e.prev=2,e.next=5,Excel.run(function(){var e=E(b().mark((function e(r){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.load("name"),e.next=3,r.sync();case 3:o=t.name;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),console.error("Failed to load worksheet name before calling helper",e.t0),new Error("Cannot determine worksheet name to proceed.");case 11:return a=1e3,e.prev=12,e.next=15,Excel.run(function(){var e=E(b().mark((function e(t){var r,n,a,c;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.workbook.worksheets.getItem(o),n=r.getUsedRange(),(a=n.getLastRow()).load("rowIndex"),e.next=6,t.sync();case 6:return c=a.rowIndex+1,console.log("lastRow",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 15:a=e.sent,e.next=22;break;case 18:throw e.prev=18,e.t1=e.catch(12),console.error("Failed to determine last row",e.t1),new Error("Cannot determine last row to proceed.");case 22:if(!("number"!=typeof a||a<=0)){e.next=25;break}throw console.error("Last row determination failed or returned invalid value (".concat(a,"). Cannot proceed safely.")),new Error("Failed to determine a valid last row for processing.");case 25:return e.next=27,Excel.run(function(){var e=E(b().mark((function e(t){var c,s,i,u,l,p,f,h,d,g,m,y,v,w,x,E,k,P,I,S,C,R,A,O,F,_,T,j,L,N,B,D,M,U,q;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a,s=t.workbook.worksheets.getItem(o),console.log("Processing driver/assumption inputs for worksheet: ".concat(o,", Code: ").concat(n.type,", Start Row: ").concat(r,", Using Last Row: ").concat(c)),i=["A","B","C","G","H","I","K","L","M","N","O","P","R"],u=n.type,l=-1,p=null,f="",e.prev=8,console.log("Attempting to get searchRange. calcsPasteRow: ".concat(r,", determinedLastRow: ").concat(c)),!("number"!=typeof r||"number"!=typeof c||r<=0||c<r)){e.next=15;break}console.error("Invalid range parameters for searchRange: calcsPasteRow=".concat(r,", determinedLastRow=").concat(c,". Skipping search.")),l=-1,e.next=23;break;case 15:return f="D".concat(r,":D").concat(c),console.log("Creating searchRange with address: ".concat(f)),p=s.getRange(f),console.log("Loading values for searchRange: ".concat(f)),p.load("values"),e.next=22,t.sync();case 22:console.log("Successfully loaded values for searchRange: ".concat(f));case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),console.error("Error loading/syncing searchRange (".concat(f,"): ").concat(e.t0.message),e.t0),l=-1;case 29:if(!p||!p.values){e.next=43;break}console.log("SearchRange (".concat(f,") has loaded values. Searching for codeValue: ").concat(u)),h=0;case 32:if(!(h<p.values.length)){e.next=40;break}if(p.values[h][0]!==u){e.next=37;break}return l=r+h,console.log("Found codeValue '".concat(u,"' at index ").concat(h,", resulting searchRow: ").concat(l)),e.abrupt("break",40);case 37:h++,e.next=32;break;case 40:-1===l&&console.log("CodeValue '".concat(u,"' not found within the loaded values of searchRange (").concat(f,").")),e.next=44;break;case 43:-1!==l&&(console.warn("searchRange (".concat(f,") object exists but '.values' property is not available after sync. Search cannot be performed.")),l=-1);case 44:if(-1!==l){e.next=47;break}return console.warn("Code type ".concat(u," not found or could not be searched for in column D (Range: ").concat(f||"Invalid","). Skipping inputs for this code.")),e.abrupt("return");case 47:console.log("Found code ".concat(u," at search row: ").concat(l)),d=l,g=!0;case 50:if(!g){e.next=63;break}return(m=s.getRange("B".concat(d))).load("format/fill/color"),e.next=55,t.sync();case 55:if(m.format&&m.format.fill?g="#CCFFCC"===m.format.fill.color:(console.warn("Could not read fill color for cell B".concat(d,". Assuming not green.")),g=!1),!g){e.next=61;break}if(!(++d>c+50)){e.next=61;break}throw console.error("Check row exceeded expected limits. Breaking loop."),new Error("Failed to find non-green check row within reasonable bounds.");case 61:e.next=50;break;case 63:console.log("Found check row (first non-green row in B at/after search row): ".concat(d)),y=1;case 65:if(!(y<=9)){e.next=78;break}if(!((v=l+y-1)>c+20)){e.next=70;break}return console.warn("Target row ".concat(v," seems too high. Skipping write for k=").concat(y,".")),e.abrupt("continue",75);case 70:1===y&&n.params.financialsdriver&&(s.getRange("I".concat(v)).values=[[n.params.financialsdriver]],console.log("Set financialsdriver at I".concat(v,": ").concat(n.params.financialsdriver))),(w=n.params["driver".concat(y)])&&(s.getRange("F".concat(v)).values=[[w]],console.log("Set driver".concat(y," at F").concat(v,": ").concat(w))),(x=n.params["label".concat(y)])&&(s.getRange("B".concat(v)).values=[[x]],console.log("Set label".concat(y," at B").concat(v,": ").concat(x)));case 75:y++,e.next=65;break;case 78:return e.next=80,t.sync();case 80:E=d,k=1;case 82:if(!(k<=200)){e.next=128;break}if(P=n.params["row".concat(k)]){e.next=86;break}return e.abrupt("continue",125);case 86:if(console.log("Processing row".concat(k,": ").concat(P)),I=P.split("*"),S=I.length-1,C=E+k-1,console.log("Base row for row".concat(k,": ").concat(C,", numNewRows: ").concat(S)),!(S>0)){e.next=103;break}return R="".concat(C+1,":").concat(C+S),console.log("Inserting ".concat(S," rows at ").concat(R)),s.getRange(R).insert(Excel.InsertShiftDirection.down),e.next=98,t.sync();case 98:for(console.log("Copying formats/formulas sequentially for inserted rows."),A=0;A<S;A++)O=C+A,F=C+A+1,_=s.getRange("".concat(O,":").concat(O)),T=s.getRange("".concat(F,":").concat(F)),console.log("  Copying formats from row ".concat(O," to ").concat(F)),T.copyFrom(_,Excel.RangeCopyType.formats),console.log("  Copying formulas from row ".concat(O," to ").concat(F)),T.copyFrom(_,Excel.RangeCopyType.formulas);return e.next=102,t.sync();case 102:console.log("Finished sequential copy for inserted rows.");case 103:j=0;case 104:if(!(j<=S)){e.next=121;break}L=C+j,N=I[j].split("|"),console.log("Populating row ".concat(L," with items: ").concat(I[j])),B=0;case 109:if(!(B<N.length)){e.next=118;break}if(!(B>=i.length)){e.next=113;break}return console.warn("Data item index ".concat(B," exceeds columnSequence length (").concat(i.length,"). Skipping.")),e.abrupt("continue",115);case 113:(D=N[B])&&"F"!==D.toUpperCase()&&(M=i[B],U=s.getRange("".concat(M).concat(L)),q=Number(D),isNaN(q)||""===D.trim()?""!==D.trim()&&(U.values=[[D]]):U.values=[[q]]);case 115:B++,e.next=109;break;case 118:j++,e.next=104;break;case 121:return e.next=123,t.sync();case 123:E+=S,console.log("Finished processing row".concat(k,". currentCheckRowForInserts is now ").concat(E));case 125:k++,e.next=82;break;case 128:console.log("Completed processing driver and assumption inputs for code ".concat(u," in worksheet ").concat(o));case 129:case"end":return e.stop()}}),e,null,[[8,25]])})));return function(t){return e.apply(this,arguments)}}());case 27:e.next=33;break;case 29:throw e.prev=29,e.t2=e.catch(0),console.error("Error in driverAndAssumptionInputs MAIN CATCH for code '".concat(n.type,"' in worksheet '").concat((null==t?void 0:t.name)||"unknown","': ").concat(e.t2.message),e.t2),e.t2;case 33:case"end":return e.stop()}}),e,null,[[0,29],[2,7],[12,18]])}))),L.apply(this,arguments)}function N(e,t){return B.apply(this,arguments)}function B(){return(B=E(b().mark((function e(t,r){var n,o,a,c;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to get last used row for column ".concat(r," in sheet ").concat(t.name)),e.prev=1,n=t.getRange("".concat(r,":").concat(r)),o=n.getUsedRange(!0),(a=o.getLastCell()).load("rowIndex"),e.next=8,t.context.sync();case 8:return c=a.rowIndex+1,console.log("Last used row in column ".concat(r," is ").concat(c)),e.abrupt("return",c);case 13:if(e.prev=13,e.t0=e.catch(1),"ItemNotFound"!==e.t0.code&&"GeneralException"!==e.t0.code){e.next=18;break}return console.warn("Could not find used range or last cell in column ".concat(r," of sheet ").concat(t.name,". Assuming empty or header only (returning 0).")),e.abrupt("return",0);case 18:throw console.error("Error in getLastUsedRow for column ".concat(r," on sheet ").concat(t.name,":"),e.t0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function D(e,t){return M.apply(this,arguments)}function M(){return(M=E(b().mark((function e(t,r){var n,o,a,c,s,i,u,l,p,f,h,d,g,m,y,v,w,x,E,k,P,I,S;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=9,o="F",a="A",c="AE",console.log("Running adjustDriversJS for sheet: ".concat(t.name," from row ").concat(n," to ").concat(r)),!(r<n)){e.next=8;break}return console.warn("adjustDriversJS: lastRow (".concat(r,") is less than START_ROW (").concat(n,"). Skipping.")),e.abrupt("return");case 8:return e.prev=8,s="".concat(o).concat(n,":").concat(o).concat(r),i="".concat(a).concat(n,":").concat(a).concat(r),u=t.getRange(s),l=t.getRange(i),u.load("values"),l.load("values"),e.next=17,t.context.sync();case 17:for(p=u.values,f=l.values,h=new Map,d=0;d<f.length;d++)null!==(g=f[d][0])&&""!==g&&h.set(g,n+d);for(console.log("Built lookup map from ".concat(a).concat(n,":").concat(a).concat(r," with ").concat(h.size," entries.")),m=[],y=0,v=0,w=0;w<p.length;w++)x=p[w][0],E=n+w,null!==x&&""!==x?h.has(x)?(k=h.get(x),P="".concat(c).concat(k),m.push([P]),y++):(console.warn("adjustDriversJS: Driver code '".concat(x,"' from cell ").concat(o).concat(E," not found in range ").concat(i,".")),m.push([null]),v++):m.push([null]);m.length>0?(I="".concat(c).concat(n,":").concat(c).concat(r),S=t.getRange(I),console.log("Writing ".concat(y," results (").concat(v," not found) to ").concat(I)),S.values=m):console.log("adjustDriversJS: No values to write to ".concat(c,".")),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(8),console.error("Error in adjustDriversJS for sheet ".concat(t.name,":"),e.t0);case 32:case"end":return e.stop()}}),e,null,[[8,29]])})))).apply(this,arguments)}function U(e,t){return q.apply(this,arguments)}function q(){return(q=E(b().mark((function e(t,r){var n,o,a,c,s,i,u,l,p,f,h,d,g,m,y,v,w,x,E,I,S,C,R,A,O,F,_,T,j,L,N,B,D,M,U,q,$,G,J,Y;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=9,o="AE",console.log("Running replaceIndirectsJS for sheet: ".concat(t.name," from row ").concat(n," to ").concat(r)),!(r<n)){e.next=6;break}return console.warn("replaceIndirectsJS: lastRow (".concat(r,") is less than START_ROW (").concat(n,"). Skipping.")),e.abrupt("return");case 6:return a="".concat(o).concat(n,":").concat(o).concat(r),c=t.getRange(a),e.prev=8,c.load("formulas"),e.next=12,t.context.sync();case 12:s=c.formulas,i=new Map,u=[],console.log("Replace_Indirects: Pass 1 - Identifying INDIRECT arguments"),l=0;case 17:if(!(l<s.length)){e.next=40;break}if(p=s[l][0],u.push({originalFormula:p,index:l}),"string"!=typeof p){e.next=37;break}f=0;case 22:if(h=p.toUpperCase(),-1!==(d=h.indexOf("INDIRECT(",f))&&!h.includes("INDEX(")){e.next=27;break}return e.abrupt("break",37);case 27:if(g=d+9,-1!==(m=p.indexOf(")",g))){e.next=32;break}return console.warn("Row ".concat(n+l,": Malformed INDIRECT found in formula: ").concat(p)),e.abrupt("break",37);case 32:(y=p.substring(g,m).trim())&&/^[A-Za-z0-9_!$:'". ]+$/.test(y)&&!i.has(y)&&(console.log("  Found reference to lookup: ".concat(y)),i.set(y,{range:null,value:void 0})),f=m+1,e.next=22;break;case 37:l++,e.next=17;break;case 40:if(console.log("Replace_Indirects: Loading values for ".concat(i.size," unique references.")),!(i.size>0)){e.next=49;break}v=P(i.entries());try{for(v.s();!(w=v.n()).done;){x=k(w.value,2),E=x[0],I=x[1];try{I.range=t.getRange(E),I.range.load(["values","text"])}catch(e){console.warn('Replace_Indirects: Error getting range for reference "'.concat(E,'". It might be invalid or on another sheet.'),e.debugInfo||e.message),i.set(E,{range:null,value:"#REF!"})}}}catch(e){v.e(e)}finally{v.f()}return e.next=46,t.context.sync();case 46:S=P(i.entries());try{for(S.s();!(C=S.n()).done;)if(R=k(C.value,2),A=R[0],(O=R[1]).range)try{F=O.range.text[0][0],O.value="DELETE"===F?"0":O.range.values[0][0]}catch(e){console.warn('Replace_Indirects: Error reading value for reference "'.concat(A,'" after sync.'),e.debugInfo||e.message),O.value="#VALUE!"}}catch(e){S.e(e)}finally{S.f()}console.log("Replace_Indirects: Finished loading reference values.");case 49:console.log("Replace_Indirects: Pass 2 - Replacing INDIRECT calls."),_=[],T=0,j=u;case 52:if(!(T<j.length)){e.next=81;break}if(L=j[T],"string"!=typeof(N=L.originalFormula)){e.next=77;break}B=0,D=20;case 58:if(!(B<D)){e.next=76;break}if(M=N.toUpperCase(),-1!==(U=M.indexOf("INDIRECT("))&&!M.includes("INDEX(")){e.next=63;break}return e.abrupt("break",76);case 63:if(q=U+9,-1!==($=N.indexOf(")",q))){e.next=67;break}return e.abrupt("break",76);case 67:G=N.substring(U,$+1),J=N.substring(q,$).trim(),Y="#REF!",i.has(J)?Y=i.get(J).value:console.warn("Row ".concat(n+L.index,': INDIRECT argument "').concat(J,'" not found in lookup map during replacement.')),null==Y?Y=0:""===Y||"string"==typeof Y||"boolean"==typeof Y&&(Y=Y?"TRUE":"FALSE"),N=N.replace(G,String(Y)),B++,e.next=58;break;case 76:B===D&&console.warn("Row ".concat(n+L.index,": Max replacement loops reached for formula. Result might be incomplete: ").concat(N));case 77:_.push([N]);case 78:T++,e.next=52;break;case 81:console.log("Replace_Indirects: Writing ".concat(_.length," updated formulas back to ").concat(a)),c.formulas=_,e.next=89;break;case 85:throw e.prev=85,e.t0=e.catch(8),console.error("Error in replaceIndirectsJS for sheet ".concat(t.name," range ").concat(a,":"),e.t0.debugInfo||e.t0),e.t0;case 89:case"end":return e.stop()}}),e,null,[[8,85]])})))).apply(this,arguments)}function $(e,t,r){return G.apply(this,arguments)}function G(){return(G=E(b().mark((function e(t,r,n){var o,a,c,s,i,u,l,p,f,h,d,g,m,y,v,w,x,E,k,P,I,S,C,R,A,O,F,_,T,j,L,N,B,D,M,U,q,$,G,J,Y,W,V,K,z,H,X,Z,Q,ee,te,re,ne,oe,ae,ce,se,ie,ue,le;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Running populateFinancialsJS for sheet: ".concat(t.name," (lastRow: ").concat(r,") -> ").concat(n.name)),a="C",c="B",s="D",i="AE",u="I",l="B",p="D",f="J",h="AE",d="P",g="CX",m="#008000",y='_(* $#,##0_);_(* $(#,##0);_(* "$" -_);_(@_)',!(r<(o=9))){e.next=18;break}return console.warn("populateFinancialsJS: lastRow (".concat(r,") is less than CALCS_FIRST_ROW (").concat(o,"). Skipping.")),e.abrupt("return");case 18:return e.prev=18,console.log("populateFinancialsJS: Loading assumption data up to row ".concat(r)),(w=t.getRange("".concat(a).concat(o,":").concat(a).concat(r))).load("values"),x=n.getRange("".concat(u,":").concat(u)),(E=x.getUsedRange(!0)).load("rowCount"),k=0,e.next=28,t.context.sync();case 28:if(!(E.rowCount>0)){e.next=60;break}return e.prev=29,(P=E.getLastCell()).load("rowIndex"),e.next=34,t.context.sync();case 34:k=P.rowIndex+1,e.next=60;break;case 37:return e.prev=37,e.t0=e.catch(29),console.warn("Could not get last cell directly for Financials col ".concat(u,". Error: ").concat(e.t0.message,". Attempting fallback range loading.")),e.prev=40,(I=n.getRange("".concat(u,"1:").concat(u,"10000"))).load("values"),e.next=45,t.context.sync();case 45:S=I.values.length-1;case 46:if(!(S>=0)){e.next=53;break}if(null===I.values[S][0]||""===I.values[S][0]){e.next=50;break}return k=S+1,e.abrupt("break",53);case 50:S--,e.next=46;break;case 53:0===k&&console.warn("Fallback range load for Financials col ".concat(u," also yielded no data.")),e.next=60;break;case 56:e.prev=56,e.t1=e.catch(40),console.error("Error during fallback range loading for Financials col ".concat(u,":"),e.t1),k=0;case 60:if(console.log("Financials last relevant row in column ".concat(u,": ").concat(k)),C=new Map,!(k>0)){e.next=71;break}return(R=n.getRange("".concat(u,"1:").concat(u).concat(k))).load("values"),e.next=67,t.context.sync();case 67:for(A=0;A<R.values.length;A++)null!==(O=R.values[A][0])&&""!==O&&C.set(O,A+1);console.log("Built Financials code map with ".concat(C.size," entries.")),e.next=72;break;case 71:console.warn("Financials sheet column ".concat(u," appears empty or last row not found. No codes loaded."));case 72:return F=[],console.log("populateFinancialsJS: Syncing assumption codes load..."),e.next=76,t.context.sync();case 76:for(_=w.values,console.log("populateFinancialsJS: Processing ".concat(null!==(v=null==_?void 0:_.length)&&void 0!==v?v:0," assumption rows.")),T=0;T<(null!==(j=null==_?void 0:_.length)&&void 0!==j?j:0);T++)L=_[T][0],N=o+T,null!==L&&""!==L&&C.has(L)&&(B=C.get(L),D="".concat(c).concat(N),M="".concat(s).concat(N),U="".concat(i).concat(N),q="='".concat(t.name,"'!").concat(D),$="='".concat(t.name,"'!").concat(M),G="='".concat(t.name,"'!").concat(U),console.log("  Task Prep: Row ".concat(N,", Code ").concat(L)),F.push({targetRow:B,assumptionRow:N,code:L,addressB:q,addressD:$,addressMonths:G}));if(0!==F.length){e.next=82;break}return console.log("No matching codes found. Nothing to insert or populate."),e.abrupt("return");case 82:F.sort((function(e,t){return t.targetRow-e.targetRow})),console.log("Sorted ".concat(F.length," tasks for insertion.")),console.log("Performing row insertions..."),J=0,Y=F;case 86:if(!(J<Y.length)){e.next=94;break}return W=Y[J],n.getRange("".concat(W.targetRow,":").concat(W.targetRow)).insert(Excel.InsertShiftDirection.down),e.next=91,t.context.sync();case 91:J++,e.next=86;break;case 94:for(console.log("Finished row insertions."),console.log("Populating inserted rows..."),V=0,K=F;V<K.length;V++)z=K[V],H=z.targetRow,X=n.getRange("".concat(l).concat(H)),Z=n.getRange("".concat(p).concat(H)),Q=n.getRange("".concat(f).concat(H)),ee=n.getRange("".concat(h).concat(H)),X.formulas=[[z.addressB]],X.format.font.bold=!1,X.format.font.italic=!1,X.format.indentLevel=2,Z.formulas=[[z.addressD]],Z.format.font.bold=!1,Z.format.font.italic=!1,Z.format.indentLevel=2,te=String(z.code).substring(0,2).toUpperCase(),"",re="IS"===te||"CF"===te?"=SUMIF(R3,R2C,R[0])":"=SUMIF(R4,R2C,R[0])",Q.formulasR1C1=[[re]],Q.format.font.bold=!1,Q.format.font.italic=!1,Q.format.numberFormat=y,ee.formulas=[[z.addressMonths]],ee.format.font.bold=!1,ee.format.font.italic=!1,ee.format.font.color=m,ee.format.numberFormat=y;return console.log("Finished setting values/formulas/formats for inserted rows."),e.next=100,t.context.sync();case 100:for(console.log("Performing autofills..."),ne=0,oe=F;ne<oe.length;ne++){ae=oe[ne],ce=ae.targetRow;try{se=n.getRange("".concat(f).concat(ce)),ie=n.getRange("".concat(f).concat(ce,":").concat(d).concat(ce)),se.autoFill(ie,Excel.AutoFillType.fillDefault),ue=n.getRange("".concat(h).concat(ce)),le=n.getRange("".concat(h).concat(ce,":").concat(g).concat(ce)),ue.autoFill(le,Excel.AutoFillType.fillDefault)}catch(e){console.error("Error during autofill for row ".concat(ce," (Code: ").concat(ae.code,"):"),e.debugInfo||e)}}return console.log("Finished setting up autofills."),e.next=105,t.context.sync();case 105:console.log("Autofills synced."),console.log("populateFinancialsJS successfully completed for ".concat(t.name," -> ").concat(n.name)),e.next=113;break;case 109:throw e.prev=109,e.t2=e.catch(18),console.error("Error in populateFinancialsJS for sheet ".concat(t.name," -> ").concat(n.name,":"),e.t2.debugInfo||e.t2),e.t2;case 113:case"end":return e.stop()}}),e,null,[[18,109],[29,37],[40,56]])})))).apply(this,arguments)}function J(e,t,r){return Y.apply(this,arguments)}function Y(){return(Y=E(b().mark((function e(t,r,n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Running linkFinReferencesJS for sheet: ".concat(t.name," (lastRow: ").concat(r,") -> ").concat(n.name)),t.load("name"),n.load("name"),e.next=10,t.context.sync();case 10:console.warn("linkFinReferencesJS for ".concat(t.name," -> ").concat(n.name," not implemented yet."));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return V.apply(this,arguments)}function V(){return(V=E(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Running formatChangesInWorkingCapitalJS for sheet: ".concat(t.name)),t.load("name"),e.next=7,t.context.sync();case 7:console.warn("formatChangesInWorkingCapitalJS on ".concat(t.name," not implemented yet."));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return z.apply(this,arguments)}function z(){return z=E(b().mark((function e(t){var r,n,o,a,c,s,i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Starting processing for ".concat(t.length," assumption tabs:"),t),t&&0!==t.length){e.next=4;break}return console.log("No assumption tabs provided to process."),e.abrupt("return");case 4:r="Financials",n="AE",o="CX",a=9,e.prev=8,c=P(t),e.prev=10,i=b().mark((function e(){var t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value,console.log("\nProcessing Assumption Tab: ".concat(t)),e.prev=2,e.next=5,Excel.run(function(){var e=E(b().mark((function e(c){var s,i,u,l,p,f;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.workbook.worksheets.getItem(t),i=c.workbook.worksheets.getItem(r),s.load("name"),i.load("name"),e.next=6,c.sync();case 6:return console.log("Successfully got references for ".concat(s.name," and ").concat(i.name)),e.next=9,N(s,"B");case 9:if(!((u=e.sent)<a)){e.next=13;break}return console.warn("Skipping tab ".concat(t," as last used row in Col B (").concat(u,") is before start row (").concat(a,").")),e.abrupt("return");case 13:return console.log("Last row in Col B for ".concat(t,": ").concat(u)),e.next=16,D(s,u);case 16:return e.next=18,U(s,u);case 18:if(l=u,console.log("Using last row for subsequent steps: ".concat(l)),!(l<a)){e.next=23;break}return console.warn("Skipping remaining steps for ".concat(t," as updated last row (").concat(l,") is invalid.")),e.abrupt("return");case 23:return e.next=25,$(s,l,i);case 25:return e.next=27,J(s,l,i);case 27:return console.log("Autofilling ".concat(n).concat(a,":").concat(n).concat(l," to ").concat(o," on ").concat(t)),p=s.getRange("".concat(n).concat(a,":").concat(n).concat(l)),f=s.getRange("".concat(n).concat(a,":").concat(o).concat(l)),p.autoFill(f,Excel.AutoFillType.fillDefault),e.next=33,c.sync();case 33:console.log("Finished processing and syncing for tab ".concat(t));case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error processing tab ".concat(t,":"),e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})),c.s();case 13:if((s=c.n()).done){e.next=17;break}return e.delegateYield(i(),"t0",15);case 15:e.next=13;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),c.e(e.t1);case 22:return e.prev=22,c.f(),e.finish(22);case 25:return console.log("\nPerforming final operations on ".concat(r)),e.prev=26,e.next=29,Excel.run(function(){var e=E(b().mark((function e(t){var c,s,i,u;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(c=t.workbook.worksheets.getItem(r)).load("name"),e.next=4,t.sync();case 4:return e.next=6,W(c);case 6:return e.next=8,N(c,"B");case 8:if(!((s=e.sent)<a)){e.next=12;break}return console.warn("Skipping final autofill on ".concat(r," as last row (").concat(s,") is before start row (").concat(a,").")),e.abrupt("return");case 12:return console.log("Last row in Col B for ".concat(r,": ").concat(s)),console.log("Autofilling ".concat(n).concat(a,":").concat(n).concat(s," to ").concat(o," on ").concat(r)),i=c.getRange("".concat(n).concat(a,":").concat(n).concat(s)),u=c.getRange("".concat(n).concat(a,":").concat(o).concat(s)),i.autoFill(u,Excel.AutoFillType.fillDefault),e.next=19,t.sync();case 19:console.log("Finished final operations on ".concat(r));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(26),console.error("Error during final operations on ".concat(r,":"),e.t2);case 34:console.log("Finished processing all assumption tabs."),e.next=40;break;case 37:e.prev=37,e.t3=e.catch(8),console.error("Error in processAssumptionTabs main function:",e.t3);case 40:case"end":return e.stop()}}),e,null,[[8,37],[10,19,22,25],[26,31]])}))),z.apply(this,arguments)}function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){Q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Q(e,t,r){return(t=function(e){var t=function(e){if("object"!=H(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=H(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==H(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ee(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return te(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?te(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function re(){re=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",i=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var a=t&&t.prototype instanceof y?t:y,c=Object.create(a.prototype),s=new O(n||[]);return o(c,"_invoke",{value:S(e,r,s)}),c}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",g="completed",m={};function y(){}function v(){}function w(){}var b={};u(b,c,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(F([])));E&&E!==r&&n.call(E,c)&&(b=E);var k=w.prototype=y.prototype=Object.create(b);function P(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function r(o,a,c,s){var i=p(e[o],e,a);if("throw"!==i.type){var u=i.arg,l=u.value;return l&&"object"==H(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(l).then((function(e){u.value=e,c(u)}),(function(e){return r("throw",e,c,s)}))}s(i.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function S(t,r,n){var o=f;return function(a,c){if(o===d)throw Error("Generator is already running");if(o===g){if("throw"===a)throw c;return{value:e,done:!0}}for(n.method=a,n.arg=c;;){var s=n.delegate;if(s){var i=C(s,n);if(i){if(i===m)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===f)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=p(t,r,n);if("normal"===u.type){if(o=n.done?g:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function C(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,C(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,m;var c=a.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function F(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(H(t)+" is not iterable")}return v.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},P(I.prototype),u(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var c=new I(l(e,r,n,o),a);return t.isGeneratorFunction(r)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},P(k),u(k,i,"Generator"),u(k,c,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=F,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],s=c.completion;if("root"===c.tryLoc)return o("end");if(c.tryLoc<=this.prev){var i=n.call(c,"catchLoc"),u=n.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return o(c.catchLoc,!0);if(this.prev<c.finallyLoc)return o(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return o(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return o(c.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var c=a?a.completion:{};return c.type=e,c.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:F(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function ne(e,t,r,n,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,o)}function oe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){ne(a,n,o,c,s,"next",e)}function s(e){ne(a,n,o,c,s,"throw",e)}c(void 0)}))}}r(16797);var ae=(performance.now(),{OPENAI_API_KEY:"",PINECONE_API_KEY:""}),ce=["https://localhost:3002/src/prompts/Encoder_System.txt","https://localhost:3002/src/prompts/Encoder_Main.txt","https://localhost:3002/src/prompts/Followup_System.txt","https://localhost:3002/src/prompts/Structure_System.txt","https://localhost:3002/src/prompts/Validation_System.txt","https://localhost:3002/src/prompts/Validation_Main.txt"];function se(){return(se=oe(re().mark((function e(){var t,r,n,o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Initializing API keys..."),e.prev=2,e.next=5,fetch("https://localhost:3002/config.js");case 5:if(!(t=e.sent).ok){e.next=14;break}return e.next=9,t.text();case 9:r=e.sent,n=r.match(/OPENAI_API_KEY\s*=\s*["']([^"']+)["']/),o=r.match(/PINECONE_API_KEY\s*=\s*["']([^"']+)["']/),n&&n[1]&&(ae.OPENAI_API_KEY=n[1],console.log("OpenAI API key loaded from config.js")),o&&o[1]&&(ae.PINECONE_API_KEY=o[1],console.log("Pinecone API key loaded from config.js"));case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.warn("Could not load config.js, will use empty API keys:",e.t0);case 19:return console.log("OPENAI_API_KEY:",ae.OPENAI_API_KEY?"".concat(ae.OPENAI_API_KEY.substring(0,3),"...").concat(ae.OPENAI_API_KEY.substring(ae.OPENAI_API_KEY.length-3)):"Not found"),console.log("PINECONE_API_KEY:",ae.PINECONE_API_KEY?"".concat(ae.PINECONE_API_KEY.substring(0,3),"...").concat(ae.PINECONE_API_KEY.substring(ae.PINECONE_API_KEY.length-3)):"Not found"),e.abrupt("return",ae.OPENAI_API_KEY&&ae.PINECONE_API_KEY);case 24:return e.prev=24,e.t1=e.catch(0),console.error("Error initializing API keys:",e.t1),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[0,24],[2,16]])})))).apply(this,arguments)}var ie={codes:{name:"codes",apiEndpoint:"https://codes-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2trainingdata:{name:"call2trainingdata",apiEndpoint:"https://call2trainingdata-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call2context:{name:"call2context",apiEndpoint:"https://call2context-zmg9zog.svc.aped-4627-b74a.pinecone.io"},call1context:{name:"call1context",apiEndpoint:"https://call1context-zmg9zog.svc.aped-4627-b74a.pinecone.io"}},ue="gpt-4o",le=[];function pe(e){try{localStorage.setItem("conversationHistory",JSON.stringify(e)),console.log("Conversation history saved to localStorage")}catch(e){console.error("Error saving conversation history:",e)}}function fe(){try{var e=localStorage.getItem("conversationHistory");if(e){console.log("Loaded conversation history from localStorage");var t=JSON.parse(e);return Array.isArray(t)?t:(console.error("Invalid history format, expected array"),[])}return console.log("No conversation history found in localStorage"),[]}catch(e){return console.error("Error loading conversation history:",e),[]}}function he(e){return de.apply(this,arguments)}function de(){return de=oe(re().mark((function e(t){var r,n,o,a,c,s=arguments;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:ue,n=s.length>2&&void 0!==s[2]?s[2]:.7,e.prev=2,console.log("Calling OpenAI API with model: ".concat(r)),ae.OPENAI_API_KEY){e.next=6;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 6:return e.next=8,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(ae.OPENAI_API_KEY)},body:JSON.stringify({model:r,messages:t,temperature:n})});case 8:if((o=e.sent).ok){e.next=15;break}return e.next=12,o.json().catch((function(){return null}));case 12:throw a=e.sent,console.error("OpenAI API error response:",a),new Error("OpenAI API error: ".concat(o.status," ").concat(o.statusText));case 15:return e.next=17,o.json();case 17:return c=e.sent,console.log("OpenAI API response received"),e.abrupt("return",c.choices[0].message.content);case 22:throw e.prev=22,e.t0=e.catch(2),console.error("Error calling OpenAI API:",e.t0),e.t0;case 26:case"end":return e.stop()}}),e,null,[[2,22]])}))),de.apply(this,arguments)}function ge(e){return me.apply(this,arguments)}function me(){return(me=oe(re().mark((function e(t){var r,n,o;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Creating embedding for text"),ae.OPENAI_API_KEY){e.next=4;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 4:return e.next=6,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(ae.OPENAI_API_KEY)},body:JSON.stringify({model:"text-embedding-3-large",input:t})});case 6:if((r=e.sent).ok){e.next=13;break}return e.next=10,r.json().catch((function(){return null}));case 10:throw n=e.sent,console.error("OpenAI Embeddings API error response:",n),new Error("OpenAI Embeddings API error: ".concat(r.status," ").concat(r.statusText));case 13:return e.next=15,r.json();case 15:return o=e.sent,console.log("OpenAI Embeddings API response received"),e.abrupt("return",o.data[0].embedding);case 20:throw e.prev=20,e.t0=e.catch(0),console.error("Error creating embedding:",e.t0),e.t0;case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}function ye(e){return ve.apply(this,arguments)}function ve(){return(ve=oe(re().mark((function e(t){var r,n,o,a,c;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,(r=["https://localhost:3002/prompts/".concat(t,".txt")]).push.apply(r,ce),n=null,o=0,a=r;case 5:if(!(o<a.length)){e.next=23;break}return c=a[o],console.log("Attempting to load prompt from: ".concat(c)),e.prev=8,e.next=11,fetch(c);case 11:if(!(n=e.sent).ok){e.next=15;break}return console.log("Successfully loaded prompt from: ".concat(c)),e.abrupt("break",23);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),console.log("Path ".concat(c," failed: ").concat(e.t0.message));case 20:o++,e.next=5;break;case 23:if(n&&n.ok){e.next=25;break}throw new Error("Failed to load prompt: ".concat(t," (Could not find file in any location)"));case 25:return e.next=27,n.text();case 27:return e.abrupt("return",e.sent);case 30:throw e.prev=30,e.t1=e.catch(0),console.error("Error loading prompt ".concat(t,":"),e.t1),e.t1;case 34:case"end":return e.stop()}}),e,null,[[0,30],[8,17]])})))).apply(this,arguments)}var we=function(){var e=oe(re().mark((function e(t){var r;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ye(t);case 3:if(r=e.sent){e.next=6;break}throw new Error('Prompt key "'.concat(t,'" not found'));case 6:return e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error getting prompt for key ".concat(t,":"),e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();function be(e){return xe.apply(this,arguments)}function xe(){return(xe=oe(re().mark((function e(t){var r,n,o,a,c,s,i,u,l;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userInput,n=t.systemPrompt,o=t.model,a=t.temperature,c=t.history,s=void 0===c?[]:c,console.log("API Key being used:",ae.OPENAI_API_KEY?"".concat(ae.OPENAI_API_KEY.substring(0,3),"..."):"None"),i=[{role:"system",content:n}],s.length>0&&s.forEach((function(e){i.push({role:"human"===e[0]?"user":"assistant",content:e[1]})})),i.push({role:"user",content:r}),e.prev=5,e.next=8,he(i,o,a);case 8:if(u=e.sent,e.prev=9,l=JSON.parse(u),!Array.isArray(l)){e.next=13;break}return e.abrupt("return",l);case 13:return e.abrupt("return",u.split("\n").filter((function(e){return e.trim()})));case 16:return e.prev=16,e.t0=e.catch(9),e.abrupt("return",u.split("\n").filter((function(e){return e.trim()})));case 19:e.next=25;break;case 21:throw e.prev=21,e.t1=e.catch(5),console.error("Error in processPrompt:",e.t1),e.t1;case 25:case"end":return e.stop()}}),e,null,[[5,21],[9,16]])})))).apply(this,arguments)}function Ee(e){return ke.apply(this,arguments)}function ke(){return(ke=oe(re().mark((function e(t){var r,n,o,a,c,s,i;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Processing structured database queries:",t),e.prev=1,console.log("Getting structure system prompt"),e.next=5,we("Structure_System");case 5:if(r=e.sent){e.next=8;break}throw new Error("Failed to load structure system prompt");case 8:return console.log("Got system prompt, processing query strings"),e.next=11,be({userInput:t,systemPrompt:r,model:ue,temperature:1});case 11:if((n=e.sent)&&Array.isArray(n)){e.next=14;break}throw new Error("Failed to get valid query strings");case 14:console.log("Got query strings:",n),o=[],a=ee(n),e.prev=17,a.s();case 19:if((c=a.n()).done){e.next=47;break}return s=c.value,console.log("Processing query:",s),e.prev=22,e.t0=s,e.next=26,Pe({queryPrompt:s,similarityThreshold:.2,indexName:"call2trainingdata",numResults:3});case 26:return e.t1=e.sent,e.next=29,Pe({queryPrompt:s,similarityThreshold:.2,indexName:"call2context",numResults:5});case 29:return e.t2=e.sent,e.next=32,Pe({queryPrompt:s,similarityThreshold:.2,indexName:"call1context",numResults:5});case 32:return e.t3=e.sent,e.next=35,Pe({queryPrompt:s,indexName:"codes",numResults:3,similarityThreshold:.1});case 35:e.t4=e.sent,i={query:e.t0,trainingData:e.t1,call2Context:e.t2,call1Context:e.t3,codeOptions:e.t4},o.push(i),console.log("Successfully processed query:",s),e.next=45;break;case 41:return e.prev=41,e.t5=e.catch(22),console.error('Error processing query "'.concat(s,'":'),e.t5),e.abrupt("continue",45);case 45:e.next=19;break;case 47:e.next=52;break;case 49:e.prev=49,e.t6=e.catch(17),a.e(e.t6);case 52:return e.prev=52,a.f(),e.finish(52);case 55:if(0!==o.length){e.next=57;break}throw new Error("No valid results were obtained from any queries");case 57:return e.abrupt("return",o);case 60:throw e.prev=60,e.t7=e.catch(1),console.error("Error in structureDatabasequeries:",e.t7),e.t7;case 64:case"end":return e.stop()}}),e,null,[[1,60],[17,49,52,55],[22,41]])})))).apply(this,arguments)}function Pe(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=oe(re().mark((function e(t){var r,n,o,a,c,s,i,u,l,p,f,h,d,g,m,y;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queryPrompt,n=t.indexName,o=void 0===n?"codes":n,a=t.numResults,c=void 0===a?10:a,s=t.similarityThreshold,i=void 0===s?null:s,e.prev=1,console.log("Generating embeddings for query:",r),e.next=5,ge(r);case 5:if(u=e.sent,console.log("Embeddings generated successfully"),l=ie[o]){e.next=10;break}throw new Error("Invalid index name: ".concat(o));case 10:return p="".concat(l.apiEndpoint,"/query"),console.log("Making Pinecone API request to:",p),e.next=14,fetch(p,{method:"POST",headers:{"api-key":ae.PINECONE_API_KEY,"Content-Type":"application/json"},body:JSON.stringify({vector:u,topK:c,includeMetadata:!0,namespace:"ns1"})});case 14:if((f=e.sent).ok){e.next=21;break}return e.next=18,f.text();case 18:throw h=e.sent,console.error("Pinecone API error details:",{status:f.status,statusText:f.statusText,error:h}),new Error("Pinecone API error: ".concat(f.status," ").concat(f.statusText," - ").concat(h));case 21:return e.next=23,f.json();case 23:return d=e.sent,console.log("Pinecone API response received"),g=d.matches||[],null!==i&&(g=g.filter((function(e){return e.score>=i}))),g=(g=g.slice(0,c)).map((function(e){try{return e.metadata&&e.metadata.text?Z(Z({},e),{},{text:e.metadata.text}):e}catch(t){return console.error("Error processing match:",t),e}})),m=g.map((function(e,t){return"Match ".concat(t+1," (score: ").concat(e.score.toFixed(4),"): ").concat(e.text||JSON.stringify(e.metadata))})).join("\n"),console.log(m),y=g.map((function(e){return Se(e)})),e.abrupt("return",y.filter((function(e){return""!==e})));case 34:throw e.prev=34,e.t0=e.catch(1),console.error("Error during vector database query:",e.t0),e.t0;case 38:case"end":return e.stop()}}),e,null,[[1,34]])})))).apply(this,arguments)}function Se(e){try{var t="string"==typeof e?JSON.parse(e):e;if(Array.isArray(t)){var r,n=ee(t);try{for(n.s();!(r=n.n()).done;){var o=r.value;if(o.metadata&&o.metadata.text)return o.metadata.text}}catch(e){n.e(e)}finally{n.f()}throw new Error("No text field found in the JSON array")}if(t.metadata&&t.metadata.text)return t.metadata.text;throw new Error("Invalid JSON structure: missing metadata.text field")}catch(e){return console.error("Error processing JSON: ".concat(e.message)),""}}function Ce(e){if(arguments.length>1&&void 0!==arguments[1]&&!arguments[1]){var t=JSON.stringify(e);return(t=t.replace(/"values":\s*\[\],\s*"metadata":/g,"")).replace(/{/g,"\\u007B").replace(/}/g,"\\u007D")}return Array.isArray(e)?e.map((function(e){if(e.metadata&&e.metadata.text){var t=e.metadata.text.replace(/~/g,",").split(";"),r="";return t.length>=1&&(r+=t[0].trim()),t.length>=2&&(r+="\n"+t[1].trim()),t.length>=3&&(r+="\n"+t[2].trim()),e.score&&(r+="\nSimilarity Score: ".concat(e.score.toFixed(4))),r}return JSON.stringify(e).replace(/~/g,",")})).join("\n\n"):JSON.stringify(e,null,2).replace(/~/g,",").replace(/{/g,"\\u007B").replace(/}/g,"\\u007D")}function Re(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=oe(re().mark((function e(t){var r,n,o,a,c,s,i;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Processing follow-up question. Loading conversation history..."),!((le=fe()).length>0)){e.next=33;break}return console.log("Processing follow-up question:",t),console.log("Loaded conversation history:",JSON.stringify(le,null,2)),e.next=7,we("Followup_System");case 7:return r=e.sent,e.next=10,Pe({queryPrompt:t,similarityThreshold:.4,indexName:"call2trainingdata",numResults:3});case 10:return n=e.sent,e.next=13,Pe({queryPrompt:t+n,similarityThreshold:.3,indexName:"call2context",numResults:5});case 13:return o=e.sent,e.next=16,Pe({queryPrompt:t+n,similarityThreshold:.3,indexName:"call1context",numResults:5});case 16:return a=e.sent,e.next=19,Pe({queryPrompt:t+n+a,indexName:"codes",numResults:10,similarityThreshold:.1});case 19:return c=e.sent,s="Client request: "+t+"\nMain Prompt: "+MainPrompt+"\nTraining Data: "+Ce(n).replace(/~/g,",")+"\nCode choosing context: "+Ce(a)+"\nCode editing Context: "+Ce(o)+"\nCode descriptions: "+Ce(c),e.next=23,be({userInput:s,systemPrompt:r,model:ue,temperature:1,history:le});case 23:return i=e.sent,le.push(["human",t]),le.push(["assistant",i.join("\n")]),pe(le),console.log("Updated conversation history:",JSON.stringify(le,null,2)),je(t,r,MainPrompt,o,a,n,c,i),Le(t,i),e.abrupt("return",i);case 33:return console.log("No conversation history found. Treating as initial question."),e.abrupt("return",_e(t));case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return Fe.apply(this,arguments)}function Fe(){return Fe=oe(re().mark((function e(t){var r,n=arguments;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]&&n[1],e.prev=1,!r){e.next=8;break}return e.next=5,Re(t);case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,_e(t);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(1),console.error("Error in conversation handling:",e.t0),e.abrupt("return",["Error processing your request: "+e.t0.message]);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Fe.apply(this,arguments)}function _e(e){return Te.apply(this,arguments)}function Te(){return(Te=oe(re().mark((function e(t){var r,n,o,a;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Processing initial question:",t),e.next=3,we("Encoder_System");case 3:return r=e.sent,console.log("SYSTEM PROMPT: ",r),e.next=7,we("Encoder_Main");case 7:return n=e.sent,console.log("MAIN PROMPT: ",n),o="Client request: "+t+"\nMain Prompt: "+n,e.next=12,be({userInput:o,systemPrompt:r,model:ue,temperature:1});case 12:return a=e.sent,pe(le=[["human",t],["assistant",a.join("\n")]]),je(t,r,n,[],[],[],[],a),Le(t,a),console.log("Initial Response - in the function:",a),e.abrupt("return",a);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e,t,r,n,o,a,c,s,i,u,l){try{var p={clientRequest:e,systemPrompt:t,mainPrompt:r,validationSystemPrompt:n,validationMainPrompt:o,validationResults:a,call2context:c,call1context:s,trainingdataCall2:i,codeOptions:u,outputArray2:l};localStorage.setItem("promptAnalysis",JSON.stringify(p)),console.log("Prompt analysis saved to localStorage")}catch(e){console.error("Error saving prompt analysis:",e)}}function Le(e,t){try{var r=function(e){return e?e.toString().replace(/\r?\n|\r/g," ").trim():""},n={prompt:r(e),response:r(JSON.stringify(t))};localStorage.setItem("trainingData",JSON.stringify(n)),console.log("Training data saved to localStorage")}catch(e){console.error("Error saving training data:",e)}}function Ne(e,t,r){return Be.apply(this,arguments)}function Be(){return(Be=oe(re().mark((function e(t,r,n){var o,a,c,s,i,u,l,p;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,fe(),o=localStorage.getItem("trainingData")||"",a=localStorage.getItem("codeDescriptions")||"",c=localStorage.getItem("lastCallContext")||"",e.next=7,we("Validation_System");case 7:return s=e.sent,e.next=10,we("Validation_Main");case 10:if(i=e.sent,s){e.next=13;break}throw new Error("Failed to load validation system prompt");case 13:return u=Array.isArray(r)?r.join("\n"):String(r),l="Main Prompt: "+i+"\n\nOriginal User Input: "+t+"\n\nInitial Response: "+u+"\n\nValidation Results: "+n+"\n\nTraining Data: "+o+"\n\nCode Descriptions: "+a+"\n\nContext from Last Call: "+c,console.log("====== VALIDATION CORRECTION INPUT ======"),console.log(l.substring(0,500)+"...(truncated)"),console.log("========================================="),e.next=18,be({userInput:l,systemPrompt:s,model:ue,temperature:.7});case 18:return p=e.sent,f="C:\\Users\\joeor\\Dropbox\\B - Freelance\\C_Projectify\\VanPC\\Training Data\\Main Script Training and Context Data\\validation_correction_output.txt",h=Array.isArray(p)?p.join("\n"):p,console.log("Mock writeFileSync called with path: ".concat(f)),console.log("Content would be written to ".concat(f,":"),h.substring(0,100)+"..."),console.log("Validation correction saved to ".concat("C:\\Users\\joeor\\Dropbox\\B - Freelance\\C_Projectify\\VanPC\\Training Data\\Main Script Training and Context Data\\validation_correction_output.txt")),e.abrupt("return",p);case 25:return e.prev=25,e.t0=e.catch(0),console.error("Error in validation correction:",e.t0),console.error(e.t0.stack),e.abrupt("return",["Error during validation correction: "+e.t0.message]);case 30:case"end":return e.stop()}var f,h}),e,null,[[0,25]])})))).apply(this,arguments)}function De(e){var t=document.createElement("div");t.style.color="green",t.style.padding="10px",t.style.margin="10px",t.style.border="1px solid green",t.style.borderRadius="4px",t.textContent=e;var r=document.getElementById("app-body");r.insertBefore(t,r.firstChild),setTimeout((function(){t.remove()}),5e3)}function Me(e){var t=document.createElement("div");t.style.color="red",t.style.padding="10px",t.style.margin="10px",t.style.border="1px solid red",t.style.borderRadius="4px",t.textContent="Error: ".concat(e);var r=document.getElementById("app-body");r.insertBefore(t,r.firstChild),setTimeout((function(){t.remove()}),5e3)}function Ue(e){var t=document.getElementById("send"),r=document.getElementById("loading-animation");t&&(t.disabled=e),r&&(r.style.display=e?"flex":"none")}var qe=null,$e=!1;function Ge(){return Je.apply(this,arguments)}function Je(){return Je=oe(re().mark((function e(){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(qe){e.next=3;break}return Me("No response to write to Excel"),e.abrupt("return");case 3:return e.prev=3,e.next=6,Excel.run(function(){var e=oe(re().mark((function e(t){var r,n,o,a,c;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.workbook.getSelectedRange()).load("rowIndex"),r.load("columnIndex"),e.next=5,t.sync();case 5:if(n=r.rowIndex,o=r.columnIndex,a=[],Array.isArray(qe)?(c=qe.join(" "),a=c.match(/<[^>]+>/g)||[]):"string"==typeof qe&&(a=qe.match(/<[^>]+>/g)||[]),0!==a.length){e.next=11;break}throw new Error("No valid code strings found in response");case 11:return r.worksheet.getRangeByIndexes(n,o,a.length,1).values=a.map((function(e){return[e]})),e.next=15,t.sync();case 15:console.log("Response written to Excel");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),console.error("Error writing to Excel:",e.t0),Me(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[3,8]])}))),Je.apply(this,arguments)}function Ye(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.getElementById("chat-log"),n=document.getElementById("welcome-message");n&&(n.style.display="none");var o=document.createElement("div");o.className="chat-message ".concat(t?"user-message":"assistant-message");var a=document.createElement("p");a.className="message-content",a.textContent=e,o.appendChild(a),r.appendChild(o),r.scrollTop=r.scrollHeight}function We(){return Ve.apply(this,arguments)}function Ve(){return(Ve=oe(re().mark((function e(){var t,r,n,o,a,c;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("user-input").value.trim()){e.next=4;break}return Me("Please enter a request"),e.abrupt("return");case 4:return $e=le.length>0,Ye(t,!0),document.getElementById("user-input").value="",Ue(!0),e.prev=8,console.log("Starting structureDatabasequeries"),e.next=12,Ee(t);case 12:if(r=e.sent,console.log("Database queries completed"),r&&Array.isArray(r)){e.next=17;break}throw console.error("Invalid database results:",r),new Error("Failed to get valid database results");case 17:return n=r.map((function(e){return e?"Query: ".concat(e.query||"No query","\n")+"Training Data:\n".concat((e.trainingData||[]).join("\n"),"\n")+"Code Options:\n".concat((e.codeOptions||[]).join("\n"),"\n")+"Code Choosing Context:\n".concat((e.call1Context||[]).join("\n"),"\n")+"Code Editing Context:\n".concat((e.call2Context||[]).join("\n"),"\n")+"---\n":"No results found"})).join("\n"),o="Client Request: ".concat(t,"\n\nDatabase Results:\n").concat(n),console.log("Enhanced prompt created"),console.log("Enhanced prompt:",o),console.log("Starting handleConversation"),e.next=24,Oe(o,$e);case 24:if(a=e.sent,console.log("Conversation completed"),console.log("Initial Response:",a),a&&Array.isArray(a)){e.next=30;break}throw console.error("Invalid response:",a),new Error("Failed to get valid response from conversation");case 30:return console.log("Starting validation"),e.next=33,i(a);case 33:if(c=e.sent,console.log("Validation completed:",c),!(c&&c.length>0)){e.next=41;break}return console.log("Starting validation correction"),e.next=39,Ne(t,a,c);case 39:a=e.sent,console.log("Validation correction completed");case 41:qe=a,Ye(a.join("\n")),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(8),console.error("Error in handleSend:",e.t0),Me(e.t0.message),Ye("Error: ".concat(e.t0.message));case 50:return e.prev=50,Ue(!1),e.finish(50);case 53:case"end":return e.stop()}}),e,null,[[8,45,50,53]])})))).apply(this,arguments)}function Ke(){var e=document.getElementById("chat-log");e.innerHTML="";var t=document.createElement("div");t.id="welcome-message",t.className="welcome-message";var r=document.createElement("h1");r.textContent="What would you like to model?",t.appendChild(r),e.appendChild(t),pe(le=[]),$e=!1,qe=null,document.getElementById("user-input").value="",console.log("Chat reset completed")}function ze(){return He.apply(this,arguments)}function He(){return(He=oe(re().mark((function e(){var t,r,n,o,a,c,s,i,u,l,p,f,h,g,m,y,v;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Ue(!0),console.log("Starting sheet insertion and code processing..."),console.log("Fetching base Excel file..."),e.next=6,fetch("https://localhost:3002/assets/Worksheets_4.3.25 v1.xlsx");case 6:if((t=e.sent).ok){e.next=9;break}throw new Error("Failed to load Worksheets Excel file: ".concat(t.status," ").concat(t.statusText));case 9:return console.log("Converting file to base64..."),e.next=12,t.arrayBuffer();case 12:for(r=e.sent,n=new Uint8Array(r),o="",a=8192,c=0;c<n.length;c+=a)s=n.slice(c,Math.min(c+a,n.length)),o+=String.fromCharCode.apply(null,s);return i=btoa(o),console.log("Base64 conversion complete. Inserting sheets..."),e.next=21,d(i);case 21:return console.log("Base sheets inserted successfully."),console.log("Fetching codes Excel file..."),e.next=25,fetch("https://localhost:3002/assets/codes.xlsx");case 25:if((u=e.sent).ok){e.next=28;break}throw new Error("Failed to load Codes Excel file: ".concat(u.status," ").concat(u.statusText));case 28:return console.log("Converting codes file to base64..."),e.next=31,u.arrayBuffer();case 31:for(l=e.sent,p=new Uint8Array(l),f="",h=0;h<p.length;h+=a)g=p.slice(h,Math.min(h+a,p.length)),f+=String.fromCharCode.apply(null,g);return m=btoa(f),console.log("Codes Base64 conversion complete. Inserting codes sheets..."),e.next=39,d(m);case 39:return console.log("Codes sheets inserted successfully."),console.log("Populating code collection..."),y=C('<TAB; label1="Revenue and Direct Costs">\n<VOLLI-EV; labelRow=""; row1 = "|# of units sold:|||||||||||"; row2 = "LI1|# of students|||||100|100|100|100|100|100| *LI1|# of teachers|||||100|100|400|100|100|100| *LI1|# of sites|||||100|100|100|200|340|100|"; row3 = "V1|Total # of units sold|||||F|F|F|F|F|F|";>\n<BR>\n<UNITREV-VR; driver1="LI1"; row1 = "AS2|Grant Revenue/Student/Month|||||10|10|10|10|10|10|"; row2 = "R1|Total Grant Revenue|IS: revenue||||F|F|F|F|F|F|">\n\n<TAB; label1="Working Capital">\n<BR>\n<LABELH1; row1 = "|Current Assets:|||||||||||";>\n<BR>\n<CURRENTASSETDSO-IS; financialsdriver="Total Revenue"; row1 = "LI1|Accounts Receivable:|||||||||||"; row2 = "|Driver: Total Revenue|||||100000|100000|100000|100000|100000|100000|100000"; row3 = "AS1|# of days sales outstanding|||||30|30|30|30|30|30|"; row4 = "A1|Accounts Receivable|BS: current assets||||F|F|F|F|F|F|"; row5 = "||||||||||||"; row6 = "CF1|Change in Accounts Receivable|CF: WC||||F|F|F|F|F|F|F";>\n<BR>\n<CURRENTASSETDSO-IS; financialsdriver="Total Direct Costs"; row1 = "LI2|Inventory:|||||||||||"; row2 = "|Driver: Total Direct Costs|||||100000|100000|100000|100000|100000|100000|"; row3 = "AS2|# of days sales outstanding|||||30|30|30|30|30|30|"; row4 = "A2|Inventory|BS: current assets||||F|F|F|F|F|F|F"; row5 = "||||||||||||"; row6 = "CF2|Change in Inventory|CF: WC||||F|F|F|F|F|F|F";>\n<BR>\n<TAXDTA-ISR; financialsdriver="Pre-Tax Income"; row1 = "LI3|Income Tax:|||||||||||"; row2 = "|Driver: Pre-Tax Income|||||2052817.0512|2052817.0512|2396252.1563|2581830.7798|2682110.061|2736296.9822|0"; row3 = "AS3|% of EBITDA - Driver Pre-Tax Income|||||0.25|0.25|0.25|0.25|0.25|0.25|"; row4 = "C1|Income Tax|IS: Net income||||F|F|F|F|F|F|F"; row5 = "||||||||||||"; row6 = "A3|Deferred Tax Asset|BS: current assets||||F|F|F|F|F|F|F"; row7 = "||||||||||||"; row8 = "CF3|Change in Deferred Tax Asset|CF: WC||||F|F|F|F|F|F|F";>\n<BR>\n<OTHERASSET-ER; row1 = "LI4|Other Assets:|||||||||||"; row2 = "L4|Other Assets|BS: current assets||||F|F|F|F|F|F|F"; row3 = "||||||||||||"; row4 = "CF4|Change in Other Assets|CF: WC||||F|F|F|F|F|F|F";>\n<BR>\n<LABELH1; row1 = "|Current Liabilities:|||||||||||";>\n<CURRENTLIABDSO-IS; financialsdriver="Total Operating Expense"; row1 = "A1|Accounts Payable:|||||||||||"; row2 = "|Driver: Total Operating Expense||||100000|100000|100000|100000|100000|100000|"; row3 = "AS1|# of days sales outstanding||||30|30|30|30|30|30|"; row4 = "A2|Accounts Payable|BS: current liabilities||||F|F|F|F|F|F|"; row5 = "||||||||||||"; row6 = "CF2|Change in Accounts Payable|CF: WC||||F|F|F|F|F|F|";>\n<BR>\n<OTHERLIAB-ER; row1 = "L1|Other Liabilities:|||||||||||"; row2 = "L2|Accounts Payable|BS: current liabilities||||F|F|F|F|F|F|"; row3 = "L3|Other Liabilities|BS: current liabilities||||F|F|F|F|F|F|"; row4 = "||||||||||||"; row5 = "CF1|Change in Other Liabilities|CF: WC||||F|F|F|F|F|F|"; >\n\n'),console.log("Code collection populated with ".concat(y.length," code(s)")),console.log("Running codes..."),e.next=46,O(y);case 46:if(v=e.sent,console.log("Codes executed:",v),!(v&&v.assumptionTabs&&v.assumptionTabs.length>0)){e.next=55;break}return console.log("Processing assumption tabs:",v.assumptionTabs),e.next=52,K(v.assumptionTabs);case 52:console.log("Assumption tabs processed successfully"),e.next=56;break;case 55:console.warn("No assumption tabs to process");case 56:De("Model built successfully!"),e.next=63;break;case 59:e.prev=59,e.t0=e.catch(0),console.error("An error occurred during the build process:",e.t0),Me("Operation failed: ".concat(e.t0.message||e.t0.toString()));case 63:return e.prev=63,Ue(!1),e.finish(63);case 66:case"end":return e.stop()}}),e,null,[[0,59,63,66]])})))).apply(this,arguments)}Office.onReady((function(e){if(e.host===Office.HostType.Excel){var t=document.getElementById("insert-and-run");t?t.onclick=ze:console.error("Could not find button with id='insert-and-run'");var r=document.getElementById("send");r&&(r.onclick=We);var n=document.getElementById("write-to-excel");n&&(n.onclick=Ge);var o=document.getElementById("reset-chat");o&&(o.onclick=Ke);var a=document.getElementById("test-green-cell");a&&(a.onclick=_),function(){return se.apply(this,arguments)}().then((function(e){e||Me("Failed to load API keys. Please check configuration."),le=fe()})).catch((function(e){console.error("Error during API key initialization:",e),Me("Error initializing API keys: "+e.message)})),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="block"}}))}(),function(){"use strict";new URL(r(58394),r.b),new URL(r(20282),r.b)}()}();
//# sourceMappingURL=taskpane.js.map